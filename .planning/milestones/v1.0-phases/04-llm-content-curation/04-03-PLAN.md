---
phase: 04-llm-content-curation
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/src/app/settings/page.tsx
  - frontend/src/hooks/usePreferences.ts
  - frontend/src/components/layout/Header.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to /settings from the header"
    - "User can write prose-style interests and anti-interests in dedicated text areas"
    - "User can see and modify topic category weights (blocked/low/neutral/medium/high)"
    - "Saving preferences triggers re-scoring of recent articles"
    - "Preference fields have example placeholder text to guide first-time setup"
  artifacts:
    - path: "frontend/src/app/settings/page.tsx"
      provides: "Settings page with preferences editor"
      contains: "Interests"
    - path: "frontend/src/hooks/usePreferences.ts"
      provides: "TanStack Query hook for preferences CRUD"
      contains: "usePreferences"
    - path: "frontend/src/components/layout/Header.tsx"
      provides: "Settings navigation link in header"
      contains: "settings"
  key_links:
    - from: "frontend/src/app/settings/page.tsx"
      to: "frontend/src/hooks/usePreferences.ts"
      via: "usePreferences hook for data loading and saving"
      pattern: "usePreferences"
    - from: "frontend/src/hooks/usePreferences.ts"
      to: "frontend/src/lib/api.ts"
      via: "fetchPreferences, updatePreferences, fetchCategories"
      pattern: "from.*api.*import"
    - from: "frontend/src/components/layout/Header.tsx"
      to: "/settings"
      via: "Next.js Link to settings page"
      pattern: "href.*settings"
---

<objective>
Create the settings page where users manage their interest preferences (prose text + topic category weights) and add navigation to it from the header.

Purpose: Fulfills LLM-02 (prose preferences) and the category management aspects of the locked decisions. This is the user's primary interface for controlling what the LLM curation system considers interesting.
Output: Working /settings page with preferences editor, accessible from header navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-llm-content-curation/04-RESEARCH.md
@.planning/phases/04-llm-content-curation/04-CONTEXT.md
@.planning/phases/04-llm-content-curation/04-01-SUMMARY.md
@frontend/src/lib/types.ts
@frontend/src/lib/api.ts
@frontend/src/components/layout/Header.tsx
@frontend/src/app/layout.tsx
@frontend/src/hooks/useArticles.ts
@frontend/src/components/ui/provider.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create usePreferences hook and settings page</name>
  <files>
    frontend/src/hooks/usePreferences.ts
    frontend/src/app/settings/page.tsx
  </files>
  <action>
    **usePreferences.ts** — Create TanStack Query hook following existing patterns in useArticles.ts and useFeeds.ts:

    `usePreferences()` — Returns `{ preferences, categories, isLoading, updatePreferences, updateCategoryWeight }`:
    - `useQuery` for fetching preferences (key: ["preferences"]), calls `fetchPreferences()`
    - `useQuery` for fetching categories (key: ["categories"]), calls `fetchCategories()`
    - `useMutation` for `updatePreferences` that calls `updatePreferences()` from api.ts, invalidates ["preferences"] on success
    - `useMutation` for `updateCategoryWeight` that calls `updateCategoryWeight()` from api.ts, invalidates ["preferences", "categories"] on success

    **settings/page.tsx** — Create client component ("use client") with the preferences editor:

    Layout: Full-width container with max-w-2xl, centered, py=8 px=6. Use the app's existing styling conventions (Chakra UI v3 components).

    **Section 1: Interest Preferences (prose)**
    - Heading "Interest Preferences"
    - `Field.Root` with `Field.Label` "Interests" + `Textarea` (rows=6, resize="vertical")
      - Placeholder: "Example: I'm interested in software architecture, distributed systems, and developer productivity tools. I enjoy deep technical articles with code examples, especially about Python, TypeScript, and system design."
      - `Field.HelperText`: "Describe topics you want to see more of in natural language"
    - `Field.Root` with `Field.Label` "Anti-interests" + `Textarea` (rows=4, resize="vertical")
      - Placeholder: "Example: I'm not interested in cryptocurrency price speculation, celebrity gossip, or marketing growth hacks. I'd rather skip low-effort listicles and SEO-optimized filler content."
      - `Field.HelperText`: "Describe topics you want to avoid"
    - Save button (colorPalette="orange") that calls updatePreferences mutation with both fields. Show loading state during save. Show success toast via sonner/toaster on save.

    **Section 2: Topic Categories**
    - Heading "Topic Categories"
    - Helper text: "Adjust how strongly each topic affects your article scores"
    - List of categories from `usePreferences().categories`
    - Each category row: category name (text) + weight selector (a small segmented control or select dropdown with options: blocked, low, neutral, medium, high)
    - Default weight for unlisted categories is "neutral"
    - Changing a weight calls `updateCategoryWeight` mutation immediately (no separate save button needed for weights)
    - If no categories exist yet (no articles scored), show an empty state: "Categories will appear here once articles are scored by the LLM"

    State management: Load preferences on mount via usePreferences hook. Initialize form state from fetched data. Use `useEffect` to sync form state when preferences data changes (not in useState initializer — hydration safety per MEMORY.md).

    Use the Chakra UI `Field` component from `@/components/ui/field` for form fields (check if this snippet exists; if not, it's a Chakra UI v3 built-in — import from `@chakra-ui/react` or create the snippet via `npx @chakra-ui/cli snippet add field`).

    Use existing Toaster for success/error feedback (check if toaster.tsx exists in components/ui — it does from the glob results).
  </action>
  <verify>
    Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to confirm TypeScript compiles.
    Verify the page exists: `ls frontend/src/app/settings/page.tsx`
  </verify>
  <done>
    /settings page renders with two prose textareas (interests, anti-interests) with placeholder text, a category list with weight selectors, and a save button. Preferences load from API on mount. Save triggers API update and re-scoring. Category weights update immediately on change.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add settings navigation link to header</name>
  <files>
    frontend/src/components/layout/Header.tsx
  </files>
  <action>
    In Header.tsx, add a settings link/icon button to the right side of the header, next to the ThemeToggle.

    Add an icon button or text link that navigates to `/settings`. Use Next.js `Link` component (from "next/link"). Use a gear/settings icon from react-icons (e.g., `LuSettings` from "react-icons/lu" — already using `LuMenu` from the same package).

    Position it in the right-side Flex, before the ThemeToggle:
    ```
    <Flex alignItems="center" gap={1}>
      <Link href="/settings">
        <IconButton aria-label="Settings" size="sm" variant="ghost">
          <LuSettings />
        </IconButton>
      </Link>
      <ThemeToggle colorPalette="accent" />
    </Flex>
    ```

    Make sure the icon button has proper hover state matching existing buttons (ghost variant handles this).
  </action>
  <verify>
    Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to confirm TypeScript compiles.
  </verify>
  <done>
    Header shows a gear/settings icon button that links to /settings page. Positioned next to theme toggle on the right side.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes in frontend
- /settings page file exists with preferences editor
- Header.tsx includes settings link
- usePreferences hook follows TanStack Query patterns from existing hooks
</verification>

<success_criteria>
User can click settings icon in header to navigate to /settings. Settings page shows interest/anti-interest textareas with placeholder guidance. Category weight editor lists known categories. Save updates preferences and triggers re-scoring. Weight changes take effect immediately.
</success_criteria>

<output>
After completion, create `.planning/phases/04-llm-content-curation/04-03-SUMMARY.md`
</output>
