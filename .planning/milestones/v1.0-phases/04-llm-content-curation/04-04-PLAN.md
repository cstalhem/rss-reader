---
phase: 04-llm-content-curation
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - frontend/src/components/article/ArticleRow.tsx
  - frontend/src/components/article/ArticleReader.tsx
  - frontend/src/components/article/TagChip.tsx
autonomous: true

must_haves:
  truths:
    - "Article rows display category tags as small badge/chip elements"
    - "Article reader drawer shows tags more prominently plus score and reasoning"
    - "Scoring state indicators are visible (spinner for scoring, dash for unscored)"
    - "Tag chips in reader drawer support quick-block/boost via popup menu"
  artifacts:
    - path: "frontend/src/components/article/TagChip.tsx"
      provides: "Reusable tag chip component with optional weight popup"
      contains: "TagChip"
    - path: "frontend/src/components/article/ArticleRow.tsx"
      provides: "Article row with category tags and scoring state indicator"
      contains: "categories"
    - path: "frontend/src/components/article/ArticleReader.tsx"
      provides: "Reader drawer with prominent tags, score, reasoning, and quick-block/boost"
      contains: "score_reasoning"
  key_links:
    - from: "frontend/src/components/article/ArticleRow.tsx"
      to: "frontend/src/components/article/TagChip.tsx"
      via: "renders TagChip for each category"
      pattern: "TagChip"
    - from: "frontend/src/components/article/ArticleReader.tsx"
      to: "frontend/src/components/article/TagChip.tsx"
      via: "renders interactive TagChip with weight menu"
      pattern: "TagChip"
    - from: "frontend/src/components/article/TagChip.tsx"
      to: "frontend/src/lib/api.ts"
      via: "updateCategoryWeight for quick-block/boost"
      pattern: "updateCategoryWeight"
---

<objective>
Add visual scoring information to the article list and reader: category tag badges on article rows, scoring state indicators, and in the reader drawer show tags prominently with score display, reasoning text, and quick-block/boost from tag chips.

Purpose: Fulfills LLM-05 (auto-categorized topics visible in UI) and the locked decisions about tag display, scoring state indicators, and quick-block/boost from tag chips.
Output: Articles visually display their LLM-assigned categories, scores, and scoring state.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-llm-content-curation/04-CONTEXT.md
@.planning/phases/04-llm-content-curation/04-01-SUMMARY.md
@.planning/phases/04-llm-content-curation/04-02-SUMMARY.md
@.planning/phases/04-llm-content-curation/04-03-SUMMARY.md
@frontend/src/components/article/ArticleRow.tsx
@frontend/src/components/article/ArticleReader.tsx
@frontend/src/lib/types.ts
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TagChip component and update ArticleRow</name>
  <files>
    frontend/src/components/article/TagChip.tsx
    frontend/src/components/article/ArticleRow.tsx
  </files>
  <action>
    **TagChip.tsx** — Create a reusable tag chip component:

    Props: `{ label: string, size?: "sm" | "md", interactive?: boolean, currentWeight?: string, onWeightChange?: (weight: string) => void }`

    Non-interactive mode (default, for article rows): Render as a small `Badge` or `Tag` from Chakra UI with subtle background (`bg.subtle`), small text (fontSize="xs"), rounded. Category text displayed in lowercase.

    Interactive mode (for reader drawer, when `interactive=true`): Same visual but wrapped in a Popover or Menu. On click, shows a small menu with weight options: "high", "medium", "neutral", "low", "blocked". Current weight is visually indicated (checkmark or highlighted). Selecting a weight calls `onWeightChange(weight)`. Stop propagation on click to prevent article selection.

    Color coding by weight (when weight is known):
    - blocked: red/muted (strikethrough or dimmed)
    - low: slightly dimmed
    - neutral: default (no special color)
    - medium: slightly emphasized
    - high: accent color (orange)

    Keep the component simple. The "sm" size is for article rows (compact), "md" for reader drawer (slightly larger).

    **ArticleRow.tsx** — Extend to show tags and scoring state:

    After the "Source + date" Text line, add a row of TagChip components:
    - If `article.categories` is not null and has items, render up to 3 TagChips (non-interactive, size="sm")
    - If more than 3 categories, show "+N" indicator
    - Wrap in a `Flex` with `gap={1}` and `flexWrap="wrap"`

    Add scoring state indicator next to the read/unread toggle button area:
    - If `scoring_state === "scoring"`: show a small spinner (Chakra `Spinner` size="xs")
    - If `scoring_state === "queued"`: show a clock icon or subtle text "..."
    - If `scoring_state === "unscored"`: show a dash "—" in muted color
    - If `scoring_state === "failed"`: show a warning icon in subtle red
    - If `scoring_state === "scored"` and `composite_score` is not null: show the score as a small colored number (e.g., "8.2" with color intensity based on score)

    Keep the scoring indicator small and unobtrusive — it should not compete with the article title for attention. Position it in the right column area near the toggle button.

    The existing `<Box minH="0" />` placeholder comment says "Reserved space for future LLM reasoning/summary (Phase 5)" — replace it with the tag chips row.
  </action>
  <verify>
    Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to confirm TypeScript compiles.
    Verify TagChip exists: `ls frontend/src/components/article/TagChip.tsx`
  </verify>
  <done>
    ArticleRow displays up to 3 category tag chips below the title/date line. Scoring state indicator shows in the right column (spinner for scoring, dash for unscored, score number for scored). TagChip component renders category labels as small badges.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update ArticleReader drawer with tags, score, reasoning, and quick-block/boost</name>
  <files>
    frontend/src/components/article/ArticleReader.tsx
  </files>
  <action>
    Extend the ArticleReader drawer to show scoring information prominently in the header area, after the metadata row (author, date, feed):

    **Tags section** — Below metadata, render ALL category tags (not truncated like the row) as interactive TagChip components (size="md", interactive=true). Each TagChip receives:
    - `label`: the category name
    - `currentWeight`: look up from preferences (needs usePreferences hook or pass topic_weights as prop — since ArticleReader is a client component, it can use the hook directly)
    - `onWeightChange`: call `updateCategoryWeight(category, weight)` from the usePreferences hook

    Import `usePreferences` from the hook created in Plan 03. Use `preferences?.topic_weights` to look up current weight for each category. Wrap tags in a `Flex` with `gap={2} flexWrap="wrap"`.

    **Score display** — If article is scored (scoring_state === "scored"):
    - Show composite score as a prominent number/badge (e.g., "Score: 7.2/20" or just the number with color)
    - Show quality indicator (e.g., "Quality: 8/10" in smaller text)
    - Show the `score_reasoning` text below the score in a subtle italic style (fontSize="sm", color="fg.muted", fontStyle="italic")

    If article is not yet scored:
    - Show scoring state text (e.g., "Queued for scoring...", "Scoring in progress...", "Not yet scored")

    Position the score/reasoning section in the header, after the tags, before the "Open original" link. Use a subtle visual separator (small gap or border) to distinguish from article content.

    Make sure the interactive tag chips work without causing hydration issues — they're in a client component so this should be fine, but don't initialize state from any stored values.
  </action>
  <verify>
    Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to confirm TypeScript compiles.
  </verify>
  <done>
    Reader drawer shows all category tags as interactive chips with quick-block/boost popup. Score and quality displayed prominently for scored articles. Reasoning text shown in italic below score. Scoring state shown for unscored/queued/scoring articles. Weight changes from tag chips update preferences immediately.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes in frontend
- TagChip.tsx exists with both interactive and non-interactive modes
- ArticleRow shows tags and scoring state
- ArticleReader shows tags, score, reasoning, and quick-block/boost
</verification>

<success_criteria>
Article rows display category tags as small badges and scoring state indicators. Reader drawer shows all tags as interactive chips (click to change weight), composite score, quality score, and reasoning text. Tag chips support quick-block/boost via popup menu that updates preferences immediately.
</success_criteria>

<output>
After completion, create `.planning/phases/04-llm-content-curation/04-04-SUMMARY.md`
</output>
