---
phase: 03-feed-management
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - frontend/src/components/feed/FeedRow.tsx
  - frontend/src/components/feed/DeleteFeedDialog.tsx
  - frontend/src/components/layout/Sidebar.tsx
  - frontend/src/components/layout/MobileSidebar.tsx
  - frontend/src/components/article/ArticleList.tsx
autonomous: true

must_haves:
  truths:
    - "Feeds can be reordered by drag-and-drop and new order persists across page reload"
    - "Hovering over a feed row on desktop reveals action buttons (remove, mark all read)"
    - "Swiping left on a feed row on mobile reveals action buttons"
    - "Clicking remove on a feed opens confirmation dialog mentioning article deletion"
    - "Confirming removal deletes the feed and its articles disappear from the list"
    - "Double-clicking feed name on desktop enables inline rename"
    - "Mark all as read on a feed marks all its articles as read"
    - "'Mark all as read' button available in article list header for global use"
  artifacts:
    - path: "frontend/src/components/feed/FeedRow.tsx"
      provides: "Individual feed row with drag handle, hover actions, swipe actions, inline rename"
    - path: "frontend/src/components/feed/DeleteFeedDialog.tsx"
      provides: "Confirmation dialog for feed removal with article deletion warning"
  key_links:
    - from: "FeedRow drag"
      to: "useReorderFeeds mutation"
      via: "dnd-kit onDragEnd -> arrayMove -> mutation"
      pattern: "useReorderFeeds"
    - from: "DeleteFeedDialog confirm"
      to: "useDeleteFeed mutation"
      via: "confirm button triggers deletion"
      pattern: "useDeleteFeed"
    - from: "FeedRow mark-all-read"
      to: "useMarkAllRead mutation"
      via: "action button triggers mark-all-read"
      pattern: "useMarkAllRead"
---

<objective>
Add feed row interactions: drag-to-reorder, hover/swipe action buttons, inline rename, delete confirmation dialog, and mark-all-as-read.

Purpose: Complete the feed management experience with all interaction patterns defined in user decisions — desktop hover actions, mobile swipe, drag reorder, inline rename, and safe deletion with confirmation.
Output: Fully interactive feed rows with all action patterns, delete confirmation, and mark-all-read functionality.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-feed-management/03-RESEARCH.md
@.planning/phases/03-feed-management/03-02-SUMMARY.md
@frontend/src/components/layout/Sidebar.tsx
@frontend/src/components/layout/MobileSidebar.tsx
@frontend/src/components/feed/AddFeedDialog.tsx
@frontend/src/hooks/useFeedMutations.ts
@frontend/src/hooks/useFeeds.ts
@frontend/src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: FeedRow with drag-to-reorder, hover actions, and swipe actions</name>
  <files>
    frontend/src/components/feed/FeedRow.tsx
    frontend/src/components/layout/Sidebar.tsx
    frontend/src/components/layout/MobileSidebar.tsx
  </files>
  <action>
  First, install the required npm packages:
  ```bash
  cd /Users/cstalhem/projects/rss-reader/frontend && npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities react-swipeable
  ```

  **FeedRow.tsx** — NEW component. Props: `feed: Feed`, `isSelected: boolean`, `onSelect: (id: number) => void`, `onDelete: (feed: Feed) => void`, `onMarkAllRead: (feedId: number) => void`, `onRename: (id: number, title: string) => void`.

  Structure:
  - Use `useSortable` hook from @dnd-kit/sortable with `id: feed.id`. Apply transform and transition styles via `CSS.Transform.toString()`.
  - Row layout: drag handle (grip icon, `LuGripVertical`) on left, feed title in middle, unread count badge on right.
  - **Desktop hover actions:** On hover (CSS `_hover` or `onMouseEnter`/`onMouseLeave` state), show action buttons on the right side: remove (trash icon, `LuTrash2`) and mark-all-read (check icon, `LuCheckCheck`). Buttons appear over the unread count area. Use `opacity: 0` to `opacity: 1` transition on hover for smooth reveal.
  - **Mobile swipe actions:** Use `useSwipeable` from react-swipeable. Swipe left reveals action buttons (delete, mark-all-read) sliding in from right. Swipe right hides them. Track `isRevealed` state. Apply `transform: translateX(-80px)` when revealed. Action buttons positioned absolutely on the right.
  - **Selected state:** When `isSelected`, apply accent background color (e.g., `bg="accent.subtle"` or a semi-transparent accent).
  - Click handler: call `onSelect(feed.id)`.
  - Drag handle: `{...attributes} {...listeners}` from useSortable applied only to the grip icon, NOT the whole row (so clicks still work for selection).

  **Sidebar.tsx** — Wrap the feed list in dnd-kit DndContext and SortableContext:
  - Import `DndContext`, `closestCenter`, `PointerSensor`, `KeyboardSensor`, `useSensor`, `useSensors` from @dnd-kit/core.
  - Import `SortableContext`, `verticalListSortingStrategy`, `arrayMove` from @dnd-kit/sortable.
  - Configure sensors: PointerSensor with activation constraint (distance: 5px to prevent accidental drags when clicking), KeyboardSensor with sortableKeyboardCoordinates.
  - On `handleDragEnd`: get active/over IDs, find indices, use arrayMove on feeds array, call `useReorderFeeds` mutation with new order's feed IDs.
  - Replace inline feed rendering with `<FeedRow>` components inside SortableContext.
  - Pass `onDelete`, `onMarkAllRead`, `onRename` callbacks. `onDelete` opens DeleteFeedDialog (state managed here or in AppShell — keep it in Sidebar since it's feed-specific). `onMarkAllRead` calls `useMarkAllRead` mutation. `onRename` calls `useUpdateFeed` mutation.

  **MobileSidebar.tsx** — Same FeedRow components but WITHOUT dnd-kit wrapping (drag-to-reorder is desktop-only per practicality — mobile drawer UX doesn't support drag well). Keep swipe actions. Pass same callbacks.
  </action>
  <verify>
  Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to confirm no type errors.

  Manual test:
  1. Desktop: hover over feed row — action buttons appear smoothly
  2. Desktop: drag a feed by grip handle — reorder works, persists on reload
  3. Mobile: swipe left on feed — action buttons revealed
  4. Mobile: swipe right — buttons hidden
  5. Clicking a feed still selects it (drag doesn't interfere with click)
  </verify>
  <done>FeedRow renders with drag handle, hover actions on desktop, swipe actions on mobile. Drag-to-reorder works in sidebar with dnd-kit. Order persists via reorder mutation.</done>
</task>

<task type="auto">
  <name>Task 2: Delete confirmation dialog, inline rename, and mark-all-as-read</name>
  <files>
    frontend/src/components/feed/DeleteFeedDialog.tsx
    frontend/src/components/feed/FeedRow.tsx
    frontend/src/components/layout/Sidebar.tsx
    frontend/src/components/article/ArticleList.tsx
  </files>
  <action>
  **DeleteFeedDialog.tsx** — NEW component:
  Props: `feed: Feed | null` (null = closed), `onClose: () => void`, `onConfirm: (feedId: number) => void`.

  Uses Chakra Dialog.Root with `open={!!feed}`. Centered placement.
  - Dialog.Title: "Remove Feed"
  - Dialog.Body: Warning text — "Remove **{feed.title}**? This will delete all articles from this feed." Use Text with bold feed name.
  - Dialog.Footer: "Cancel" ghost button + "Remove" solid red/destructive button.
  - On confirm: call `onConfirm(feed.id)`, then `onClose()`.
  - The parent (Sidebar) handles the actual deletion via `useDeleteFeed` mutation in the onConfirm callback.

  **FeedRow.tsx** — Add inline rename:
  - Add `isRenaming` state. Double-click on feed title (desktop) sets `isRenaming = true`.
  - When renaming: replace title Text with an Input, auto-focused, pre-filled with current title.
  - On Enter or blur: call `onRename(feed.id, newTitle)` if title changed, set `isRenaming = false`.
  - On Escape: cancel rename, restore original title, set `isRenaming = false`.
  - Note: For mobile, long-press triggers rename. Use a simple timer: onTouchStart sets a timeout (500ms), onTouchEnd/onTouchMove clears it. If timer fires, set `isRenaming = true`.

  **Sidebar.tsx** — Wire delete and mark-all-read:
  - Add `feedToDelete: Feed | null` state for DeleteFeedDialog.
  - When FeedRow's `onDelete` fires: set `feedToDelete` to that feed.
  - Render `<DeleteFeedDialog feed={feedToDelete} onClose={() => setFeedToDelete(null)} onConfirm={handleDeleteConfirm} />`.
  - `handleDeleteConfirm`: call `useDeleteFeed().mutate(feedId)`. If the deleted feed was selected (`selectedFeedId === feedId`), reset selection to null (All Articles) via `onSelectFeed(null)`.
  - For `onMarkAllRead`: call `useMarkAllRead().mutate(feedId)`.
  - For `onRename`: call `useUpdateFeed().mutate({id, data: {title}})`.

  **ArticleList.tsx** — Add "Mark all as read" button in the article list top bar:
  - Import `useMarkAllRead` from useFeedMutations (or create a general mark-all-read-for-current-view).
  - Add a "Mark all read" button (ghost variant, small) in the top bar next to the Unread/All filter buttons.
  - When clicked: if `selectedFeedId` is set, call mark-all-read for that feed. If null (all articles view), need a separate backend endpoint or iterate. For simplicity: if selectedFeedId is set, use `POST /api/feeds/{feedId}/mark-all-read`. If no feed selected, skip for now (global mark-all-read can be a quick follow-up — or implement by calling the endpoint for each feed).
  - After mutation success, articles query invalidates and list updates.
  </action>
  <verify>
  Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to confirm no type errors.

  Manual test:
  1. Click remove action on feed row — confirmation dialog appears with feed name and warning
  2. Cancel — dialog closes, feed still exists
  3. Confirm — feed disappears, articles from that feed gone from list
  4. If deleted feed was selected, view resets to "All Articles"
  5. Double-click feed name — inline edit mode, type new name, press Enter — name updates
  6. Press Escape during rename — cancels, original name restored
  7. Click mark-all-read action on feed — all articles in that feed marked as read, unread count drops to 0
  8. "Mark all read" button in article list header works for selected feed view
  </verify>
  <done>Delete confirmation dialog works with warning text. Inline rename works via double-click (desktop) and long-press (mobile). Mark-all-as-read works per-feed and from article list header. Deleted feed resets selection to All Articles.</done>
</task>

</tasks>

<verification>
- Drag-to-reorder: feeds reorder on drag, new order persists on page reload
- Hover actions (desktop): remove and mark-all-read buttons appear on hover
- Swipe actions (mobile): swipe left reveals action buttons
- Delete: confirmation dialog shows with warning about article deletion, confirm removes feed + articles
- Inline rename: double-click enables edit, Enter saves, Escape cancels
- Mark all read: per-feed mark-all-read updates unread count and article read state
- Mark all read button in article list header for current view
- All mutations properly invalidate caches (feeds + articles queries)
- TypeScript compiles with no errors
</verification>

<success_criteria>
Complete feed row interaction system: drag reorder, hover/swipe actions, delete with confirmation, inline rename, mark-all-as-read. All interactions feel responsive with proper cache invalidation. Both desktop and mobile patterns work.
</success_criteria>

<output>
After completion, create `.planning/phases/03-feed-management/03-03-SUMMARY.md`
</output>
