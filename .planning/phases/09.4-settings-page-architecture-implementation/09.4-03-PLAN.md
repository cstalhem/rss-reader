---
phase: 09.4-settings-page-architecture-implementation
plan: 03
type: execute
wave: 2
depends_on: ["09.4-01"]
files_modified:
  - frontend/src/lib/constants.ts
  - frontend/src/components/settings/SettingsSidebar.tsx
  - frontend/src/components/settings/SettingsMobileNav.tsx
  - frontend/src/components/settings/ModelManagement.tsx
  - frontend/src/components/settings/ModelSelector.tsx
  - frontend/src/components/settings/OllamaSection.tsx
autonomous: true
requirements: []

must_haves:
  truths:
    - "SettingsSidebar and SettingsMobileNav render identical section lists from a single source"
    - "SettingsMobileNav shows icons matching the desktop sidebar"
    - "ModelSelector has no progress bars or download status awareness"
    - "ModelManagement uses ConfirmDialog instead of inline Dialog.Root"
    - "Deleting an active model shows a warning confirmation and reverts the selector on confirm"
  artifacts:
    - path: "frontend/src/lib/constants.ts"
      provides: "SETTINGS_SECTIONS shared array"
      contains: "SETTINGS_SECTIONS"
    - path: "frontend/src/components/settings/SettingsMobileNav.tsx"
      provides: "Chakra Select-based mobile nav with icons"
      contains: "Select.Root"
  key_links:
    - from: "frontend/src/components/settings/SettingsSidebar.tsx"
      to: "frontend/src/lib/constants.ts"
      via: "import"
      pattern: "import.*SETTINGS_SECTIONS"
    - from: "frontend/src/components/settings/SettingsMobileNav.tsx"
      to: "frontend/src/lib/constants.ts"
      via: "import"
      pattern: "import.*SETTINGS_SECTIONS"
    - from: "frontend/src/components/settings/ModelManagement.tsx"
      to: "frontend/src/components/ui/confirm-dialog"
      via: "import"
      pattern: "import.*ConfirmDialog"
    - from: "frontend/src/components/settings/OllamaSection.tsx"
      to: "frontend/src/components/settings/ModelManagement.tsx"
      via: "onConfigChange prop"
      pattern: "onConfigChange"
---

<objective>
Clean up the Ollama settings section (ConfirmDialog, progress bar removal, active model delete) and overhaul the settings navigation (shared sections array, Chakra Select mobile nav with icons).

Purpose: Apply Themes C (Ollama section cleanup) and E (mobile nav overhaul) from the 09.3 audit -- simplify ModelSelector, use consistent dialogs, and unify the settings navigation data source.
Output: Shared SETTINGS_SECTIONS array, Chakra Select mobile nav, simplified ModelSelector, ConfirmDialog in ModelManagement.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09.4-settings-page-architecture-implementation/09.4-RESEARCH.md
@.planning/phases/09.4-settings-page-architecture-implementation/09.4-01-SUMMARY.md

@frontend/src/lib/constants.ts
@frontend/src/components/settings/SettingsSidebar.tsx
@frontend/src/components/settings/SettingsMobileNav.tsx
@frontend/src/components/settings/ModelManagement.tsx
@frontend/src/components/settings/ModelSelector.tsx
@frontend/src/components/settings/OllamaSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SETTINGS_SECTIONS and overhaul nav components</name>
  <files>
    frontend/src/lib/constants.ts
    frontend/src/components/settings/SettingsSidebar.tsx
    frontend/src/components/settings/SettingsMobileNav.tsx
  </files>
  <action>
**constants.ts** — Add to the existing constants file:

```typescript
export type SettingsSection = "general" | "feeds" | "interests" | "categories" | "ollama" | "feedback";

export interface SettingsSectionItem {
  id: SettingsSection;
  href: string;
  icon: React.ElementType;
  label: string;
}
```

Add `SETTINGS_SECTIONS` array with 6 entries: general (LuSettings), feeds (LuRss), interests (LuHeart), categories (LuTag), ollama (LuBot), feedback (LuMessageSquare). Import icons from `react-icons/lu`.

Note: The `React.ElementType` type requires a React import. Use `import type { ElementType } from "react"` and type icon as `ElementType` to avoid pulling in React runtime into the constants file.

**SettingsSidebar.tsx:**
- Remove local `SIDEBAR_ITEMS` array and local `SettingsSection` type
- Import `SETTINGS_SECTIONS` and `SettingsSection` from `@/lib/constants`
- Update the render loop to iterate over `SETTINGS_SECTIONS` instead of `SIDEBAR_ITEMS`
- Adjust property names if needed (the shared array uses `id` and `href` which should match the sidebar's Link pattern)

**SettingsMobileNav.tsx:**
- Replace `NativeSelect` with Chakra `Select.Root` + `Select.Control` + `Select.Trigger` + `Portal` + `Select.Positioner` + `Select.Content` pattern
- Import `SETTINGS_SECTIONS` from `@/lib/constants`
- Use `createListCollection` from `@chakra-ui/react` with `items: SETTINGS_SECTIONS`, `itemToString: (item) => item.label`, `itemToValue: (item) => item.id`
- Create a co-located `SectionValueText` sub-component that uses `useSelectContext` to render the selected item's icon + label in the trigger (see RESEARCH.md Pattern 8 for exact code)
- Each dropdown item renders icon + label in a `Flex alignItems="center" gap={2}`
- Value is `[activeSection]` (array), onValueChange navigates via `router.push(section.href)`
- Derive activeSection from `pathname.split("/").pop() ?? "general"`
- Remove local `SECTIONS` array
- Add `"general"` as a navigation target (was missing from the old NativeSelect)

Per RESEARCH.md Pitfall 2: `SectionValueText` MUST be rendered inside `Select.Root`, co-located in this file.
  </action>
  <verify>
TypeScript compiles: `cd frontend && bunx tsc --noEmit --pretty 2>&1 | head -30`. Grep for old arrays: `grep -n "SIDEBAR_ITEMS\|SECTIONS =" frontend/src/components/settings/Settings*.tsx` should return nothing (both removed). Verify SETTINGS_SECTIONS has 6 items: `grep -c "id:" frontend/src/lib/constants.ts` shows it increased.
  </verify>
  <done>SETTINGS_SECTIONS in constants.ts powers both SettingsSidebar and SettingsMobileNav. Mobile nav uses Chakra Select with icons. "general" item present in both nav components.</done>
</task>

<task type="auto">
  <name>Task 2: Simplify ModelSelector and migrate ModelManagement to ConfirmDialog</name>
  <files>
    frontend/src/components/settings/ModelManagement.tsx
    frontend/src/components/settings/ModelSelector.tsx
    frontend/src/components/settings/OllamaSection.tsx
  </files>
  <action>
**ModelSelector.tsx** — Per locked user decision: remove ALL download awareness from ModelSelector.
- Remove the `useQuery` for `downloadStatus` (the `fetchDownloadStatus` polling query)
- Remove `downloadingModel` and `downloadPct` derived values
- Remove all 3 inline progress bar `Box` blocks (after categorization dropdown, after scoring dropdown, after single model dropdown)
- Remove imports that become unused (`fetchDownloadStatus`, `DownloadStatus` type, `useQuery` if no longer needed)
- The component becomes a pure "pick from available models" selector with no download/progress awareness
- The `models` prop already provides the list of fully downloaded models. No behavior change needed for when the list updates — TanStack Query invalidation in ModelManagement already handles refreshing the models list after a pull completes.

**ModelManagement.tsx** — Two changes:

1. Replace inline `Dialog.Root` with `ConfirmDialog`:
   - Import `ConfirmDialog` from `@/components/ui/confirm-dialog`
   - Keep `deleteTarget` state (`string | null`)
   - The dialog body should differ based on whether the target model is currently active:
     - Not active: "Delete **{name}**? You can re-download it later."
     - Active: "Delete **{name}**? This model is currently selected -- it will be deselected. You can re-download it later."
   - `confirmLabel="Delete"`, `confirmColorPalette="red"`
   - Remove old `Dialog.Root`, `Dialog.Content`, etc. imports if no longer needed

2. Enable delete of active models (per locked user decision):
   - Remove the `canDelete` guard that prevents clicking Remove on active models
   - The Remove button should always be enabled — the ConfirmDialog warns the user instead
   - On confirm: delete the model, invalidate models query, then if the model was active in config, call `onConfigChange` with the relevant config field(s) set to `null`
   - The `handleDeleteConfirm` handler needs to know whether `deleteTarget` is active and which config field(s) it matches (see RESEARCH.md Pattern 9 for the implementation)

3. Add `onConfigChange` prop:
   - Add `onConfigChange: (config: OllamaConfig) => void` to the ModelManagement prop interface
   - Use it in `handleDeleteConfirm` when deleting an active model to revert config

**OllamaSection.tsx:**
- Pass `onConfigChange={handleConfigChange}` (or whatever the config save handler is named) to `<ModelManagement>`. This is the same handler used by ModelSelector for config changes.

Remove unused Dialog imports from ModelManagement.tsx. Clean up any unused imports across all three files.
  </action>
  <verify>
Run `cd frontend && bunx tsc --noEmit --pretty 2>&1 | head -40` for type check. Run `cd frontend && bun run lint 2>&1 | tail -20` for lint. Verify no progress bars in ModelSelector: `grep -n "progress\|Progress\|downloadStatus\|downloadPct\|downloadingModel" frontend/src/components/settings/ModelSelector.tsx` should return nothing. Verify ConfirmDialog in ModelManagement: `grep "ConfirmDialog" frontend/src/components/settings/ModelManagement.tsx`. Run `cd frontend && bun run build 2>&1 | tail -10` for production build.
  </verify>
  <done>ModelSelector is a pure model picker with no progress bars (SC6 replacement). ModelManagement uses ConfirmDialog for delete with active-model warning (SC5). SETTINGS_SECTIONS array in constants.ts (SC8). SettingsMobileNav uses Chakra Select with icons (SC9). No functional regressions — build passes (SC11).</done>
</task>

</tasks>

<verification>
1. `cd frontend && bun run build` succeeds
2. `grep -n "SETTINGS_SECTIONS" frontend/src/lib/constants.ts frontend/src/components/settings/SettingsSidebar.tsx frontend/src/components/settings/SettingsMobileNav.tsx` — all three files reference it
3. `grep -c "Select.Root" frontend/src/components/settings/SettingsMobileNav.tsx` returns 1
4. `grep -c "NativeSelect" frontend/src/components/settings/SettingsMobileNav.tsx` returns 0
5. `grep -c "downloadStatus\|downloadPct\|fetchDownloadStatus" frontend/src/components/settings/ModelSelector.tsx` returns 0
6. `grep -c "ConfirmDialog" frontend/src/components/settings/ModelManagement.tsx` returns at least 1
7. `grep "onConfigChange" frontend/src/components/settings/ModelManagement.tsx` shows the prop exists
</verification>

<success_criteria>
- ModelManagement uses ConfirmDialog instead of inline Dialog.Root (SC5)
- ModelSelector has no progress bars — pure model picker (replaces SC6)
- Shared SETTINGS_SECTIONS array in lib/constants.ts powers both nav components (SC8)
- SettingsMobileNav uses Chakra UI Select with icons matching desktop sidebar (SC9)
- No functional regressions — build passes (SC11)
</success_criteria>

<output>
After completion, create `.planning/phases/09.4-settings-page-architecture-implementation/09.4-03-SUMMARY.md`
</output>
