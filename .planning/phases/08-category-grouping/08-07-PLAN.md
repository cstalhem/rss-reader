---
phase: 08-category-grouping
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/settings/WeightPresets.tsx
  - frontend/src/components/settings/CategoryRow.tsx
  - frontend/src/components/settings/CategoryGroupAccordion.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Weight preset buttons render as a segmented control using Chakra Group attached prop"
    - "Child category weight preset buttons are the same size as parent group header buttons"
    - "No layout shift when the reset (undo) button appears or disappears"
    - "Category rows (both ungrouped and grouped) have subtle hover background highlight"
    - "Inherited weights show muted styling compared to overridden weights"
    - "Group parent row hover highlights the full row including weight buttons and delete button"
  artifacts:
    - path: "frontend/src/components/settings/WeightPresets.tsx"
      provides: "Attached button group, muted inherited styling, fixed-width reset space"
      contains: "Group"
    - path: "frontend/src/components/settings/CategoryRow.tsx"
      provides: "Matching button size, row hover highlight"
      contains: "bg.muted"
    - path: "frontend/src/components/settings/CategoryGroupAccordion.tsx"
      provides: "Full-row hover on group header"
      contains: "_hover"
  key_links:
    - from: "CategoryRow.tsx"
      to: "WeightPresets.tsx"
      via: "size='sm' prop"
      pattern: "size.*sm"
    - from: "CategoryGroupAccordion.tsx"
      to: "WeightPresets.tsx"
      via: "isOverridden prop for muted styling"
      pattern: "isOverridden"
---

<objective>
Fix weight preset button styling: attached segmented look, consistent sizing, no layout shift on reset button, hover highlights on all category rows, and muted inherited weight display.

Purpose: Five interrelated cosmetic/UX gaps from UAT feedback all centered on the weight preset buttons and category row hover behavior.
Output: Polished, consistent weight controls across ungrouped and grouped category rows.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/components/settings/WeightPresets.tsx
@frontend/src/components/settings/CategoryRow.tsx
@frontend/src/components/settings/CategoryGroupAccordion.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: WeightPresets attached group, muted inherited styling, and fixed reset space</name>
  <files>frontend/src/components/settings/WeightPresets.tsx</files>
  <action>
Three changes to WeightPresets:

1. **Attached button group**: Replace the `Flex gap={0.5}` wrapper around the 5 preset buttons with Chakra's `Group` component with the `attached` prop. Import `Group` from `@chakra-ui/react`. The Group+attached pattern fuses buttons into a segmented control by removing inner border-radius between adjacent buttons. Keep the outer Flex for alignment with the reset button.

Layout becomes:
```
<Flex alignItems="center" onClick={onClick}>
  <Group attached>
    {buttons}
  </Group>
  {reset button area}
</Flex>
```

2. **Muted inherited weight styling**: When `isOverridden` is explicitly `false` (meaning the weight is inherited from the group, not set by the user), reduce the opacity of the entire Group to 0.5. When `isOverridden` is `true` OR `isOverridden` is `undefined` (ungrouped categories where there's no group to inherit from), keep full opacity. Apply this as `opacity` on the `<Group>` element: `opacity={isOverridden === false ? 0.5 : 1}`.

3. **Fixed-width reset button space**: Always render the reset IconButton area, but make it invisible when not overridden. Replace the conditional `{isOverridden && onReset && (...)}` with an always-rendered Box of fixed width (e.g., `w="28px"` for xs, `w="32px"` for sm) containing the IconButton only when `isOverridden && onReset`. When not showing the button, render an empty Box of the same width. This prevents layout shift. Include `ml={0.5}` on the wrapper Box.

Note: The `isOverridden` prop is already defined as `boolean | undefined`. Ungrouped categories don't pass it (so it's `undefined`), grouped categories pass `true` or `false`. The muted styling should only trigger on explicit `false`.
  </action>
  <verify>
Run `bun run build --dir frontend` to confirm no build errors. Inspect: buttons should appear fused (no rounded corners between them), inherited weights should appear at reduced opacity, and toggling override should not cause layout shift.
  </verify>
  <done>Weight preset buttons render as attached segmented control, inherited weights are visually muted, and reset button space is reserved to prevent layout shift.</done>
</task>

<task type="auto">
  <name>Task 2: CategoryRow size matching and hover highlight, plus group header full-row hover</name>
  <files>
    frontend/src/components/settings/CategoryRow.tsx
    frontend/src/components/settings/CategoryGroupAccordion.tsx
  </files>
  <action>
Three changes across two files:

**CategoryRow.tsx:**

1. **Match parent button size**: Pass `size="sm"` to the WeightPresets component (line ~129). Currently it uses the default `size="xs"` which creates a size mismatch with the group header that uses `size="sm"`. All weight preset buttons should be the same size everywhere.

2. **Add row hover highlight**: Add `_hover={{ bg: "bg.muted" }}` to the outer Flex element (line ~64). This gives ungrouped and grouped category rows the same subtle hover effect that group headers already have. Also add `transition="background 0.15s"` for smooth transition.

**CategoryGroupAccordion.tsx:**

3. **Full-row hover on group header**: Currently the `_hover` style only applies to the `Accordion.ItemTrigger` (left side), not the right-side controls (WeightPresets + delete button). Fix by:
   - Moving the `_hover={{ bg: "bg.muted" }}` from the `Accordion.ItemTrigger` to the parent `Flex` (line ~117) that wraps both the trigger and the right-side controls.
   - Remove the `_hover` from `Accordion.ItemTrigger` to avoid double-hover effect.
   - Keep the `borderRadius="md"` on the parent Flex so the hover background has rounded corners.
   - Add `transition="background 0.15s"` to the parent Flex for smooth transition.
   - Keep the `isDragActive || isRenaming` guard on the hover: `_hover={{ bg: isDragActive || isRenaming ? undefined : "bg.muted" }}`.
  </action>
  <verify>
Run `bun run build --dir frontend` to confirm no build errors. Inspect: all weight preset buttons should be the same size. Hovering any category row (ungrouped or grouped) should show subtle background highlight. Hovering a group header should highlight the entire row including the right-side buttons.
  </verify>
  <done>Category row weight buttons match parent group size, all rows show hover highlight, and group header hover covers the full width.</done>
</task>

</tasks>

<verification>
- `bun run build --dir frontend` succeeds with no errors
- Weight presets render as attached segmented control
- All weight preset buttons are the same size (sm) across group headers and category rows
- No layout shift when reset button appears/disappears
- Category rows show hover highlight
- Inherited weights appear muted
- Group header hover covers full row
</verification>

<success_criteria>
- Weight preset buttons are visually fused into a segmented control
- Button sizes match between group headers and child rows
- Reset button area is fixed-width (no layout shift)
- All category rows have subtle hover highlight
- Inherited weights are visually distinct from overridden weights
- Group header hover highlights the complete row
</success_criteria>

<output>
After completion, create `.planning/phases/08-category-grouping/08-07-SUMMARY.md`
</output>
