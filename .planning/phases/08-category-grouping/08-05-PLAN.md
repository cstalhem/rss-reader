---
phase: 08-category-grouping
plan: 05
type: execute
wave: 4
depends_on: ["08-03"]
files_modified:
  - frontend/src/components/layout/Header.tsx
  - frontend/src/components/settings/CategoriesSection.tsx
autonomous: true

must_haves:
  truths:
    - "Settings gear icon in main UI header shows a dot badge when new categories exist"
    - "Categories sidebar item shows a count badge for new/returned categories"
    - "Topic Categories panel heading shows a count badge for new/returned categories"
    - "New categories show a 'New' labeled chip badge"
    - "Returned categories show a 'Returned' labeled chip badge"
    - "Badges are dismissed by setting weight, grouping, or clicking the badge"
  artifacts:
    - path: "frontend/src/components/layout/Header.tsx"
      provides: "Dot badge on settings gear icon when new categories exist"
      contains: "new-count"
    - path: "frontend/src/components/settings/CategoriesSection.tsx"
      provides: "Count badge next to Topic Categories heading"
      contains: "newCount"
  key_links:
    - from: "frontend/src/components/layout/Header.tsx"
      to: "frontend/src/lib/api.ts"
      via: "TanStack Query polling fetchNewCategoryCount"
      pattern: "fetchNewCategoryCount"
    - from: "frontend/src/components/settings/CategoriesSection.tsx"
      to: "frontend/src/hooks/useCategories.ts"
      via: "useCategories provides newCount and returnedCount"
      pattern: "newCount"
---

<objective>
Three-tier notification badges for new categories and New/Returned chip badges on category rows.

Purpose: Users need to be aware when the LLM discovers new categories or when previously removed categories reappear. This plan adds notification badges at three levels: gear icon dot, sidebar count, and panel heading count. It also ensures the New/Returned chip badges on category rows are properly wired to data and dismissible.

Output: Complete notification system for new and returned categories across the UI.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-category-grouping/08-CONTEXT.md
@.planning/phases/08-category-grouping/08-RESEARCH.md
@.planning/phases/08-category-grouping/08-03-SUMMARY.md
@frontend/src/components/layout/Header.tsx
@frontend/src/components/settings/SettingsSidebar.tsx
@frontend/src/components/settings/CategoriesSection.tsx
@frontend/src/hooks/useCategories.ts
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Gear icon dot badge and panel heading count badge</name>
  <files>
    frontend/src/components/layout/Header.tsx
    frontend/src/components/settings/CategoriesSection.tsx
  </files>
  <action>
**Header.tsx** -- Add a small round dot badge on the settings gear icon when new categories exist.

Import `useQuery` from `@tanstack/react-query` and `fetchNewCategoryCount` from `@/lib/api`. Import `Circle` (or use `Box`) from `@chakra-ui/react`.

Add a query inside the Header component:
```typescript
const { data: newCatCount } = useQuery({
  queryKey: ["categories", "new-count"],
  queryFn: fetchNewCategoryCount,
  refetchInterval: 30000, // Poll every 30s
});
const hasNewCategories = (newCatCount?.count ?? 0) + (newCatCount?.returned_count ?? 0) > 0;
```

Wrap the settings `Link` + `IconButton` in a `Box` with `position="relative"`. Add a conditional dot:
```typescript
{hasNewCategories && (
  <Box
    position="absolute"
    top="4px"
    right="4px"
    width="8px"
    height="8px"
    borderRadius="full"
    bg="accent.solid"
  />
)}
```

Per user decision: dot only (no count number), positioned at top-right corner of the gear icon button.

**CategoriesSection.tsx** -- Add a count badge next to the "Topic Categories" heading.

The `useCategories` hook already provides `newCount` and `returnedCount`. Show a combined count badge next to the heading when the total is > 0:

```typescript
<Flex alignItems="center" gap={2}>
  <Text fontSize="xl" fontWeight="semibold">
    Topic Categories
  </Text>
  {(newCount + returnedCount) > 0 && (
    <Badge colorPalette="accent" size="sm">
      {newCount + returnedCount}
    </Badge>
  )}
</Flex>
```

Also ensure the New/Returned chip badges on CategoryRow are properly wired:
- Determine which categories are "new": categories in `allCategories` that are NOT in `categoryGroups.seen_categories`. Pass these as a `Set<string>` to CategoryRow.
- Determine which categories are "returned": categories in `categoryGroups.returned_categories`. Pass these as a `Set<string>` to CategoryRow.
- When a badge is dismissed (clicked), call `acknowledge` mutation with that category name. This adds it to `seen_categories` and removes from `returned_categories` on the backend.
- Per user decision, badges are also dismissed when: setting a weight (the weight change handler should also call acknowledge), or grouping the category (the create group handler should also acknowledge selected categories).

Ensure the "Returned" badge is visually distinct from "New":
- "New" badge: `Badge` with `colorPalette="accent"`, label "New"
- "Returned" badge: `Badge` with `colorPalette="yellow"` or a neutral/gray palette, label "Returned"
  </action>
  <verify>
Run `cd /Users/cstalhem/projects/rss-reader/frontend && bunx tsc --noEmit` -- no type errors.
Run `cd /Users/cstalhem/projects/rss-reader/frontend && bun run lint` -- no lint errors.
Run `cd /Users/cstalhem/projects/rss-reader/frontend && bun run build` -- production build succeeds.
  </verify>
  <done>
- Gear icon shows orange dot when new or returned categories exist
- Dot disappears when all categories are acknowledged
- Categories sidebar item shows count badge (already added in Plan 02)
- Topic Categories heading shows count badge
- New categories show "New" badge (accent colored)
- Returned categories show "Returned" badge (yellow/distinct color)
- Badges dismiss on click, on weight change, and on grouping
- 30s polling keeps badge counts current
- Production build succeeds
  </done>
</task>

</tasks>

<verification>
- `bunx tsc --noEmit` passes
- `bun run build` succeeds
- Header shows dot badge on gear icon when new categories exist
- Categories sidebar item shows count badge
- Topic Categories heading shows count badge
- New/Returned badges appear on correct categories
- Badges are dismissible
</verification>

<success_criteria>
- Three-tier notification system complete (gear dot, sidebar count, panel count)
- New and Returned badges visually distinct
- Badges dismiss correctly through multiple interaction paths
- Clean TypeScript build
</success_criteria>

<output>
After completion, create `.planning/phases/08-category-grouping/08-05-SUMMARY.md`
</output>
