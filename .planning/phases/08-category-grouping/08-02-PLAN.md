---
phase: 08-category-grouping
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - frontend/src/lib/types.ts
  - frontend/src/lib/api.ts
  - frontend/src/hooks/useCategories.ts
  - frontend/src/hooks/usePreferences.ts
  - frontend/src/components/settings/SettingsSidebar.tsx
  - frontend/src/components/settings/InterestsSection.tsx
  - frontend/src/app/settings/page.tsx
autonomous: true

must_haves:
  truths:
    - "Settings sidebar shows 5 items: Feeds, Interests, Categories, Ollama, Feedback"
    - "Interests section only shows text areas (no category weights)"
    - "Categories section exists as a separate settings tab"
    - "Frontend types and API functions cover all new backend endpoints"
  artifacts:
    - path: "frontend/src/lib/types.ts"
      provides: "CategoryGroup, CategoryGroups interfaces"
      contains: "CategoryGroup"
    - path: "frontend/src/lib/api.ts"
      provides: "API functions for category group endpoints"
      contains: "fetchCategoryGroups"
    - path: "frontend/src/hooks/useCategories.ts"
      provides: "useCategories hook for category group state management"
      contains: "useCategories"
    - path: "frontend/src/components/settings/SettingsSidebar.tsx"
      provides: "5 sidebar items including Categories with count badge"
      contains: "categories"
    - path: "frontend/src/components/settings/InterestsSection.tsx"
      provides: "Interests-only section without category weights"
    - path: "frontend/src/app/settings/page.tsx"
      provides: "Settings page with CategoriesSection placeholder"
      contains: "CategoriesSection"
  key_links:
    - from: "frontend/src/hooks/useCategories.ts"
      to: "frontend/src/lib/api.ts"
      via: "TanStack Query fetching category groups and new-count"
      pattern: "useQuery.*categoryGroups"
    - from: "frontend/src/app/settings/page.tsx"
      to: "frontend/src/components/settings/SettingsSidebar.tsx"
      via: "SettingsSection type now includes 'categories'"
      pattern: "categories"
---

<objective>
Frontend foundation: TypeScript types, API client functions, useCategories hook, settings sidebar restructure, and InterestsSection split.

Purpose: Establish all the frontend plumbing that the Categories UI components (Plan 03/04) will consume. Split the existing InterestsSection into Interests-only, add the Categories sidebar item, and wire up the data layer.

Output: Working settings page with 5 sidebar items, Interests section trimmed to text areas only, Categories section placeholder ready for Plan 03.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-category-grouping/08-CONTEXT.md
@.planning/phases/08-category-grouping/08-RESEARCH.md
@.planning/phases/08-category-grouping/08-01-SUMMARY.md
@frontend/src/lib/types.ts
@frontend/src/lib/api.ts
@frontend/src/hooks/usePreferences.ts
@frontend/src/components/settings/SettingsSidebar.tsx
@frontend/src/components/settings/InterestsSection.tsx
@frontend/src/app/settings/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: TypeScript types, API client functions, and useCategories hook</name>
  <files>
    frontend/src/lib/types.ts
    frontend/src/lib/api.ts
    frontend/src/hooks/useCategories.ts
    frontend/src/hooks/usePreferences.ts
  </files>
  <action>
**types.ts** -- Add new interfaces:
```typescript
export interface CategoryGroup {
  id: string;
  name: string;
  weight: string; // "block" | "reduce" | "normal" | "boost" | "max"
  categories: string[];
}

export interface CategoryGroups {
  groups: CategoryGroup[];
  hidden_categories: string[];
  seen_categories: string[];
  returned_categories: string[];
}
```

Update `UserPreferences` to include:
```typescript
category_groups: CategoryGroups | null;
```

**api.ts** -- Add 6 new API functions matching the backend endpoints:
1. `fetchCategoryGroups(): Promise<CategoryGroups>` -- GET /api/categories/groups
2. `saveCategoryGroups(data: CategoryGroups): Promise<CategoryGroups>` -- PUT /api/categories/groups
3. `hideCategory(name: string): Promise<CategoryGroups>` -- PATCH /api/categories/{name}/hide
4. `unhideCategory(name: string): Promise<CategoryGroups>` -- PATCH /api/categories/{name}/unhide
5. `fetchNewCategoryCount(): Promise<{count: number; returned_count: number}>` -- GET /api/categories/new-count
6. `acknowledgeCategories(categories: string[]): Promise<{ok: boolean}>` -- POST /api/categories/acknowledge

Follow the existing API function pattern (fetch, check response.ok, throw on error, return json).

**useCategories.ts** -- Create new hook:
```typescript
export function useCategories() {
  // Query for category groups (the main data)
  const groupsQuery = useQuery({
    queryKey: ["categoryGroups"],
    queryFn: fetchCategoryGroups,
  });

  // Query for all known categories (existing endpoint)
  const categoriesQuery = useQuery({
    queryKey: ["categories"],
    queryFn: fetchCategories,
  });

  // Query for new category count (for badges)
  const newCountQuery = useQuery({
    queryKey: ["categories", "new-count"],
    queryFn: fetchNewCategoryCount,
    refetchInterval: 30000, // Poll every 30s for new categories
  });

  // Mutation: save full category groups structure
  const saveGroupsMutation = useMutation({
    mutationFn: saveCategoryGroups,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["categoryGroups"] });
      queryClient.invalidateQueries({ queryKey: ["preferences"] });
    },
  });

  // Mutation: hide category
  const hideMutation = useMutation({
    mutationFn: hideCategory,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["categoryGroups"] });
      queryClient.invalidateQueries({ queryKey: ["categories", "new-count"] });
      queryClient.invalidateQueries({ queryKey: ["preferences"] });
    },
  });

  // Mutation: unhide category
  const unhideMutation = useMutation({
    mutationFn: unhideCategory,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["categoryGroups"] });
      queryClient.invalidateQueries({ queryKey: ["categories", "new-count"] });
    },
  });

  // Mutation: acknowledge new categories (dismiss badges)
  const acknowledgeMutation = useMutation({
    mutationFn: acknowledgeCategories,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["categories", "new-count"] });
      queryClient.invalidateQueries({ queryKey: ["categoryGroups"] });
    },
  });

  // Derive computed values:
  // - allCategories: all known category strings
  // - ungroupedCategories: categories not in any group and not hidden
  // - newCount / returnedCount: from newCountQuery

  return {
    categoryGroups: groupsQuery.data,
    allCategories: categoriesQuery.data || [],
    newCount: newCountQuery.data?.count ?? 0,
    returnedCount: newCountQuery.data?.returned_count ?? 0,
    isLoading: groupsQuery.isLoading || categoriesQuery.isLoading,
    saveGroups: saveGroupsMutation.mutate,
    hideCategory: hideMutation.mutate,
    unhideCategory: unhideMutation.mutate,
    acknowledge: acknowledgeMutation.mutate,
    isSaving: saveGroupsMutation.isPending,
  };
}
```

**usePreferences.ts** -- Remove the `categoriesQuery` and `updateCategoryWeight` from this hook since categories are now managed by the dedicated `useCategories` hook. The `usePreferences` hook should only return preferences data, `updatePreferences`, and `isUpdating`. The `categories` return value and `updateCategoryWeight` are no longer needed here (the old weight buttons are being replaced).
  </action>
  <verify>
Run `cd /Users/cstalhem/projects/rss-reader/frontend && bunx tsc --noEmit` -- no type errors.
  </verify>
  <done>
- CategoryGroup and CategoryGroups types defined
- UserPreferences type includes category_groups
- 6 API functions created for category management
- useCategories hook provides all data and mutations for category UI
- usePreferences hook trimmed to interests-only concerns
  </done>
</task>

<task type="auto">
  <name>Task 2: Settings sidebar restructure and InterestsSection split</name>
  <files>
    frontend/src/components/settings/SettingsSidebar.tsx
    frontend/src/components/settings/InterestsSection.tsx
    frontend/src/components/settings/CategoriesSection.tsx
    frontend/src/app/settings/page.tsx
  </files>
  <action>
**SettingsSidebar.tsx** -- Update `SettingsSection` type to include `"categories"`:
```typescript
export type SettingsSection = "feeds" | "interests" | "categories" | "ollama" | "feedback";
```

Update `SIDEBAR_ITEMS` to add Categories between Interests and Ollama:
```typescript
const SIDEBAR_ITEMS: SidebarItem[] = [
  { id: "feeds", icon: LuRss, label: "Feeds" },
  { id: "interests", icon: LuHeart, label: "Interests" },
  { id: "categories", icon: LuTag, label: "Categories" },
  { id: "ollama", icon: LuBot, label: "Ollama" },
  { id: "feedback", icon: LuMessageSquare, label: "Feedback" },
];
```

Import `LuTag` from `react-icons/lu`.

Add a count badge on the Categories sidebar item when there are new/returned categories. Import `fetchNewCategoryCount` and use a TanStack Query to poll for the count. Show a `Badge` with `ml="auto"` and `colorPalette="accent"` and `size="sm"` next to the label, matching the Ollama download indicator positioning. Show the combined count (new + returned). The query key should be `["categories", "new-count"]` (same as in useCategories so they share cache).

**InterestsSection.tsx** -- Remove the entire "Topic Categories Section" (everything from `{/* Topic Categories Section */}` to the end of the Stack). Remove `WEIGHT_OPTIONS`, `categories` from usePreferences, `handleWeightChange`, `getCategoryWeight`, and the `LuTag` import. Keep only the "Interest Preferences" section with the two text areas and save button. Update `usePreferences` import to not destructure `categories` or `updateCategoryWeight` (since they were removed from the hook in Task 1).

**CategoriesSection.tsx** -- Create a minimal placeholder component that will be filled in by Plan 03. For now, just render a panel card with "Topic Categories" heading and an empty state message. Use the multi-panel card pattern from OllamaSection (bg.subtle card with border).

```typescript
"use client";

import { Box, Flex, Stack, Text } from "@chakra-ui/react";
import { LuTag } from "react-icons/lu";
import { useCategories } from "@/hooks/useCategories";
import { Skeleton } from "@chakra-ui/react";

export function CategoriesSection() {
  const { allCategories, isLoading } = useCategories();

  if (isLoading) {
    return (
      <Stack gap={4}>
        <Skeleton height="200px" variant="shine" />
      </Stack>
    );
  }

  return (
    <Stack gap={8}>
      <Box>
        <Text fontSize="xl" fontWeight="semibold" mb={2}>
          Topic Categories
        </Text>
        <Text color="fg.muted" mb={6}>
          Organize categories into groups and set weights to tune your article scores
        </Text>

        {allCategories.length === 0 ? (
          <Flex
            direction="column"
            alignItems="center"
            justifyContent="center"
            gap={4}
            p={8}
            bg="bg.subtle"
            borderRadius="md"
            borderWidth="1px"
            borderColor="border.subtle"
          >
            <LuTag size={40} color="var(--chakra-colors-fg-subtle)" />
            <Text color="fg.muted" textAlign="center">
              Categories will appear here once articles are scored by the LLM
            </Text>
          </Flex>
        ) : (
          <Text color="fg.muted">
            {allCategories.length} categories discovered. Full management UI coming in next plan.
          </Text>
        )}
      </Box>
    </Stack>
  );
}
```

**settings/page.tsx** -- Import `CategoriesSection` and add it to both the mobile stacked view and the desktop tab view, between InterestsSection and OllamaSection. Follow the exact same pattern as the other sections (Box with display toggled by activeSection).
  </action>
  <verify>
Run `cd /Users/cstalhem/projects/rss-reader/frontend && bunx tsc --noEmit` -- no type errors.
Run `cd /Users/cstalhem/projects/rss-reader/frontend && bun run lint` -- no lint errors.
Run `cd /Users/cstalhem/projects/rss-reader/frontend && bun run build` -- production build succeeds.
  </verify>
  <done>
- Settings sidebar shows 5 items in correct order: Feeds, Interests, Categories, Ollama, Feedback
- Categories sidebar item shows count badge when new categories exist
- InterestsSection only contains text areas and save button (no category weights)
- CategoriesSection placeholder renders with loading skeleton and empty state
- Settings page routes to CategoriesSection when "categories" tab is active
- TypeScript builds clean, no lint errors
  </done>
</task>

</tasks>

<verification>
- `bunx tsc --noEmit` passes with no type errors
- `bun run build` succeeds
- Settings page renders 5 sidebar items
- Clicking Categories shows the placeholder section
- InterestsSection no longer shows category weight buttons
</verification>

<success_criteria>
- Frontend data layer complete: types, API functions, useCategories hook
- Settings page restructured with 5 sections
- InterestsSection trimmed to text areas only
- CategoriesSection placeholder ready for Plan 03
- Clean TypeScript build
</success_criteria>

<output>
After completion, create `.planning/phases/08-category-grouping/08-02-SUMMARY.md`
</output>
