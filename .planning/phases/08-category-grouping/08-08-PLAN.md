---
phase: 08-category-grouping
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/settings/CategoryGroupAccordion.tsx
  - frontend/src/components/settings/CategoriesSection.tsx
  - frontend/src/components/settings/CategoryRow.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Group rename uses hover-reveal edit button instead of double-click interaction"
    - "Edit and delete buttons on group header are both hover-reveal and visually grouped"
    - "Dragging a category into a new container shows a placeholder row in the destination"
    - "New/Returned badge chips show a hover-reveal X icon on the left for dismiss affordance"
  artifacts:
    - path: "frontend/src/components/settings/CategoryGroupAccordion.tsx"
      provides: "Hover-reveal edit+delete button group replacing double-click rename"
      contains: "LuPencil"
    - path: "frontend/src/components/settings/CategoriesSection.tsx"
      provides: "Drag placeholder rendered in destination container during drag"
      contains: "placeholder"
    - path: "frontend/src/components/settings/CategoryRow.tsx"
      provides: "Badge with hover-reveal X icon on left"
      contains: "LuX"
  key_links:
    - from: "CategoriesSection.tsx"
      to: "CategoryGroupAccordion.tsx"
      via: "activeId and activeCategoryName passed for placeholder rendering"
      pattern: "activeId"
---

<objective>
Replace double-click group rename with hover-reveal edit button, add drag placeholder in destination containers, and add dismiss icon to new/returned badge chips.

Purpose: Three distinct UX improvements from UAT feedback -- rename interaction is awkward (conflicts with accordion toggle), drag destination lacks visual feedback, and badge dismiss affordance is invisible.
Output: Polished group management and badge interaction UX.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/components/settings/CategoryGroupAccordion.tsx
@frontend/src/components/settings/CategoriesSection.tsx
@frontend/src/components/settings/CategoryRow.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Hover-reveal edit button for group rename and badge dismiss X icon</name>
  <files>
    frontend/src/components/settings/CategoryGroupAccordion.tsx
    frontend/src/components/settings/CategoryRow.tsx
  </files>
  <action>
**CategoryGroupAccordion.tsx -- Replace double-click rename with hover-reveal edit button:**

1. Add `isHovered` state: `const [isHovered, setIsHovered] = useState(false);`
2. Add `onMouseEnter={() => setIsHovered(true)}` and `onMouseLeave={() => setIsHovered(false)}` on the outermost `Flex` wrapper (the one that contains both the ItemTrigger and the right-side controls).
3. Remove the `onDoubleClick` handler from the group name `Text` element.
4. Remove the `onTouchStart`, `onTouchEnd`, `onTouchMove` long-press handlers from the `Text` element and delete the `longPressTimer` state.
5. Import `LuPencil` from `react-icons/lu` alongside the existing `LuTrash2`.
6. In the right-side `Flex pr={2} gap={1}` area, add an edit `IconButton` before the delete button:
   ```tsx
   <IconButton
     aria-label="Rename group"
     size="xs"
     variant="ghost"
     onClick={(e) => {
       e.stopPropagation();
       setRenameValue(group.name);
       setIsRenaming(true);
     }}
     opacity={{ base: 1, md: isHovered ? 1 : 0 }}
     transition="opacity 0.15s"
   >
     <LuPencil size={14} />
   </IconButton>
   ```
7. Apply the same opacity-based hover-reveal pattern to the existing delete `IconButton`:
   - Add `opacity={{ base: 1, md: isHovered ? 1 : 0 }}` and `transition="opacity 0.15s"`.
   - This makes both edit and delete buttons appear on hover, matching the CategoryRow hide button pattern.

**CategoryRow.tsx -- Badge dismiss X icon:**

1. The `isHovered` state already exists (used for the hide button).
2. Update the "New" Badge to include a hover-reveal X icon on the LEFT side of the text. Use a Flex inside the Badge:
   ```tsx
   <Badge colorPalette="accent" size="sm" cursor="pointer" onClick={...}>
     <Flex alignItems="center" gap={0.5}>
       <Box
         as="span"
         display="inline-flex"
         opacity={{ base: 1, md: isHovered ? 1 : 0 }}
         transition="opacity 0.15s"
         w={isHovered ? "auto" : "0px"}
         overflow="hidden"
       >
         <LuX size={10} />
       </Box>
       New
     </Flex>
   </Badge>
   ```
   Actually, to avoid layout shift, reserve fixed space for the icon instead of toggling width. Use a simpler approach: always render the icon but control opacity only. The icon is small enough (10px) that it won't meaningfully increase badge width:
   ```tsx
   <Badge colorPalette="accent" size="sm" cursor="pointer" onClick={...}>
     <Flex alignItems="center" gap={0.5}>
       <LuX size={10} style={{ opacity: isHovered ? 1 : 0, transition: "opacity 0.15s" }} />
       New
     </Flex>
   </Badge>
   ```
3. Apply the same pattern to the "Returned" Badge.
4. `LuX` is already imported (used for the hide button icon).
  </action>
  <verify>
Run `bun run build --dir frontend` to confirm no build errors. Inspect: hovering a group header should reveal pencil and trash icons. Clicking pencil should enter rename mode. Hovering a category row with a New/Returned badge should reveal a small X icon on the left side of the badge.
  </verify>
  <done>Group rename uses hover-reveal edit button (no double-click), edit and delete buttons are both hover-reveal, and New/Returned badges show hover-reveal X dismiss icon.</done>
</task>

<task type="auto">
  <name>Task 2: Drag placeholder preview in destination containers</name>
  <files>
    frontend/src/components/settings/CategoriesSection.tsx
    frontend/src/components/settings/CategoryGroupAccordion.tsx
  </files>
  <action>
When a category is being dragged and hovering over a destination container (group or ungrouped list), render a ghost placeholder row showing where the category will land.

**CategoriesSection.tsx:**

1. Pass `activeId` (the currently dragged category name) and the `isDragActive` boolean to both `CategoryGroupAccordion` and `UngroupedDroppable` components.
2. Update the `UngroupedDroppable` component to accept `activeId: string | null` and render a placeholder when `isOver && activeId`:
   ```tsx
   {isOver && activeId && (
     <Box
       p={2}
       bg="bg.muted"
       borderRadius="sm"
       borderWidth="1px"
       borderStyle="dashed"
       borderColor="border.subtle"
       opacity={0.5}
     >
       <Text fontSize="sm" color="fg.muted">{toTitleCase(activeId)}</Text>
     </Box>
   )}
   ```
   Render this placeholder at the end of the Stack inside UngroupedDroppable.

**CategoryGroupAccordion.tsx:**

3. Add `activeId: string | null` to the component props interface.
4. Inside the droppable Box (the one with `ref={setNodeRef}`), when `isOver && activeId` and the activeId is NOT already in this group's categories, render the same dashed placeholder at the end of the Stack:
   ```tsx
   {isOver && activeId && !group.categories.includes(activeId) && (
     <Box
       p={2}
       bg="bg.muted"
       borderRadius="sm"
       borderWidth="1px"
       borderStyle="dashed"
       borderColor="border.subtle"
       opacity={0.5}
     >
       <Text fontSize="sm" color="fg.muted">{toTitleCase(activeId)}</Text>
     </Box>
   )}
   ```
5. Back in CategoriesSection.tsx, pass `activeId={activeId}` to each `CategoryGroupAccordion`.
  </action>
  <verify>
Run `bun run build --dir frontend` to confirm no build errors. Inspect: dragging a category over a group or the ungrouped list should show a dashed placeholder row with the category name at the bottom of the destination container.
  </verify>
  <done>Destination containers show a dashed ghost placeholder row when a category is dragged over them, giving clear visual feedback of where the drop will land.</done>
</task>

</tasks>

<verification>
- `bun run build --dir frontend` succeeds with no errors
- Group rename triggered by hover-reveal edit button, not double-click
- Edit and delete buttons both follow opacity hover-reveal pattern
- Drag placeholder appears in destination containers during drag
- New/Returned badges show X icon on hover
</verification>

<success_criteria>
- No double-click or long-press interaction for group rename
- Edit and delete buttons are hover-reveal on group headers
- Drag destination shows placeholder preview
- Badge dismiss has visible X affordance on hover
</success_criteria>

<output>
After completion, create `.planning/phases/08-category-grouping/08-08-SUMMARY.md`
</output>
