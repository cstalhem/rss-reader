---
phase: 08.2-category-data-model-refactor
plan: 06
subsystem: frontend-settings
tags: [gap-closure, uat-fix, optimistic-ui, hover-reveal]
dependency_graph:
  requires: [CATGRP-01, CATGRP-04]
  provides: [instant-weight-feedback, discoverable-actions, badge-lifecycle]
  affects: [category-settings-panel, new-category-badge]
tech_stack:
  added: []
  patterns: [local-optimistic-state, react-hover-state]
key_files:
  created: []
  modified:
    - frontend/src/components/settings/WeightPresetStrip.tsx
    - frontend/src/hooks/useCategories.ts
    - frontend/src/components/settings/CategoryChildRow.tsx
    - frontend/src/components/settings/CategoryParentRow.tsx
decisions:
  - "Local optimistic state in WeightPresetStrip with useEffect sync for instant visual feedback"
  - "Auto-acknowledge (is_seen: true) on weight change in useCategories wrapper"
  - "React state-driven hover reveal replaces broken _groupHover patterns"
metrics:
  duration_minutes: 2.9
  tasks_completed: 2
  files_modified: 4
  commits: 2
  completed_date: "2026-02-17"
---

# Phase 08.2 Plan 06: Settings Panel UI Gap Closure

**One-liner:** Instant weight button feedback, React state-driven hover-reveal for actions, and auto-acknowledge on weight change

## Overview

Fixed three UAT-reported gaps in the categories settings UI: (1) slow optimistic weight updates causing delayed button visual state, (2) undiscoverable hover-reveal rename/delete buttons due to broken `_groupHover` CSS, and (3) badge dismiss not working on weight change.

## What Was Built

### Task 1: Local Optimistic State and Auto-Acknowledge

**Files:** `WeightPresetStrip.tsx`, `useCategories.ts`

**Issue A — Weight button visual delay:**
Added local optimistic state (`localValue`) to `WeightPresetStrip` component. On button click:
1. `setLocalValue(option.value)` updates button visual state in the same frame (synchronous)
2. `onChange(option.value)` triggers mutation chain (async)
3. `useEffect` syncs `localValue` from `value` prop when server data arrives
4. On error, existing `onError` reverts cache → updates prop → `useEffect` syncs visual state back

**Issue B — Missing auto-acknowledge:**
Modified `updateCategory` wrapper in `useCategories` to auto-inject `is_seen: true` when `data.weight !== undefined`.

**Issue C — Missing new-count invalidation:**
Added `["categories", "new-count"]` to `updateCategoryMutation.onSettled` invalidation queries.

**Commit:** 2a440dd

### Task 2: React State-Driven Hover Reveal

**Files:** `CategoryChildRow.tsx`, `CategoryParentRow.tsx`

**Root cause:** `_groupHover` CSS pseudo-class was not reliably triggering on row hover, causing rename/delete buttons and badge X icon to remain hidden.

**Fix:** Replaced all `_groupHover` patterns with React state-driven hover matching the `WeightPresetStrip` reference pattern:
1. Added `isHovered` state to both components
2. Attached `onMouseEnter={() => setIsHovered(true)}` and `onMouseLeave={() => setIsHovered(false)}` to outer row Flex
3. Replaced `_groupHover={{ maxW: "..." }}` with `maxW={{ md: isHovered ? "..." : "0" }}`
4. Applied to:
   - CategoryChildRow: rename/delete/hide buttons wrapper (110px) + badge X icon wrapper (20px)
   - CategoryParentRow: rename/delete buttons wrapper (80px)

**Commit:** 6f1f962

## Verification

- [x] TypeScript compiles with zero errors (`npx tsc --noEmit`)
- [x] Production build succeeds (`bun run build`)
- [x] No `_groupHover` patterns remain in CategoryChildRow or CategoryParentRow
- [x] `useCategories.updateCategory` wrapper includes `is_seen: true` when weight is present
- [x] `updateCategoryMutation.onSettled` invalidates `["categories", "new-count"]`
- [x] `WeightPresetStrip` uses `localValue` state with `useEffect` sync from `value` prop

## Deviations from Plan

None — plan executed exactly as written.

## Technical Decisions

**1. Local optimistic state with useEffect sync pattern**
The button must own its immediate visual state to avoid async gap. `useEffect` sync from prop ensures state stays aligned with server truth and handles error rollback automatically via existing `onError` path.

**2. React state-driven hover over CSS _groupHover**
`_groupHover` pseudo-class was unreliable (likely Chakra UI v3 implementation issue or specificity conflict). React state-driven hover via `onMouseEnter`/`onMouseLeave` is explicit, testable, and matches the working `WeightPresetStrip` pattern.

**3. Auto-acknowledge in wrapper function**
Injecting `is_seen: true` in the `updateCategory` wrapper (not in `onMutate`) keeps the business logic in one place and ensures all weight changes trigger acknowledgment without duplicating code in every call site.

## Impact

**User-facing improvements:**
- Weight preset buttons flip visual state instantly on click (no perceived delay)
- Rename and delete buttons discoverable on row hover for both parent and child categories
- Badge X icon appears on row hover for easy dismissal
- Badge auto-dismisses when category weight is changed

**Code quality:**
- Zero `_groupHover` usage in settings components (removed brittle CSS pattern)
- Centralized auto-acknowledge logic in `useCategories` hook
- Consistent hover-reveal pattern across all settings rows

## Self-Check

**Verification:**

```bash
# Check created/modified files exist
[ -f "frontend/src/components/settings/WeightPresetStrip.tsx" ] && echo "FOUND"
[ -f "frontend/src/hooks/useCategories.ts" ] && echo "FOUND"
[ -f "frontend/src/components/settings/CategoryChildRow.tsx" ] && echo "FOUND"
[ -f "frontend/src/components/settings/CategoryParentRow.tsx" ] && echo "FOUND"

# Check commits exist
git log --oneline --all | grep -q "2a440dd" && echo "FOUND: 2a440dd"
git log --oneline --all | grep -q "6f1f962" && echo "FOUND: 6f1f962"
```

**Result:**
FOUND: frontend/src/components/settings/WeightPresetStrip.tsx
FOUND: frontend/src/hooks/useCategories.ts
FOUND: frontend/src/components/settings/CategoryChildRow.tsx
FOUND: frontend/src/components/settings/CategoryParentRow.tsx
FOUND: 2a440dd
FOUND: 6f1f962

## Self-Check: PASSED
