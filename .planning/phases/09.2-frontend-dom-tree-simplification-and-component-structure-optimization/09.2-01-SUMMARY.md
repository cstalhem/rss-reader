---
phase: 09.2-frontend-dom-tree-simplification-and-component-structure-optimization
plan: 01
subsystem: ui
tags: [next.js, app-router, nested-routes, settings, navigation]

# Dependency graph
requires:
  - phase: 09.1-backend-codebase-evaluation-simplification
    provides: stable backend API routes consumed by settings sections
provides:
  - Settings page using App Router nested routes (/settings/feeds, /settings/interests, /settings/categories, /settings/ollama, /settings/feedback)
  - SettingsSidebar as Link-based nav with usePathname active state
  - SettingsMobileNav client component for mobile section dropdown
  - OllamaSection without isVisible prop
affects: [09.2-02, 09.2-03]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Nested App Router layout pattern: layout.tsx server component shell + per-section page.tsx files"
    - "Mobile nav extracted as thin client component to keep layout.tsx a server component"
    - "Link-based sidebar navigation with usePathname for active state (replaces onClick+useState)"

key-files:
  created:
    - frontend/src/app/settings/layout.tsx
    - frontend/src/app/settings/feeds/page.tsx
    - frontend/src/app/settings/interests/page.tsx
    - frontend/src/app/settings/categories/page.tsx
    - frontend/src/app/settings/ollama/page.tsx
    - frontend/src/app/settings/feedback/page.tsx
    - frontend/src/components/settings/SettingsMobileNav.tsx
  modified:
    - frontend/src/app/settings/page.tsx
    - frontend/src/components/settings/SettingsSidebar.tsx
    - frontend/src/components/settings/OllamaSection.tsx

key-decisions:
  - "settings/layout.tsx is a server component — SettingsMobileNav and SettingsSidebar carry the client boundaries"
  - "SettingsMobileNav extracts mobile dropdown as a client component to avoid marking layout.tsx as 'use client'"
  - "OllamaSection always passes true to useOllamaHealth — component is only mounted at /settings/ollama so mount == visible"
  - "Per-section page files import section components directly — no 'use client' needed since section components declare their own boundaries"

patterns-established:
  - "App Router nested route structure for settings: layout + redirect page + per-section pages"
  - "Thin client component extraction pattern to preserve server component layout"

requirements-completed: []

# Metrics
duration: 15min
completed: 2026-02-20
---

# Phase 09.2 Plan 01: Settings Route Structure Summary

**Settings page converted from monolithic client component to App Router nested routes with server component layout, Link-based sidebar, and per-section page files**

## Performance

- **Duration:** ~15 min
- **Started:** 2026-02-20T20:07:50Z
- **Completed:** 2026-02-20T20:22:00Z
- **Tasks:** 2
- **Files modified:** 10

## Accomplishments

- Settings page restructured as App Router nested routes — each section has its own URL and only mounts when active
- `settings/layout.tsx` is now a server component, pushing client boundaries into `SettingsSidebar` and new `SettingsMobileNav`
- `SettingsSidebar` uses `Link` + `usePathname` instead of `onClick` + `activeSection` prop — proper nav semantics
- `OllamaSection` simplified by removing the `isVisible` prop — mount/unmount is now the visibility signal
- Mobile now uses a `NativeSelect` dropdown that navigates via `router.push` instead of all sections stacked

## Task Commits

Each task was committed atomically:

1. **Task 1: Create settings route structure and layout** - `ee06c19` (feat)
2. **Task 2: Convert SettingsSidebar to Link-based nav and remove OllamaSection isVisible** - `3465682` (feat)

## Files Created/Modified

- `frontend/src/app/settings/layout.tsx` - Server component shell: Header + sidebar slot + content area with mobile nav slot + children
- `frontend/src/app/settings/page.tsx` - Redirect to /settings/feeds
- `frontend/src/app/settings/feeds/page.tsx` - FeedsSection page
- `frontend/src/app/settings/interests/page.tsx` - InterestsSection page
- `frontend/src/app/settings/categories/page.tsx` - CategoriesSection page
- `frontend/src/app/settings/ollama/page.tsx` - OllamaSection page (no isVisible)
- `frontend/src/app/settings/feedback/page.tsx` - FeedbackPlaceholder page
- `frontend/src/components/settings/SettingsMobileNav.tsx` - Client component: NativeSelect dropdown for mobile nav
- `frontend/src/components/settings/SettingsSidebar.tsx` - Link-based nav with usePathname active state, removed props
- `frontend/src/components/settings/OllamaSection.tsx` - Removed isVisible prop, always polls on mount

## Decisions Made

- `settings/layout.tsx` stays server component by extracting `SettingsMobileNav` as a separate client component. The only interactive logic is in the two sub-components that were already client-side.
- Per-section page files do not add `"use client"` — the section components they import already declare their own client boundaries. Adding it to page files would be harmless but redundant.
- `OllamaSection` now calls `useOllamaHealth(true)` unconditionally. This is correct because the component only mounts when the user navigates to `/settings/ollama`, making mount state equivalent to visibility.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

- The Next.js build lock file was stale from a previous process, preventing `bun run build`. Used TypeScript type check (`npx tsc --noEmit`) as equivalent verification — passed with zero errors. Pre-existing lint errors in unrelated files (`AddFeedDialog.tsx`, `FeedRow.tsx`, `useCategories.ts`, etc.) are out of scope and unchanged.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Settings routing is in place. Phase 09.2-02 and 09.2-03 can proceed independently.
- The build lock issue should resolve when the dev server process that holds it exits.

---
*Phase: 09.2-frontend-dom-tree-simplification-and-component-structure-optimization*
*Completed: 2026-02-20*
