---
phase: 09.2-frontend-dom-tree-simplification-and-component-structure-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/app/settings/layout.tsx
  - frontend/src/app/settings/page.tsx
  - frontend/src/app/settings/feeds/page.tsx
  - frontend/src/app/settings/interests/page.tsx
  - frontend/src/app/settings/categories/page.tsx
  - frontend/src/app/settings/ollama/page.tsx
  - frontend/src/app/settings/feedback/page.tsx
  - frontend/src/components/settings/SettingsMobileNav.tsx
  - frontend/src/components/settings/SettingsSidebar.tsx
  - frontend/src/components/settings/OllamaSection.tsx
autonomous: true
requirements: []
must_haves:
  truths:
    - "Navigating to /settings redirects to /settings/feeds"
    - "Each settings section has its own URL (/settings/feeds, /settings/interests, etc.)"
    - "Only the active section is mounted in the DOM -- inactive sections are not rendered"
    - "Desktop shows persistent left sidebar nav with Link elements and active-state highlighting"
    - "Mobile shows a NativeSelect dropdown at top of content area for section switching (SettingsMobileNav client component)"
    - "Settings layout.tsx is a server component -- client boundary pushed to SettingsMobileNav and SettingsSidebar"
    - "Category expand/collapse state survives navigation between settings sections (localStorage)"
    - "OllamaSection health polling activates on mount and stops on unmount (no isVisible prop)"
    - "Settings sidebar category badge and download indicator still function"
  artifacts:
    - path: "frontend/src/app/settings/layout.tsx"
      provides: "Settings shell with sidebar/dropdown + children slot"
    - path: "frontend/src/app/settings/page.tsx"
      provides: "Redirect to /settings/feeds"
    - path: "frontend/src/components/settings/SettingsMobileNav.tsx"
      provides: "Client component for mobile section dropdown nav"
    - path: "frontend/src/app/settings/feeds/page.tsx"
      provides: "FeedsSection page"
    - path: "frontend/src/app/settings/categories/page.tsx"
      provides: "CategoriesSection page"
    - path: "frontend/src/app/settings/ollama/page.tsx"
      provides: "OllamaSection page (no isVisible prop)"
  key_links:
    - from: "frontend/src/app/settings/layout.tsx"
      to: "SettingsSidebar"
      via: "import and render in sidebar slot"
      pattern: "SettingsSidebar"
    - from: "frontend/src/components/settings/SettingsSidebar.tsx"
      to: "next/navigation usePathname"
      via: "active state from URL path"
      pattern: "usePathname"
---

<objective>
Convert settings page from client-side section switching to Next.js App Router nested route segments.

Purpose: Eliminate the mobile "all sections stacked" pattern (which mounts all 5 sections simultaneously), replace `useState`-based section management with URL-driven routing, and enable proper `<nav>` with `<Link>` elements for settings sidebar.

Output: Settings page works via `/settings/feeds`, `/settings/interests`, `/settings/categories`, `/settings/ollama`, `/settings/feedback` route segments. Only the active section is in the DOM.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09.2-frontend-dom-tree-simplification-and-component-structure-optimization/09.2-CONTEXT.md
@.planning/phases/09.2-frontend-dom-tree-simplification-and-component-structure-optimization/09.2-RESEARCH.md
@frontend/src/app/settings/page.tsx
@frontend/src/components/settings/SettingsSidebar.tsx
@frontend/src/components/settings/OllamaSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings route structure and layout</name>
  <files>
    frontend/src/app/settings/layout.tsx
    frontend/src/app/settings/page.tsx
    frontend/src/app/settings/feeds/page.tsx
    frontend/src/app/settings/interests/page.tsx
    frontend/src/app/settings/categories/page.tsx
    frontend/src/app/settings/ollama/page.tsx
    frontend/src/app/settings/feedback/page.tsx
    frontend/src/components/settings/SettingsMobileNav.tsx
  </files>
  <action>
    Create the nested route structure for settings:

    1. **`app/settings/layout.tsx`** (Server Component -- NO "use client"):
       - Import Header, SettingsSidebar (updated in Task 2), SettingsMobileNav (new, created below), and necessary Chakra components.
       - Render the settings shell: `Box minHeight="100vh" bg="bg"` > `Header` > `Container maxW="5xl" py={8} px={6} pt="88px"` > `Flex gap={8}`.
       - Desktop sidebar slot: `Box as="nav" display={{ base: "none", md: "block" }} width="200px" flexShrink={0}` containing `<SettingsSidebar />`.
       - Content area: `Box flex={1} minW={0} overflowY="auto" maxH="calc(100vh - 88px - 64px)" css={{ scrollbarGutter: "stable" }}`.
       - Mobile dropdown slot inside content area: `Box display={{ base: "block", md: "none" }} mb={4}` containing `<SettingsMobileNav />`.
       - Render `{children}` in the content area below the mobile dropdown.
       - This layout is a SERVER component — all interactive logic lives in SettingsSidebar (already client) and SettingsMobileNav (new client component). The layout itself is static structure.

    1b. **`components/settings/SettingsMobileNav.tsx`** ("use client"):
       - Small client component that renders the mobile section dropdown.
       - Import `usePathname` from `next/navigation`, `useRouter` from `next/navigation`, and Chakra `NativeSelect`.
       - Render `NativeSelect.Root size="sm"` with `NativeSelect.Field` whose value comes from the last segment of `usePathname()` and `onChange` calls `router.push(\`/settings/${e.target.value}\`)`.
       - Options: feeds, interests, categories, ollama, feedback.
       - This is the ONLY reason the layout would have needed "use client" — by extracting it, the layout shell stays server-rendered.

    2. **`app/settings/page.tsx`** (Server Component -- no "use client"):
       - Import `redirect` from `next/navigation`.
       - Export default function that calls `redirect("/settings/feeds")`.
       - This is the entire file -- just a redirect.

    3. **Per-section page files** -- each is a thin Client Component wrapper:
       - `app/settings/feeds/page.tsx`: imports and renders `<FeedsSection />`.
       - `app/settings/interests/page.tsx`: imports and renders `<InterestsSection />`.
       - `app/settings/categories/page.tsx`: imports and renders `<CategoriesSection />`.
       - `app/settings/ollama/page.tsx`: imports and renders `<OllamaSection />` (NO `isVisible` prop -- see Task 2).
       - `app/settings/feedback/page.tsx`: imports and renders `<FeedbackPlaceholder />`.
       - Each page file needs `"use client"` only if the section component requires it (check imports). If the section component already has "use client", the page can be a simple server component that renders it. However, since these are just thin wrappers, adding "use client" is harmless and consistent.
  </action>
  <verify>
    Run `bun run build` from `frontend/` -- should compile without errors. Verify the new route files exist:
    ```
    ls frontend/src/app/settings/layout.tsx
    ls frontend/src/app/settings/feeds/page.tsx
    ls frontend/src/app/settings/interests/page.tsx
    ls frontend/src/app/settings/categories/page.tsx
    ls frontend/src/app/settings/ollama/page.tsx
    ls frontend/src/app/settings/feedback/page.tsx
    ```
  </verify>
  <done>Settings layout.tsx renders sidebar + children slot. /settings redirects to /settings/feeds. Each section has its own page file. Build succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Convert SettingsSidebar to Link-based nav and remove OllamaSection isVisible</name>
  <files>
    frontend/src/components/settings/SettingsSidebar.tsx
    frontend/src/components/settings/OllamaSection.tsx
  </files>
  <action>
    1. **SettingsSidebar.tsx** -- Convert from click-handler to Link-based navigation:
       - Remove `SettingsSidebarProps` interface (no more `activeSection`/`onSectionChange` props).
       - Import `usePathname` from `next/navigation` and `Link` from `next/link`.
       - Update `SIDEBAR_ITEMS` to include `href` field: `{ id: "feeds", href: "/settings/feeds", icon: LuRss, label: "Feeds" }`, etc.
       - Replace `onClick={() => onSectionChange(item.id)}` with `<Link>` wrapping the Flex row. Determine `isActive` from `pathname.startsWith(item.href)` or `pathname === item.href`.
       - The `<Link>` should wrap the existing `<Flex>` content. Use `<Link href={item.href} style={{ textDecoration: "none" }}>` to avoid default link styling.
       - Keep the download status and category badge queries unchanged.
       - Keep the existing `SettingsSection` type export (other parts of codebase may use it).
       - Render the Stack with `as="nav"` for semantic HTML.

    2. **OllamaSection.tsx** -- Remove `isVisible` prop:
       - Remove the `OllamaSectionProps` interface.
       - Remove `isVisible` from the function signature.
       - Change `useOllamaHealth(isVisible)` to `useOllamaHealth(true)` -- the component is only mounted when the user navigates to /settings/ollama, so it should always poll when mounted.
       - The rest of the component stays unchanged.
  </action>
  <verify>
    Run `bun run build` from `frontend/` -- should compile with no errors. Grep for leftover `isVisible` usage:
    ```
    grep -r "isVisible" frontend/src/components/settings/OllamaSection.tsx
    ```
    Should return nothing.
  </verify>
  <done>SettingsSidebar uses Link elements and usePathname for active state. OllamaSection has no isVisible prop -- polls when mounted. Build passes.</done>
</task>

</tasks>

<verification>
1. `bun run build` passes with zero errors
2. `bun run lint` passes
3. `/settings` URL redirects to `/settings/feeds`
4. Only the active section component is mounted in the DOM
5. SettingsSidebar uses `<Link>` elements (not onClick handlers)
6. Mobile dropdown navigates between sections
7. OllamaSection has no `isVisible` prop
</verification>

<success_criteria>
Settings page uses nested App Router routes. Each section is a separate page file. SettingsSidebar uses proper `<nav>` with `<Link>` elements. Mobile uses NativeSelect dropdown. OllamaSection polls based on mount state. Build passes.
</success_criteria>

<output>
After completion, create `.planning/phases/09.2-frontend-dom-tree-simplification-and-component-structure-optimization/09.2-01-SUMMARY.md`
</output>
