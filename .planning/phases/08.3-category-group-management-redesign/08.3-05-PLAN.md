---
phase: 08.3-category-group-management-redesign
plan: 05
type: execute
wave: 4
depends_on: [08.3-04]
files_modified:
  - frontend/src/components/settings/HiddenCategoriesSection.tsx
  - frontend/src/components/settings/CategoriesSection.tsx
  - frontend/src/components/settings/CategoryChildRow.tsx
  - frontend/src/components/settings/CategoryUngroupedRow.tsx
  - frontend/src/components/settings/CategoryParentRow.tsx
autonomous: true
requirements: [CATGRP-02]

must_haves:
  truths:
    - "Hidden categories appear in a collapsible 'Hidden (N)' section at the bottom of the categories list"
    - "Each hidden category row has an 'Unhide' action in its context menu"
    - "Unhiding a category returns it to the ungrouped section (loses parent)"
    - "Hidden section is collapsed by default"
    - "Mobile card layout renders below sm breakpoint with checkbox + name + menu on top row and weight strip on bottom row"
    - "Mobile floating bottom action bar appears when items selected on mobile"
    - "Child cards are indented under parent cards on mobile"
  artifacts:
    - path: "frontend/src/components/settings/HiddenCategoriesSection.tsx"
      provides: "Collapsible hidden categories section with unhide action"
    - path: "frontend/src/components/settings/CategoriesSection.tsx"
      provides: "Hidden section integration and mobile ActionBar bottom padding"
  key_links:
    - from: "frontend/src/components/settings/CategoriesSection.tsx"
      to: "frontend/src/components/settings/HiddenCategoriesSection.tsx"
      via: "hiddenCategories data + unhideCategory callback"
      pattern: "HiddenCategoriesSection"
---

<objective>
Add the hidden categories section and implement mobile card layout with floating action bar.

Purpose: Completes the phase by adding the hidden categories management UI and mobile-optimized card layout. These are the final UI pieces that make the category management redesign complete across all screen sizes.

Output: Hidden categories visible and manageable at bottom of categories list. Mobile users see card layout with floating action bar.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08.3-category-group-management-redesign/08.3-RESEARCH.md
@.planning/phases/08.3-category-group-management-redesign/08.3-03-SUMMARY.md
@.planning/phases/08.3-category-group-management-redesign/08.3-04-SUMMARY.md

@frontend/src/components/settings/CategoriesSection.tsx
@frontend/src/components/settings/CategoryChildRow.tsx
@frontend/src/components/settings/CategoryParentRow.tsx
@frontend/src/hooks/useCategories.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Hidden categories section with unhide action</name>
  <files>frontend/src/components/settings/HiddenCategoriesSection.tsx, frontend/src/components/settings/CategoriesSection.tsx</files>
  <action>
  **Create `HiddenCategoriesSection.tsx`:**
  - Props: `hiddenCategories: Category[]`, `onUnhide: (categoryId: number) => void`.
  - Use Chakra `Collapsible.Root` with local `open` state (default: `false`, no localStorage persistence — hidden section is a secondary concern).
  - `Collapsible.Trigger asChild` wrapping a `Flex` row:
    - Chevron icon with rotation animation (same pattern as parent rows).
    - Text: `"Hidden ({hiddenCategories.length})"` in `fontSize="sm" fontWeight="semibold" color="fg.muted"`.
  - `Collapsible.Content`:
    - `Stack gap={1}` containing each hidden category as a simple row:
      - `Flex` with `py={2} px={3} bg="bg.subtle" borderRadius="sm"`.
      - Category display name in `fontSize="sm" color="fg.muted"`.
      - Spacer.
      - "Unhide" `Button` (`variant="ghost" size="xs" onClick={() => onUnhide(category.id)}`).
  - Only renders when `hiddenCategories.length > 0`.

  **Update `CategoriesSection.tsx`:**
  - Compute hidden categories from the `categories` array: `const hiddenCategories = useMemo(() => categories.filter(c => c.is_hidden).sort((a, b) => a.display_name.localeCompare(b.display_name)), [categories])`.
  - Import and render `<HiddenCategoriesSection>` after the CategoryTree and after any dialogs, at the bottom of the Stack.
  - Pass `hiddenCategories={hiddenCategories}` and `onUnhide={unhideCategory}` (from useCategories).
  - Destructure `unhideCategory` from `useCategories()` if not already done.
  - Add toast for unhide: wrap `unhideCategory` in a handler that shows `toaster.create({ title: "Category unhidden", type: "info" })`.

  **Add bottom padding when mobile ActionBar is visible:**
  - In the main `Stack` that wraps everything, add `pb={selectedIds.size > 0 ? 16 : 0}` on mobile to prevent the floating ActionBar from covering the last items. Use responsive value: `pb={{ base: selectedIds.size > 0 ? 16 : 0, sm: 0 }}`.
  </action>
  <verify>
  Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to verify TypeScript compiles.
  </verify>
  <done>
  - Hidden categories section renders at bottom of categories list when hidden categories exist
  - Section is collapsible, default collapsed
  - Each hidden row has "Unhide" button that calls unhideCategory
  - Unhide shows toast feedback
  - Bottom padding applied on mobile when ActionBar is visible
  </done>
</task>

<task type="auto">
  <name>Task 2: Mobile card layout for category rows</name>
  <files>frontend/src/components/settings/CategoryChildRow.tsx, frontend/src/components/settings/CategoryUngroupedRow.tsx, frontend/src/components/settings/CategoryParentRow.tsx</files>
  <action>
  **Update `CategoryChildRow.tsx` for mobile card layout:**
  - Below `sm` breakpoint (480px), render a card layout instead of the current inline row.
  - Use responsive props to switch layout:
    - Outer `Box`: add `borderWidth={{ base: "1px", sm: "0" }} borderColor="border.subtle" borderRadius={{ base: "md", sm: "sm" }} p={{ base: 3, sm: 0 }}`.
    - Top row (`Flex`): `direction={{ base: "column", sm: "row" }} gap={2}`.
    - On mobile (base), structure as two rows within the Box:
      - First inner Flex (always visible): checkbox + category name + "New" badge (if any) + context menu (three-dot).
      - Second inner Flex (always visible on mobile, inline on desktop): weight preset strip at full width.
    - On desktop (sm+), keep the current single-row layout.
  - Implement this with responsive display/direction props rather than duplicating the component. The key change: on mobile, the `WeightPresetStrip` moves to a new line below the name row.
  - Practical approach: Wrap the existing Flex content in a responsive layout:
    ```tsx
    <Box borderWidth={{ base: "1px", sm: "0" }} borderColor="border.subtle" borderRadius={{ base: "md", sm: "sm" }}>
      <Flex alignItems="center" gap={2} py={{ base: 2, sm: 2 }} px={3} flexWrap={{ base: "wrap", sm: "nowrap" }}>
        <Checkbox ... />
        <Text ...>{category.display_name}</Text>
        {isNew && <Badge ...>New</Badge>}
        <Box flex={1} display={{ base: "block", sm: "block" }} />
        <Box display={{ base: "none", sm: "block" }}><WeightPresetStrip ... /></Box>
        <CategoryContextMenu ... />
      </Flex>
      {/* Mobile-only weight strip */}
      <Box display={{ base: "block", sm: "none" }} px={3} pb={2}>
        <WeightPresetStrip ... />
      </Box>
    </Box>
    ```
  - Ensure touch targets are at least 44px for mobile checkboxes and three-dot icons (use `minH="44px" minW="44px"` on interactive elements at base breakpoint if needed).

  **Update `CategoryUngroupedRow.tsx` for mobile card layout:**
  - Same responsive card treatment as CategoryChildRow: card border on mobile, flat row on desktop.
  - Same two-row mobile structure: top row = checkbox + name + badge + context menu, bottom row = weight strip.
  - Same `Box` wrapper pattern and touch target sizing as CategoryChildRow.

  **Update `CategoryParentRow.tsx` for mobile card layout:**
  - Similar responsive treatment: on mobile, render as a card with border.
  - Structure: top row = chevron + folder + name + child count + context menu. Bottom row = weight strip.
  - Same responsive `Box` wrapper pattern as CategoryChildRow.
  - Mobile weight strip gets its own line:
    ```tsx
    <Box borderWidth={{ base: "1px", sm: "0" }} borderColor="border.subtle" borderRadius={{ base: "md", sm: "sm" }}>
      <Flex alignItems="center" gap={2} py={3} px={3} ... >
        {/* chevron, folder, name, count, spacer, desktop-only weight strip, context menu */}
      </Flex>
      <Box display={{ base: "block", sm: "none" }} px={3} pb={2}>
        <WeightPresetStrip ... />
      </Box>
    </Box>
    ```
  - Child cards indented under parent cards: The existing `ml={6} pl={3}` on the children container in `CategoryTree.tsx` already handles indentation with connector lines. This should work for mobile cards too — the indentation and connector lines provide visual hierarchy.
  </action>
  <verify>
  Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to verify TypeScript compiles.
  Run `cd /Users/cstalhem/projects/rss-reader/frontend && bun run build` to verify production build succeeds.
  </verify>
  <done>
  - Below sm breakpoint, category rows render as cards with border, two-row layout
  - Card top row: checkbox + name + badge + three-dot menu
  - Card bottom row: full-width weight preset strip
  - Parent cards: chevron + folder + name + count on top, weight strip on bottom
  - Child cards indented under parent cards with connector lines
  - Touch targets appropriately sized for mobile
  - Desktop layout unchanged
  - Build passes
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `bun run build` succeeds
3. Hidden categories section appears at bottom when hidden categories exist
4. Unhide returns category to ungrouped with toast
5. Mobile viewport shows card layout with two-row structure
6. Mobile floating action bar doesn't cover last items (bottom padding applied)
</verification>

<success_criteria>
- Hidden categories section fully functional with unhide
- Mobile card layout renders correctly below sm breakpoint
- No visual regressions on desktop
- Complete phase: all interactions work on both desktop and mobile
</success_criteria>

<output>
After completion, create `.planning/phases/08.3-category-group-management-redesign/08.3-05-SUMMARY.md`
</output>
