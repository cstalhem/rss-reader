---
phase: 08.3-category-group-management-redesign
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/settings/CategoryActionBar.tsx
  - frontend/src/components/settings/HiddenCategoriesSection.tsx
  - frontend/src/components/settings/WeightPresetStrip.tsx
  - frontend/src/components/settings/MoveToGroupDialog.tsx
  - frontend/src/components/settings/CategoriesSection.tsx
autonomous: true
requirements: [CATGRP-02, CATGRP-03]
gap_closure: true

must_haves:
  truths:
    - "Desktop action bar stays visible when scrolling the categories list"
    - "Hidden section chevron rotates on expand/collapse like parent row chevrons"
    - "Mobile weight strip buttons show text labels on the buttons themselves"
    - "Move to Group dialog shows correct child category count per parent group"
  artifacts:
    - path: "frontend/src/components/settings/CategoryActionBar.tsx"
      provides: "Sticky desktop action bar"
      contains: "sticky"
    - path: "frontend/src/components/settings/HiddenCategoriesSection.tsx"
      provides: "Rotating chevron indicator"
      contains: "rotate"
    - path: "frontend/src/components/settings/WeightPresetStrip.tsx"
      provides: "Paired button+label rendering"
    - path: "frontend/src/components/settings/MoveToGroupDialog.tsx"
      provides: "Child category count per parent"
      contains: "childrenMap"
  key_links:
    - from: "frontend/src/components/settings/CategoriesSection.tsx"
      to: "frontend/src/components/settings/MoveToGroupDialog.tsx"
      via: "childrenMap prop"
      pattern: "childrenMap.*=.*childrenMap"
---

<objective>
Fix four UAT issues from 08.3-UAT.md: sticky desktop action bar, hidden section chevron rotation, mobile weight strip button/label pairing, and correct child count in Move to Group dialog.

Purpose: Close all remaining UAT gaps to complete Phase 08.3
Output: Four targeted fixes across five files, all cosmetic or minor severity
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/components/settings/CategoryActionBar.tsx
@frontend/src/components/settings/HiddenCategoriesSection.tsx
@frontend/src/components/settings/WeightPresetStrip.tsx
@frontend/src/components/settings/MoveToGroupDialog.tsx
@frontend/src/components/settings/CategoriesSection.tsx
@frontend/src/app/settings/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Sticky action bar and hidden section chevron rotation</name>
  <files>
    frontend/src/components/settings/CategoryActionBar.tsx
    frontend/src/components/settings/HiddenCategoriesSection.tsx
  </files>
  <action>
**CategoryActionBar.tsx — Sticky desktop header:**

The desktop Flex (line 23, `display={{ base: "none", sm: "flex" }}`) is a static element inside the settings content area which has `overflowY="auto"` (settings/page.tsx line 37). Add `position="sticky"`, `top={0}`, and `zIndex={1}` to this Flex so it stays pinned at the top of the scrollable content area when the user scrolls past it. Also add `bg="bg.subtle"` is already present — confirm it stays so the sticky bar has a solid background and doesn't show content bleeding through.

**HiddenCategoriesSection.tsx — Chevron rotation:**

The `Collapsible.Indicator` component (line 31) wraps `LuChevronRight` but has no rotation styling. The Chakra v3 `Collapsible.Indicator` sets `data-state="open"` or `data-state="closed"` on the wrapper element. Add these props to the `Collapsible.Indicator`:

```
transition="transform 0.2s"
_open={{ transform: "rotate(90deg)" }}
```

This matches the rotation behavior of parent row chevrons in CategoryParentRow (which uses manual `transform` with `isExpanded` state). The Collapsible.Indicator approach is cleaner since it uses the built-in data-state attribute.
  </action>
  <verify>
Run `npx tsc --noEmit` from the frontend directory to confirm no type errors. Visually inspect that `position: "sticky"` and rotation CSS are present in the source.
  </verify>
  <done>
Desktop action bar has position sticky with top=0 and zIndex=1. Hidden section chevron rotates 90 degrees on expand via _open prop.
  </done>
</task>

<task type="auto">
  <name>Task 2: Weight strip button/label pairing and dialog child count</name>
  <files>
    frontend/src/components/settings/WeightPresetStrip.tsx
    frontend/src/components/settings/MoveToGroupDialog.tsx
    frontend/src/components/settings/CategoriesSection.tsx
  </files>
  <action>
**WeightPresetStrip.tsx — Icon+text buttons on mobile, icon-only on desktop:**

Currently there are two separate `.map()` loops over `WEIGHT_OPTIONS`:
1. Lines 53-99: Renders all icon buttons (both active and inactive with animation wrappers)
2. Lines 102-116: Renders all text labels (mobile only, detached from buttons)

The text labels are detached siblings rendered after all buttons, instead of being part of each button.

Fix: Replace both `.map()` loops with a single loop that renders two elements per option via `React.Fragment`:

1. **Mobile `Button`** (`display={{ base: "inline-flex", md: "none" }}`) — a regular Chakra `Button` (not `IconButton`) containing both the icon and the text label as children. Always visible, no animation. Content-sized width.

2. **Desktop `IconButton`** wrapped in a `Box` (`display={{ base: "none", md: "block" }}`) — icon-only with `Tooltip`, same as current. The `Box` handles the expand/collapse animation for inactive options (`overflow="hidden"`, `maxW` toggled by `isExpanded`). For the active option, the `Box` has no overflow/maxW/transition constraints (pass `undefined`).

Import changes: replace `Text` with `Button` in the Chakra import.

Extract a shared `handleClick` callback per iteration to avoid duplicating the onClick logic between the two button variants.

**MoveToGroupDialog.tsx — Show child category count instead of article_count:**

Add a `childrenMap` prop to `MoveToGroupDialogProps`:
```typescript
childrenMap: Record<number, Category[]>;
```

On line 101, replace `{parent.article_count ?? 0}` with `{childrenMap[parent.id]?.length ?? 0}`. This shows the number of child categories in each group, which is what the user expects to see in a "move to group" context.

Import `Category` is already imported.

**CategoriesSection.tsx — Pass childrenMap to MoveToGroupDialog:**

At line 425-432 where `<MoveToGroupDialog>` is rendered, add the `childrenMap` prop:
```
childrenMap={childrenMap}
```

The `childrenMap` variable is already computed in the `useMemo` at line 86 and destructured at line 86. It just needs to be passed down.
  </action>
  <verify>
Run `npx tsc --noEmit` from the frontend directory to confirm no type errors. Inspect WeightPresetStrip.tsx to confirm: single `.map()` loop, mobile `Button` with icon+text children, desktop `IconButton` (icon-only) in animated `Box`. Inspect MoveToGroupDialog.tsx to confirm it uses `childrenMap[parent.id]?.length` instead of `parent.article_count`.
  </verify>
  <done>
Mobile renders `Button` with icon+text inside each button; desktop renders icon-only `IconButton` with expand/collapse animation (single map loop, two elements per option via Fragment). Move to Group dialog shows correct child category count per parent using childrenMap prop passed from CategoriesSection.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` passes with no errors
2. `cd frontend && bun run lint` passes
3. CategoryActionBar.tsx desktop Flex has `position="sticky"` `top={0}` `zIndex={1}`
4. HiddenCategoriesSection.tsx Collapsible.Indicator has `_open={{ transform: "rotate(90deg)" }}`
5. WeightPresetStrip.tsx has single `.map()` rendering mobile `Button` (icon+text) and desktop `IconButton` (icon-only) per option
6. MoveToGroupDialog.tsx accepts `childrenMap` prop and displays `childrenMap[parent.id]?.length ?? 0`
7. CategoriesSection.tsx passes `childrenMap={childrenMap}` to MoveToGroupDialog
</verification>

<success_criteria>
All four UAT gaps closed:
- Desktop action bar sticks to top of scroll container
- Hidden section chevron rotates on expand/collapse
- Mobile weight strip renders Button components with icon+text inside each button
- Move to Group dialog shows correct child category count per group
</success_criteria>

<output>
After completion, create `.planning/phases/08.3-category-group-management-redesign/08.3-06-SUMMARY.md`
</output>
