---
phase: 08.3-category-group-management-redesign
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/settings/CategoryActionBar.tsx
  - frontend/src/components/settings/HiddenCategoriesSection.tsx
  - frontend/src/components/settings/WeightPresetStrip.tsx
  - frontend/src/components/settings/MoveToGroupDialog.tsx
  - frontend/src/components/settings/CategoriesSection.tsx
autonomous: true
requirements: [CATGRP-02, CATGRP-03]
gap_closure: true

must_haves:
  truths:
    - "Desktop action bar stays visible when scrolling the categories list"
    - "Hidden section chevron rotates on expand/collapse like parent row chevrons"
    - "Mobile weight strip buttons show text labels on the buttons themselves"
    - "Move to Group dialog shows correct child category count per parent group"
  artifacts:
    - path: "frontend/src/components/settings/CategoryActionBar.tsx"
      provides: "Sticky desktop action bar"
      contains: "sticky"
    - path: "frontend/src/components/settings/HiddenCategoriesSection.tsx"
      provides: "Rotating chevron indicator"
      contains: "rotate"
    - path: "frontend/src/components/settings/WeightPresetStrip.tsx"
      provides: "Paired button+label rendering"
    - path: "frontend/src/components/settings/MoveToGroupDialog.tsx"
      provides: "Child category count per parent"
      contains: "childrenMap"
  key_links:
    - from: "frontend/src/components/settings/CategoriesSection.tsx"
      to: "frontend/src/components/settings/MoveToGroupDialog.tsx"
      via: "childrenMap prop"
      pattern: "childrenMap.*=.*childrenMap"
---

<objective>
Fix four UAT issues from 08.3-UAT.md: sticky desktop action bar, hidden section chevron rotation, mobile weight strip button/label pairing, and correct child count in Move to Group dialog.

Purpose: Close all remaining UAT gaps to complete Phase 08.3
Output: Four targeted fixes across five files, all cosmetic or minor severity
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/components/settings/CategoryActionBar.tsx
@frontend/src/components/settings/HiddenCategoriesSection.tsx
@frontend/src/components/settings/WeightPresetStrip.tsx
@frontend/src/components/settings/MoveToGroupDialog.tsx
@frontend/src/components/settings/CategoriesSection.tsx
@frontend/src/app/settings/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Sticky action bar and hidden section chevron rotation</name>
  <files>
    frontend/src/components/settings/CategoryActionBar.tsx
    frontend/src/components/settings/HiddenCategoriesSection.tsx
  </files>
  <action>
**CategoryActionBar.tsx — Sticky desktop header:**

The desktop Flex (line 23, `display={{ base: "none", sm: "flex" }}`) is a static element inside the settings content area which has `overflowY="auto"` (settings/page.tsx line 37). Add `position="sticky"`, `top={0}`, and `zIndex={1}` to this Flex so it stays pinned at the top of the scrollable content area when the user scrolls past it. Also add `bg="bg.subtle"` is already present — confirm it stays so the sticky bar has a solid background and doesn't show content bleeding through.

**HiddenCategoriesSection.tsx — Chevron rotation:**

The `Collapsible.Indicator` component (line 31) wraps `LuChevronRight` but has no rotation styling. The Chakra v3 `Collapsible.Indicator` sets `data-state="open"` or `data-state="closed"` on the wrapper element. Add these props to the `Collapsible.Indicator`:

```
transition="transform 0.2s"
_open={{ transform: "rotate(90deg)" }}
```

This matches the rotation behavior of parent row chevrons in CategoryParentRow (which uses manual `transform` with `isExpanded` state). The Collapsible.Indicator approach is cleaner since it uses the built-in data-state attribute.
  </action>
  <verify>
Run `npx tsc --noEmit` from the frontend directory to confirm no type errors. Visually inspect that `position: "sticky"` and rotation CSS are present in the source.
  </verify>
  <done>
Desktop action bar has position sticky with top=0 and zIndex=1. Hidden section chevron rotates 90 degrees on expand via _open prop.
  </done>
</task>

<task type="auto">
  <name>Task 2: Weight strip button/label pairing and dialog child count</name>
  <files>
    frontend/src/components/settings/WeightPresetStrip.tsx
    frontend/src/components/settings/MoveToGroupDialog.tsx
    frontend/src/components/settings/CategoriesSection.tsx
  </files>
  <action>
**WeightPresetStrip.tsx — Collapse two map loops into one:**

Currently there are two separate `.map()` loops over `WEIGHT_OPTIONS`:
1. Lines 53-99: Renders all icon buttons (both active and inactive with animation wrappers)
2. Lines 102-116: Renders all text labels (mobile only, `display={{ base: "inline", md: "none" }}`)

The second loop produces detached labels that render as a group after all buttons, rather than each label appearing next to its button.

Fix: Remove the second `.map()` loop entirely (lines 101-116). Inside the first `.map()` loop, after each button (whether active or wrapped in the animation Box), add the mobile-only Text label for that option. The label should be placed INSIDE the same fragment/wrapper as the button for that option, so button and label are adjacent siblings in the DOM.

For active buttons, return a fragment containing the button followed by the Text label. For inactive buttons wrapped in the animation Box, place the Text label inside the Box after the button (so the label collapses/expands with the button on desktop, and is always visible on mobile since the Box has `maxW: "24px"` on base).

Actually, a simpler approach: render each option as a Flex item containing the icon button and the mobile-only text label together. This keeps them paired. Use `alignItems="center"` on each item wrapper. The inactive animation Box wrapping should encompass both button and label.

**MoveToGroupDialog.tsx — Show child category count instead of article_count:**

Add a `childrenMap` prop to `MoveToGroupDialogProps`:
```typescript
childrenMap: Record<number, Category[]>;
```

On line 101, replace `{parent.article_count ?? 0}` with `{childrenMap[parent.id]?.length ?? 0}`. This shows the number of child categories in each group, which is what the user expects to see in a "move to group" context.

Import `Category` is already imported.

**CategoriesSection.tsx — Pass childrenMap to MoveToGroupDialog:**

At line 425-432 where `<MoveToGroupDialog>` is rendered, add the `childrenMap` prop:
```
childrenMap={childrenMap}
```

The `childrenMap` variable is already computed in the `useMemo` at line 86 and destructured at line 86. It just needs to be passed down.
  </action>
  <verify>
Run `npx tsc --noEmit` from the frontend directory to confirm no type errors. Inspect WeightPresetStrip.tsx to confirm there is only one `.map()` loop over WEIGHT_OPTIONS. Inspect MoveToGroupDialog.tsx to confirm it uses `childrenMap[parent.id]?.length` instead of `parent.article_count`.
  </verify>
  <done>
Each weight preset button is immediately followed by its mobile text label in the DOM (single map loop). Move to Group dialog shows correct child category count per parent using childrenMap prop passed from CategoriesSection.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` passes with no errors
2. `cd frontend && bun run lint` passes
3. CategoryActionBar.tsx desktop Flex has `position="sticky"` `top={0}` `zIndex={1}`
4. HiddenCategoriesSection.tsx Collapsible.Indicator has `_open={{ transform: "rotate(90deg)" }}`
5. WeightPresetStrip.tsx has exactly one `.map()` over WEIGHT_OPTIONS with labels inline
6. MoveToGroupDialog.tsx accepts `childrenMap` prop and displays `childrenMap[parent.id]?.length ?? 0`
7. CategoriesSection.tsx passes `childrenMap={childrenMap}` to MoveToGroupDialog
</verification>

<success_criteria>
All four UAT gaps closed:
- Desktop action bar sticks to top of scroll container
- Hidden section chevron rotates on expand/collapse
- Mobile weight strip buttons have their labels directly on/beside them
- Move to Group dialog shows correct child category count per group
</success_criteria>

<output>
After completion, create `.planning/phases/08.3-category-group-management-redesign/08.3-06-SUMMARY.md`
</output>
