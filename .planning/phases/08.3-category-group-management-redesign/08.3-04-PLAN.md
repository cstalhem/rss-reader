---
phase: 08.3-category-group-management-redesign
plan: 04
type: execute
wave: 3
depends_on: [08.3-03]
files_modified:
  - frontend/src/components/settings/MoveToGroupDialog.tsx
  - frontend/src/components/settings/DeleteCategoryDialog.tsx
  - frontend/src/components/settings/CategoriesSection.tsx
autonomous: true
requirements: [CATGRP-02, CATGRP-03]

must_haves:
  truths:
    - "Move to group dialog opens when action bar button is clicked"
    - "Dialog shows searchable list of existing parent categories"
    - "Dialog shows 'Create new group' option at bottom"
    - "Selecting a parent from the dialog moves all selected categories to that parent"
    - "Creating a new group creates the category and moves selected items into it"
    - "Delete confirmation dialog shows count of categories being deleted"
    - "Ungroup confirmation dialog shows count of items being ungrouped"
    - "Confirmation dialogs for both Delete and Ungroup require explicit confirm"
    - "Selection is cleared after Move, Delete, and Ungroup actions"
  artifacts:
    - path: "frontend/src/components/settings/MoveToGroupDialog.tsx"
      provides: "Modal with search and parent category list"
    - path: "frontend/src/components/settings/DeleteCategoryDialog.tsx"
      provides: "Extended for bulk delete with count-based messaging"
    - path: "frontend/src/components/settings/CategoriesSection.tsx"
      provides: "Dialog state management, action bar wiring to dialogs"
  key_links:
    - from: "frontend/src/components/settings/CategoriesSection.tsx"
      to: "frontend/src/components/settings/MoveToGroupDialog.tsx"
      via: "open state + onMove callback"
      pattern: "MoveToGroupDialog"
    - from: "frontend/src/components/settings/MoveToGroupDialog.tsx"
      to: "frontend/src/hooks/useCategories.ts"
      via: "batchMove and createCategory via callback props"
      pattern: "onMove|onCreate"
---

<objective>
Create the "Move to group" dialog with search and inline create, extend the delete dialog for bulk operations, and add confirmation dialogs for Ungroup actions.

Purpose: This completes the action bar workflow — every action button now has a proper UX: Move to group opens a dialog, Ungroup/Delete show confirmation, Hide is instant with toast.

Output: All action bar buttons are fully functional with proper dialogs and confirmations.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08.3-category-group-management-redesign/08.3-RESEARCH.md
@.planning/phases/08.3-category-group-management-redesign/08.3-02-SUMMARY.md
@.planning/phases/08.3-category-group-management-redesign/08.3-03-SUMMARY.md

@frontend/src/components/settings/CategoriesSection.tsx
@frontend/src/components/settings/DeleteCategoryDialog.tsx
@frontend/src/hooks/useCategories.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move to Group dialog and Ungroup confirmation dialog</name>
  <files>frontend/src/components/settings/MoveToGroupDialog.tsx, frontend/src/components/settings/CategoriesSection.tsx</files>
  <action>
  **Create `MoveToGroupDialog.tsx`:**
  - Props: `open: boolean`, `onOpenChange: (open: boolean) => void`, `parentCategories: Category[]` (existing parents to show as targets), `selectedCount: number`, `onMove: (targetParentId: number) => void`, `onCreate: (groupName: string) => void`.
  - Use Chakra `Dialog.Root` with `open` + `onOpenChange` (controlled).
  - Layout: `Portal > Dialog.Backdrop > Dialog.Positioner > Dialog.Content`.
  - Header: `Dialog.Title` "Move to group".
  - Body:
    - `Input` at top with `placeholder="Search groups..."` and local state `searchQuery`.
    - Filtered list of parent categories: `parentCategories.filter(p => p.display_name.toLowerCase().includes(searchQuery.toLowerCase()))`.
    - Each parent rendered as a clickable `Flex` row: folder icon + display name + child count. On click: call `onMove(parent.id)` and close dialog.
    - At the bottom, below parents list: "Create new group" option.
      - When clicked, show an inline `Input` for the group name. On Enter/submit: call `onCreate(groupName)` and close dialog.
      - Use local state `isCreating: boolean` and `newGroupName: string`.
  - `Dialog.CloseTrigger` with `CloseButton`.
  - Same modal on all screen sizes per CONTEXT.md.
  - No debounce needed for search — category list is small, instant filter is fine per RESEARCH.md.

  **Add Ungroup confirmation dialog to `CategoriesSection.tsx`:**
  - Add state: `ungroupConfirmCount: number | null` (null = closed, number = count of items to ungroup).
  - When action bar "Ungroup" is clicked: set `ungroupConfirmCount = selectedIds.size` instead of immediately calling batchMove.
  - Render a simple confirmation `Dialog.Root` (can be inline JSX, no separate component needed):
    - Title: "Ungroup categories"
    - Body: `"Ungroup {count} {count === 1 ? 'category' : 'categories'}? They will be moved to the root level."`
    - Buttons: Cancel (closes dialog) + Confirm (calls `batchMove(Array.from(selectedIds), -1)`, `clearSelection()`, closes dialog).

  **Wire Move to Group dialog in `CategoriesSection.tsx`:**
  - Add state: `moveDialogOpen: boolean`.
  - When action bar "Move to group" is clicked: `setMoveDialogOpen(true)`.
  - Render `<MoveToGroupDialog>` with:
    - `parentCategories={parents}` (from the tree data useMemo).
    - `selectedCount={selectedIds.size}`.
    - `onMove={(targetParentId) => { batchMove(Array.from(selectedIds), targetParentId); clearSelection(); setMoveDialogOpen(false); }}`.
    - `onCreate` handler: see below.
  - For `onCreate` flow: expose `createCategoryMutation` directly from `useCategories` (add `createCategoryMutation,` to the return object). This lets callers use `.mutateAsync()` to get the created `Category` back while preserving the mutation's existing `onSuccess` (invalidation) and `onError` (toast) callbacks.
  - In the `onCreate` handler in CategoriesSection:
    ```typescript
    const handleCreateAndMove = async (groupName: string) => {
      const created = await createCategoryMutation.mutateAsync({ displayName: groupName });
      batchMove(Array.from(selectedIds), created.id);
      clearSelection();
      setMoveDialogOpen(false);
    };
    ```
  - Pass `onCreate={handleCreateAndMove}` to `MoveToGroupDialog`.
  </action>
  <verify>
  Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to verify TypeScript compiles.
  </verify>
  <done>
  - Move to Group dialog opens from action bar, shows searchable parent list + create option
  - Selecting a parent moves all selected categories
  - Creating a new group creates it and moves selected items into it
  - Ungroup action shows confirmation dialog with count
  - Dialogs close and selection clears after actions
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend Delete dialog for bulk operations and wire confirmation flows</name>
  <files>frontend/src/components/settings/DeleteCategoryDialog.tsx, frontend/src/components/settings/CategoriesSection.tsx</files>
  <action>
  **Update `DeleteCategoryDialog.tsx`:**
  - Refactor to support both single and bulk delete.
  - Change props to: `open: boolean`, `onOpenChange: (open: boolean) => void`, `count: number`, `categoryName: string | null` (null for bulk, name for single), `isParent: boolean`, `childCount: number`, `onConfirm: () => void`.
  - When `count > 1` (bulk): show message "Delete {count} categories? This cannot be undone. If the LLM discovers them again, they will reappear."
  - When `count === 1` and `isParent` and `childCount > 0`: show existing parent-specific message.
  - When `count === 1` and not parent: show existing single-delete message.
  - Use `Dialog.Root open={open} onOpenChange={(e) => onOpenChange(e.open)}` instead of the current `open={categoryName !== null}` pattern.

  **Update `CategoriesSection.tsx` delete flow:**
  - Refactor delete state to support both single and bulk:
    - Add state: `deleteDialogState: { open: boolean; count: number; categoryName: string | null; isParent: boolean; childCount: number; ids: number[] }` with a sensible default.
  - When action bar "Delete" is clicked: set `deleteDialogState` with `count=selectedIds.size`, `ids=Array.from(selectedIds)`, `categoryName=null` (bulk).
  - When context menu "Delete" is clicked on a single row: set with `count=1`, single category info (name, isParent, childCount).
  - On confirm: if `ids.length > 1`, call `batchDelete(ids)`; if `ids.length === 1`, call `deleteCategory(ids[0])`. Then `clearSelection()` and close dialog.
  - Also wire context menu "Ungroup" on parent rows to show the ungroup confirmation dialog (reuse the same pattern: `ungroupParentId` state, confirmation dialog, on confirm call `ungroupParent(id)`).

  **Wire all context menu actions through CategoriesSection:**
  - Parent context menu "Ungroup": opens confirmation dialog, on confirm calls `ungroupParent(parentId)`.
  - Parent/Child/Ungrouped "Hide" via context menu: calls `hideCategory(id)` directly (instant, per CONTEXT.md — no confirmation for hide, just instant update + toast). Add a success toast: `toaster.create({ title: "Category hidden", type: "info" })`.
  - Parent/Child/Ungrouped "Delete" via context menu: opens delete confirmation dialog for single item.
  - Child "Reset weight" via context menu: calls `updateCategory(id, { weight: "inherit" })` (already works via handleResetWeight).

  Add success toasts for Hide and Ungroup actions (per CONTEXT.md: "Instant update + toast after Move to group, Ungroup, Hide actions"). Import `toaster` from `@/components/ui/toaster` in CategoriesSection if not already imported.
  </action>
  <verify>
  Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit` to verify TypeScript compiles.
  Run `cd /Users/cstalhem/projects/rss-reader/frontend && bun run build` to verify production build succeeds.
  </verify>
  <done>
  - Delete dialog works for both single and bulk delete with appropriate messaging
  - Action bar Delete shows count-based confirmation
  - Context menu Delete shows name-based confirmation
  - Ungroup (both action bar and parent context menu) shows confirmation
  - Hide is instant with toast feedback
  - All actions clear selection and close dialogs on completion
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `bun run build` succeeds
3. Action bar "Move to group" opens dialog with search and parent list
4. Action bar "Delete" and "Ungroup" show confirmation dialogs
5. Context menus trigger correct action for each row type
6. Toast appears after Hide and Ungroup actions
</verification>

<success_criteria>
- Every action bar button has a complete UX flow (dialog or confirmation)
- Every context menu action works correctly per row type
- Feedback (toasts) shown for all non-delete actions
- Selection lifecycle is clean (clears after every action)
</success_criteria>

<output>
After completion, create `.planning/phases/08.3-category-group-management-redesign/08.3-04-SUMMARY.md`
</output>
