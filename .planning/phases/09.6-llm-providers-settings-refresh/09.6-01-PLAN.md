---
phase: 09.6-llm-providers-settings-refresh
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/src/backend/routers/ollama.py
  - backend/src/backend/schemas.py
  - frontend/src/lib/types.ts
  - frontend/src/lib/api.ts
  - frontend/src/lib/constants.ts
  - frontend/src/lib/queryKeys.ts
  - frontend/src/hooks/useProviders.ts
  - frontend/src/components/settings/ProviderLogos.tsx
autonomous: true
requirements:
  - OLLAMA-01
  - OLLAMA-02

must_haves:
  truths:
    - "GET /api/providers returns the list of configured providers with enabled status"
    - "PATCH /api/providers/{provider}/disconnect sets enabled=false (preserves config for reconnect)"
    - "Frontend useProviders hook fetches provider list and exposes add/disconnect mutations"
    - "PROVIDER_CATALOG constant defines all 5 providers with availability flags"
    - "SVG logo components exist for all 5 providers (Ollama, OpenAI, Anthropic, Google, OpenRouter)"
  artifacts:
    - path: "backend/src/backend/routers/ollama.py"
      provides: "GET /api/providers and PATCH disconnect endpoints"
    - path: "frontend/src/hooks/useProviders.ts"
      provides: "useProviders hook with query + mutations"
    - path: "frontend/src/components/settings/ProviderLogos.tsx"
      provides: "ProviderLogo component mapping provider ID to SVG"
    - path: "frontend/src/lib/constants.ts"
      provides: "PROVIDER_CATALOG array"
  key_links:
    - from: "frontend/src/hooks/useProviders.ts"
      to: "/api/providers"
      via: "fetchProviders API function"
      pattern: "fetch.*api/providers"
    - from: "frontend/src/lib/constants.ts"
      to: "frontend/src/components/settings/ProviderLogos.tsx"
      via: "provider ID string"
      pattern: "PROVIDER_CATALOG"
---

<objective>
Build the data layer foundation for the multi-provider LLM settings page: backend endpoints for listing/disconnecting providers, frontend types, API client, TanStack Query hook, provider catalog constant, and SVG brand logos.

Purpose: All subsequent plans need provider data flowing from backend to frontend and the static provider metadata/logos in place. This is the shared foundation.
Output: Working backend endpoints, typed frontend data layer, provider catalog, and logo components ready for UI consumption.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09.6-llm-providers-settings-refresh/09.6-CONTEXT.md
@.planning/phases/09.6-llm-providers-settings-refresh/09.6-RESEARCH.md

@backend/src/backend/routers/ollama.py
@backend/src/backend/schemas.py
@backend/src/backend/deps.py
@backend/src/backend/models.py
@frontend/src/lib/types.ts
@frontend/src/lib/api.ts
@frontend/src/lib/constants.ts
@frontend/src/lib/queryKeys.ts
@frontend/src/hooks/useOllamaConfig.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Backend provider list and disconnect endpoints</name>
  <files>
    backend/src/backend/routers/ollama.py
    backend/src/backend/schemas.py
  </files>
  <action>
Add two new endpoints to the ollama router (they live here because Ollama is the only active provider; when more providers are added, these can move to a dedicated providers router):

1. **GET /api/providers** — Query `LLMProviderConfig` table, return list of `{provider: string, enabled: bool}`. If no rows exist, return an empty list. Add `ProviderListItem` response schema to `schemas.py`.

2. **PATCH /api/providers/{provider}/disconnect** — Find the `LLMProviderConfig` row for the given provider name. Set `enabled = False`. Also clear any `LLMTaskRoute` rows referencing this provider (set their `provider` to empty string or delete them) so the scoring pipeline doesn't try to use a disconnected provider. Return `{ok: true}`. If provider not found, return 404.

Per research decision: "disconnect" sets `enabled: false` rather than deleting the row, preserving host/port config for easy reconnect.

Also add a small utility: when adding a provider back (the existing `PUT /api/ollama/config` already creates/updates the row), ensure `enabled` is set to `True` in `upsert_ollama_provider_config` in `deps.py` — verify this is already the case (it sets `enabled=True` on new rows, but check that it also re-enables on existing rows that were disconnected).

Response schemas to add in `schemas.py`:
- `ProviderListItem(provider: str, enabled: bool)`
  </action>
  <verify>
    <automated>cd /Users/cstalhem/projects/worktrees/rss-reader/great-lehmann && uv run python -c "from backend.routers.ollama import router; routes = [r.path for r in router.routes]; assert '/api/providers' in routes or any('providers' in r for r in routes), f'Missing providers route: {routes}'; print('OK: provider endpoints registered')"</automated>
    <manual>Check that GET /api/providers returns [] on cold start and PATCH disconnect returns 404 for unknown provider</manual>
  </verify>
  <done>GET /api/providers returns provider list from DB, PATCH disconnect sets enabled=false and clears task routes, response schemas defined</done>
</task>

<task type="auto">
  <name>Task 2: Frontend data layer — types, API, hook, catalog, logos</name>
  <files>
    frontend/src/lib/types.ts
    frontend/src/lib/api.ts
    frontend/src/lib/constants.ts
    frontend/src/lib/queryKeys.ts
    frontend/src/hooks/useProviders.ts
    frontend/src/components/settings/ProviderLogos.tsx
  </files>
  <action>
**types.ts** — Add:
```typescript
export interface ProviderListItem {
  provider: string;
  enabled: boolean;
}
```

**api.ts** — Add:
- `fetchProviders(): Promise<ProviderListItem[]>` — GET /api/providers
- `disconnectProvider(provider: string): Promise<{ok: boolean}>` — PATCH /api/providers/{provider}/disconnect

**queryKeys.ts** — Add to the `ollama` section (or add a new `providers` section):
```typescript
providers: {
  all: ["providers"] as const,
},
```

**constants.ts** — Add PROVIDER_CATALOG per research:
```typescript
export interface ProviderInfo {
  id: string;
  label: string;
  hint: string;
  available: boolean;
}

export const PROVIDER_CATALOG: ProviderInfo[] = [
  { id: "ollama", label: "Ollama", hint: "Local \u2014 no API key", available: true },
  { id: "openai", label: "OpenAI", hint: "Requires API key", available: false },
  { id: "anthropic", label: "Anthropic", hint: "Requires API key", available: false },
  { id: "google", label: "Google", hint: "Requires API key", available: false },
  { id: "openrouter", label: "OpenRouter", hint: "Requires API key", available: false },
];
```

**useProviders.ts** — New hook:
- `useQuery` with `queryKeys.providers.all` and `fetchProviders` as queryFn
- `useMutation` for disconnect with `meta: { errorTitle: "Failed to disconnect provider" }`, invalidates `queryKeys.providers.all` on settled
- Returns `{ providers, isLoading, disconnectMutation }`

**ProviderLogos.tsx** — Create a component file with inline SVG components for all 5 provider brand marks:
- `OllamaLogo` — llama head silhouette (simple path, monochrome, inherits currentColor)
- `OpenAILogo` — the hexagonal/circular mark
- `AnthropicLogo` — the "A" mark
- `GoogleLogo` — the "G" mark (simplified monochrome)
- `OpenRouterLogo` — the router/arrow mark

All logos: 1em width/height (scales with font size), `fill="currentColor"` for CSS inheritance.

Export a `ProviderLogo` component: `({ provider, ...props }: { provider: string } & React.SVGProps<SVGSVGElement>) => JSX.Element` that maps provider ID to the right SVG. Unknown provider falls back to a generic `LuBot` icon.
  </action>
  <verify>
    <automated>cd /Users/cstalhem/projects/worktrees/rss-reader/great-lehmann/frontend && bun run build 2>&1 | tail -20</automated>
    <manual>Verify ProviderLogos renders 5 distinct SVGs, queryKeys.providers.all exists</manual>
  </verify>
  <done>ProviderListItem type, API functions, useProviders hook, PROVIDER_CATALOG constant, and ProviderLogo component all compile without errors and are ready for UI consumption</done>
</task>

</tasks>

<verification>
1. Backend: `uv run ruff check backend/src/backend/routers/ollama.py backend/src/backend/schemas.py` passes
2. Frontend: `bun run build` succeeds with no type errors
3. Query keys: `queryKeys.providers.all` exists in queryKeys.ts
4. Constants: PROVIDER_CATALOG has 5 entries with Ollama as `available: true`
</verification>

<success_criteria>
- Backend serves GET /api/providers and PATCH disconnect endpoints
- Frontend types, API functions, hook, and query keys are wired correctly
- Provider catalog with 5 providers and availability flags is defined
- SVG logo components for all 5 providers compile and inherit currentColor
- No lint or type errors
</success_criteria>

<output>
After completion, create `.planning/phases/09.6-llm-providers-settings-refresh/09.6-01-SUMMARY.md`
</output>
