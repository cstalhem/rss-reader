---
status: resolved
phase: 08.1-categories-settings-ui-redesign
source: 08.1-05-SUMMARY.md, 08.1-06-SUMMARY.md, 08.1-07-SUMMARY.md, 08.1-08-SUMMARY.md
started: 2026-02-17T20:00:00Z
updated: 2026-02-17T20:30:00Z
round: 2
previous: 08.1-UAT.md
---

## Current Test
<!-- OVERWRITE each test - shows where we are -->

[testing complete]

## Tests

### 1. Tree Connector Lines and Count Position
expected: Parent categories show children with connector lines. Last child has L-shape (└) connector, middle children have T-shape (├). Lines are 2px width with visible color. Child count appears next to the parent name (not right-aligned).
result: issue
reported: "Better and seems to work as expected, but there is a gap between child rows that we don't want."
severity: cosmetic

### 2. Weight Icon Styling and Row Layout
expected: Weight icons use chevrons (not up/down arrows). Active weight shows outline variant with accent border/icon color (not solid background). Row layout order: name, count, spacer, weight strip, action buttons. Hover tooltips on all row buttons (rename, delete, hide).
result: issue
reported: "Better, but the buttons are still too large."
severity: cosmetic

### 3. Weight Strip Animation
expected: On desktop, hover over the weight area on a category row. The strip smoothly expands to reveal all 5 weight options — icons grow outward with a smooth max-width animation (not instant appear/disappear).
result: pass

### 4. Optimistic Weight Updates
expected: Click a different weight icon on any category. The icon updates instantly (no loading delay). If the backend fails, the change reverts and an error toast appears. No success toast (silent success by design).
result: issue
reported: "Much better, but the feeling is still that it takes almost half a second (noticeable at least) for the weights to update."
severity: minor

### 5. Drag-and-Drop Performance
expected: Drag a category — the drag is smooth and responsive, not laggy or stuttering. Row hover effects do not cause visible jank during drag. Self-drop (dropping a category back on itself) does nothing (no self-grouping bug).
result: issue
reported: "Drag is still not good and there are still visual bugs in several places. We probably need to change the library. We should test the dnd-kit/react but need to research the implementation properly first."
severity: blocker

### 6. Drag to Ungroup
expected: Drag a child category from inside a parent to the "Drop here to ungroup" zone below the tree. The category becomes ungrouped and appears at root level.
result: issue
reported: "Fail. It's not possible to ungroup via dnd"
severity: major

### 7. Search Filter Without Console Error
expected: Type in the "Filter categories" input. Tree filters correctly. No React console errors about useEffect array size changes. Drag handles disappear while search is active. Clear search — full tree returns with drag handles.
result: pass

### 8. Create New Category
expected: Click "Add Category" button. Enter a name and click Create. The new category appears immediately in the tree at root level. Enter a duplicate name — an error is shown. Toast messages confirm success/failure.
result: issue
reported: "Fail. It is still possible to create categories that have the same name as existing ones without getting an error toast. A duplicate is not created though. New categories appear instantly but no success-toast is shown."
severity: major

### 9. Rename Ungrouped Category
expected: Hover over an ungrouped category — pencil icon appears. Click it. Change the name and press Enter. The name updates in the tree (no "New" chip). Refresh — the name persists.
result: issue
reported: "Fail. No icons appear visually on hover, but they appear to exist on the row as it is possible to click them. Renaming works. However, space for these icons is reserved on all rows where it should not be. Icons should only appear on hover with a similar animation as the weight icons."
severity: major

### 10. Delete Parent Category (Split Group)
expected: Hover over a parent with children — click the trash/split icon. The parent category becomes ungrouped, children are also released to root level (all categories preserved, none deleted). Works with special characters in category names (e.g., AI/ML).
result: issue
reported: "Fail. There is only a delete button for the category (but it is not visible), so the top level category is completely deleted rather than the group being split."
severity: blocker

## Summary

total: 10
passed: 2
issues: 5
deferred: 3
pending: 0
skipped: 0

## Gaps

- truth: "Vertical connector line between child rows is continuous with no gaps"
  status: resolved
  reason: "User reported: Better and seems to work as expected, but there is a gap between child rows that we don't want."
  severity: cosmetic
  test: 1
  root_cause: "Stack gap={1} (4px) between child rows in CategoryTree.tsx creates space that vertical connector pseudo-elements don't bridge. Each child's _before vertical line covers its own height but the 4px gap between rows is unaccounted for."
  artifacts:
    - path: "frontend/src/components/settings/CategoryTree.tsx"
      issue: "Stack gap={1} creates 4px gaps between child rows that connector lines don't span"
  missing:
    - "Remove gap or extend vertical line height with calc(100% + 4px) to bridge inter-row spacing"
  debug_session: .planning/debug/connector-line-gaps.md

- truth: "Parent delete action splits the group (parent becomes ungrouped, children released) rather than deleting the parent category"
  status: deferred
  deferred_to: "08.2"
  reason: "User reported: There is only a delete button (not visible), so the top level category is completely deleted rather than the group being split."
  severity: blocker
  test: 10
  root_cause: "Backend DELETE endpoint removes parent from both children_map AND manually_created. Parent disappears entirely if it was manually created and never assigned by LLM. No separate 'split group' action exists — only delete. Root cause is the JSON blob data model itself — will be resolved by Category table migration in 08.2."
  artifacts:
    - path: "backend/src/backend/main.py"
      issue: "DELETE /api/categories/{name} removes from manually_created (should keep on split)"
    - path: "frontend/src/components/settings/CategoryParentRow.tsx"
      issue: "Only has delete button, no split/ungroup action"
  missing:
    - "Category table with parent_id column — split becomes UPDATE SET parent_id = NULL"
    - "Proper split-group endpoint using relational operations"
  debug_session: .planning/debug/parent-split-vs-delete.md

- truth: "Row action icons (rename, delete) appear on hover with animation and don't reserve space when hidden"
  status: resolved
  reason: "User reported: No icons appear visually on hover but click targets exist. Space reserved on all rows. Icons should only appear on hover with similar animation as weight icons."
  severity: major
  test: 9
  root_cause: "CSS specificity conflict: opacity={{ base: 1, md: 0 }} uses a media query which has higher specificity than _groupHover={{ opacity: 1 }} pseudo-class. Icons are always invisible on desktop but still occupy layout space."
  artifacts:
    - path: "frontend/src/components/settings/CategoryParentRow.tsx"
      issue: "Opacity media query overrides _groupHover pseudo-class"
    - path: "frontend/src/components/settings/CategoryChildRow.tsx"
      issue: "Same opacity specificity issue; icons reserve space when hidden"
  missing:
    - "Replace opacity-based hiding with maxWidth-based collapsing (matching WeightPresetStrip pattern)"
    - "Use overflow:hidden + maxWidth:0 transition to both hide and collapse space"
  debug_session: .planning/debug/hover-action-icons.md

- truth: "Creating a duplicate category shows an error toast; creating a new category shows a success toast"
  status: resolved
  reason: "User reported: Still possible to create categories with same name as existing ones without error toast. No success toast shown either. Duplicate is silently ignored (not created)."
  severity: major
  test: 8
  root_cause: "createCategoryMutation in useCategories.ts has no onSuccess or onError handlers with toast notifications. Frontend inline validation catches duplicates (disables button) but edge cases may bypass it. No backend duplicate check exists."
  artifacts:
    - path: "frontend/src/hooks/useCategories.ts"
      issue: "createCategoryMutation missing onSuccess/onError toast handlers"
    - path: "backend/src/backend/main.py"
      issue: "POST /api/categories/create has no duplicate validation"
  missing:
    - "Add onSuccess toast to createCategoryMutation"
    - "Add onError toast to createCategoryMutation"
    - "Add backend duplicate check returning 409 Conflict"
  debug_session: .planning/debug/create-category-validation.md

- truth: "Dragging a child to the ungroup zone releases it to root level"
  status: deferred
  deferred_to: "08.3"
  reason: "User reported: Fail. It's not possible to ungroup via dnd"
  severity: major
  test: 6
  root_cause: "Ungroup zone is positioned below ungrouped category rows. When dragging downward, the pointer passes over ungrouped CategoryChildRow droppable zones which intercept the drop before it reaches the ungroup zone. Default rectIntersection collision detection returns first intersecting droppable."
  artifacts:
    - path: "frontend/src/components/settings/CategoriesSection.tsx"
      issue: "Ungroup zone positioned below all category rows; default collision detection intercepts"
    - path: "frontend/src/components/settings/CategoryChildRow.tsx"
      issue: "Dual useSortable + useDroppable on same element creates overlapping drop targets"
  missing:
    - "Custom collision detection that prioritizes ungroup-zone when pointer is in bottom region"
    - "Or reposition ungroup zone to overlay/sidebar instead of below list"
  debug_session: .planning/debug/ungroup-via-dnd.md

- truth: "Drag-and-drop is smooth, responsive, and visually correct"
  status: deferred
  deferred_to: "08.3"
  reason: "User reported: Drag is still not good and there are still visual bugs in several places. Need to change library to @dnd-kit/react and research implementation properly first."
  severity: blocker
  test: 5
  root_cause: "Multiple compounding issues: (1) dual hooks (useSortable + useDroppable) on CategoryChildRow cause conflict, (2) no collision detection strategy specified (default rectIntersection poor for trees), (3) visual layering conflicts with drag overlay. @dnd-kit/react v0.3.0 is NOT production-ready (no tree examples, unstable API)."
  artifacts:
    - path: "frontend/src/components/settings/CategoriesSection.tsx"
      issue: "No collisionDetection prop on DndContext; DragOverlay conflicts with row hover effects"
    - path: "frontend/src/components/settings/CategoryChildRow.tsx"
      issue: "Dual useSortable + useDroppable hooks on same element cause unpredictable behavior"
  missing:
    - "Revisit grouping UI paradigm: DnD optimization vs button-based group management"
    - "Research alternative interaction patterns for tree group management"
  debug_session: .planning/debug/dnd-performance-and-bugs.md

- truth: "Weight changes reflect instantly with zero perceptible delay"
  status: resolved
  reason: "User reported: Much better, but the feeling is still that it takes almost half a second (noticeable at least) for the weights to update."
  severity: minor
  test: 4
  root_cause: "Double sequential await on cancelQueries in onMutate blocks optimistic update. Two separate await calls add measurable latency before setQueryData executes. Secondary: handleCategoryWeightChange also calls acknowledge() immediately after weight mutation, causing dual invalidation of categoryGroups."
  artifacts:
    - path: "frontend/src/components/settings/CategoriesSection.tsx"
      issue: "Sequential await cancelQueries calls in onMutate; dual mutation+acknowledge invalidation"
  missing:
    - "Use Promise.all for parallel query cancellation in onMutate"
    - "Deduplicate categoryGroups invalidation between weight mutation and acknowledge"
  debug_session: .planning/debug/optimistic-update-delay.md

- truth: "Weight preset buttons are compact and proportional to the row size"
  status: resolved
  reason: "User reported: Better, but the buttons are still too large."
  severity: cosmetic
  test: 2
  root_cause: "Chakra size='xs' IconButton has ~32px rendered height due to default internal padding. The minW='28px' constraint only affects width, not overall button size. Default xs padding makes buttons visually larger than intended."
  artifacts:
    - path: "frontend/src/components/settings/WeightPresetStrip.tsx"
      issue: "size='xs' IconButton padding makes buttons ~32px; need explicit p={1} override"
  missing:
    - "Add explicit p={1} or p='4px' to IconButtons to reduce total size"
    - "Consider custom size variant or h/w overrides for tighter fit"
  debug_session: .planning/debug/weight-button-sizing.md
