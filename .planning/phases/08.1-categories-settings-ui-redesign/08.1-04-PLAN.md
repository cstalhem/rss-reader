---
phase: 08.1-categories-settings-ui-redesign
plan: 04
type: execute
wave: 4
depends_on: ["08.1-03"]
files_modified:
  - frontend/src/components/settings/WeightPresetStrip.tsx
  - frontend/src/components/settings/SwipeableRow.tsx
  - frontend/src/components/settings/CategoryParentRow.tsx
  - frontend/src/components/settings/CategoryChildRow.tsx
  - frontend/src/components/settings/CategoriesSection.tsx
autonomous: false
requirements:
  - CATGRP-04

must_haves:
  truths:
    - "Weight strip shows only active icon when collapsed, expands all 5 on hover"
    - "Active icon slides to correct position when strip expands"
    - "Mobile shows all weight icons with text labels (no hover)"
    - "Desktop weight icons have tooltips with weight name"
    - "Mobile swipe-left on category row reveals edit button"
    - "Inherited weights shown dimmer than overridden weights"
  artifacts:
    - path: "frontend/src/components/settings/WeightPresetStrip.tsx"
      provides: "Hover-expand weight icon strip replacing button-based WeightPresets"
      contains: "LuBan"
    - path: "frontend/src/components/settings/SwipeableRow.tsx"
      provides: "Mobile swipe-to-reveal wrapper for edit button"
      contains: "useSwipeable"
  key_links:
    - from: "frontend/src/components/settings/CategoryParentRow.tsx"
      to: "frontend/src/components/settings/WeightPresetStrip.tsx"
      via: "component import"
      pattern: "WeightPresetStrip"
    - from: "frontend/src/components/settings/CategoryChildRow.tsx"
      to: "frontend/src/components/settings/SwipeableRow.tsx"
      via: "component wrapping"
      pattern: "SwipeableRow"
---

<objective>
Replace the button-based weight presets with a hover-expand icon strip and add mobile swipe-to-reveal edit gesture.

Purpose: The current WeightPresets component shows all 5 weight buttons always visible, which creates visual noise in a dense tree layout. The new WeightPresetStrip collapses to a single active icon and expands on hover. Mobile gets swipe-to-reveal edit instead of hover-reveal buttons. This completes the UI polish for the categories tree.

Output: WeightPresetStrip with hover-expand animation, SwipeableRow for mobile edit reveal, visual verification of the complete categories settings UI.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08.1-categories-settings-ui-redesign/08.1-RESEARCH.md
@.planning/phases/08.1-categories-settings-ui-redesign/08.1-02-SUMMARY.md
@.planning/phases/08.1-categories-settings-ui-redesign/08.1-03-SUMMARY.md

@frontend/src/components/settings/WeightPresets.tsx
@frontend/src/components/settings/CategoryParentRow.tsx
@frontend/src/components/settings/CategoryChildRow.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: WeightPresetStrip with hover-expand animation and SwipeableRow</name>
  <files>
    frontend/src/components/settings/WeightPresetStrip.tsx
    frontend/src/components/settings/SwipeableRow.tsx
    frontend/src/components/settings/CategoryParentRow.tsx
    frontend/src/components/settings/CategoryChildRow.tsx
    frontend/src/components/settings/CategoriesSection.tsx
  </files>
  <action>
**WeightPresetStrip.tsx** (NEW FILE):

Create a hover-expand weight icon strip component.

```typescript
"use client";

import { useState, useRef, useCallback } from "react";
import { Flex, Box, IconButton, Text } from "@chakra-ui/react";
import { Tooltip } from "@/components/ui/tooltip";
import {
  LuBan,
  LuArrowDown,
  LuMinus,
  LuArrowUp,
  LuChevronsUp,
  LuUndo2,
} from "react-icons/lu";
```

Weight options array:
```typescript
const WEIGHT_OPTIONS = [
  { value: "block", icon: LuBan, label: "Block", color: "red" },
  { value: "reduce", icon: LuArrowDown, label: "Reduce", color: "orange" },
  { value: "normal", icon: LuMinus, label: "Normal", color: "gray" },
  { value: "boost", icon: LuArrowUp, label: "Boost", color: "green" },
  { value: "max", icon: LuChevronsUp, label: "Max", color: "yellow" },
];
```

Props:
```typescript
interface WeightPresetStripProps {
  value: string;
  onChange: (weight: string) => void;
  isOverridden?: boolean;     // true = explicit override, false = inherited, undefined = root
  onReset?: () => void;       // reset to parent weight
}
```

**Desktop behavior (md and up):**

Collapsed state (default):
- Show only the active weight icon (the one matching `value`)
- Container has fixed width ~28px
- Icon uses accent color if overridden, muted color if inherited (`isOverridden === false` → opacity 0.5)

Hover state:
- Container expands to show all 5 icons in a row
- Use `max-width` CSS transition: `maxW` transitions from ~28px to ~160px over 0.2s ease-out
- `overflow: hidden` on the container
- Active icon has solid background with accent colorPalette
- Inactive icons have ghost styling
- Each icon wrapped in Tooltip with the weight label

Implementation approach:
```tsx
const [isExpanded, setIsExpanded] = useState(false);

return (
  <Flex
    alignItems="center"
    onMouseEnter={() => setIsExpanded(true)}
    onMouseLeave={() => setIsExpanded(false)}
    onClick={(e) => e.stopPropagation()}
    opacity={isOverridden === false ? 0.5 : 1}
  >
    <Flex
      overflow="hidden"
      maxW={{ base: "auto", md: isExpanded ? "160px" : "28px" }}
      transition="max-width 0.2s ease-out"
      gap={0}
    >
      {/* On desktop collapsed: render only active icon. On expanded: render all */}
      {/* On mobile (base): always render all icons */}
      {WEIGHT_OPTIONS.map((option) => {
        const isActive = value === option.value;
        const Icon = option.icon;

        return (
          <Tooltip key={option.value} content={option.label} disabled={/* mobile */}>
            <IconButton
              aria-label={option.label}
              size="xs"
              variant={isActive ? "solid" : "ghost"}
              colorPalette={isActive ? "accent" : undefined}
              onClick={(e) => {
                e.stopPropagation();
                onChange(option.value);
              }}
              minW="28px"
            >
              <Icon size={14} />
            </IconButton>
          </Tooltip>
        );
      })}
    </Flex>

    {/* Reset button - only when overridden */}
    <Box w="28px" ml={0.5}>
      {isOverridden && onReset && (
        <IconButton
          aria-label="Reset to parent weight"
          size="xs"
          variant="ghost"
          colorPalette="accent"
          onClick={(e) => { e.stopPropagation(); onReset(); }}
        >
          <LuUndo2 size={12} />
        </IconButton>
      )}
    </Box>
  </Flex>
);
```

**Mobile behavior (base breakpoint):**
- Always show all 5 icons (no collapse)
- Show text label next to each icon (using `display={{ base: "inline", md: "none" }}`)
- No tooltips on mobile
- Active icon gets solid accent background, others ghost

**Alternative simpler approach for desktop collapse/expand:**
If the `max-width` transition on individual icons causes issues, try this instead:
- Always render all 5 icons
- On desktop when collapsed, hide non-active icons with `display={{ base: "flex", md: isExpanded || isActive ? "flex" : "none" }}`
- Add `transition="all 0.2s"` for smooth appearance
- This avoids `max-width` animation entirely while still achieving the collapse effect

Use whichever approach produces smoother results.

**SwipeableRow.tsx** (NEW FILE):

Mobile swipe-to-reveal wrapper using react-swipeable:

```typescript
"use client";

import { useState } from "react";
import { Box, IconButton } from "@chakra-ui/react";
import { LuPencil } from "react-icons/lu";
import { useSwipeable } from "react-swipeable";
```

Props:
```typescript
interface SwipeableRowProps {
  children: React.ReactNode;
  onEditReveal: () => void;
}
```

Implementation:
```tsx
export function SwipeableRow({ children, onEditReveal }: SwipeableRowProps) {
  const [revealed, setRevealed] = useState(false);

  const handlers = useSwipeable({
    onSwipedLeft: () => setRevealed(true),
    onSwipedRight: () => setRevealed(false),
    trackMouse: false,
    preventScrollOnSwipe: true,
  });

  return (
    <Box
      {...handlers}
      overflow="hidden"
      position="relative"
      display={{ base: "block", md: "contents" }}  // Only active on mobile
    >
      <Box
        transform={revealed ? "translateX(-50px)" : "translateX(0)"}
        transition="transform 0.2s ease-out"
      >
        {children}
      </Box>
      {revealed && (
        <IconButton
          aria-label="Edit"
          position="absolute"
          right={0}
          top="50%"
          transform="translateY(-50%)"
          size="sm"
          variant="ghost"
          colorPalette="accent"
          onClick={() => {
            onEditReveal();
            setRevealed(false);
          }}
        >
          <LuPencil size={16} />
        </IconButton>
      )}
    </Box>
  );
}
```

Note: SwipeableRow only wraps content on mobile (`display={{ base: "block", md: "contents" }}`). On desktop, it renders children directly (edit is via hover-reveal pencil button).

**CategoryParentRow.tsx and CategoryChildRow.tsx:**

Replace `WeightPresets` import with `WeightPresetStrip`:
```typescript
import { WeightPresetStrip } from "./WeightPresetStrip";
```

Replace `<WeightPresets ... />` usage with `<WeightPresetStrip ... />`.

For child rows on mobile, wrap with SwipeableRow:
```tsx
import { SwipeableRow } from "./SwipeableRow";

// In render, on mobile only:
<SwipeableRow onEditReveal={() => setIsRenaming(true)}>
  {/* existing row content */}
</SwipeableRow>
```

For parent rows on mobile, also wrap with SwipeableRow (edit triggers rename).

**CategoriesSection.tsx:**

No changes needed unless there's wiring to update.

**Cleanup:**

The old `WeightPresets.tsx` is still used by `ArticleReader.tsx` for inline tag weight changes. Do NOT delete `WeightPresets.tsx` — it remains for article reader usage. Only replace its usage within the categories settings tree with `WeightPresetStrip`.
  </action>
  <verify>
Run `cd /Users/cstalhem/projects/rss-reader/frontend && npx tsc --noEmit 2>&1 | head -40` to check for TypeScript errors.

Run `cd /Users/cstalhem/projects/rss-reader/frontend && bun run build 2>&1 | tail -20` to verify build.
  </verify>
  <done>
WeightPresetStrip shows single active icon collapsed, expands all 5 on hover with smooth transition. Desktop has tooltips. Mobile shows all icons with text labels. SwipeableRow enables swipe-left to reveal edit on mobile. Inherited weights dimmer than overridden. Old WeightPresets preserved for article reader usage.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of complete categories UI</name>
  <files>frontend/src/components/settings/CategoriesSection.tsx</files>
  <action>
Human verification checkpoint. No code changes — verify the complete categories settings UI redesign visually.

What was built: Tree view with parent-child hierarchy, DnD for category assignment, search filtering, CRUD (create/rename/delete), hover-expand weight preset strip, and mobile swipe-to-reveal edit.

Verification steps:
1. Start dev servers: backend on port 8912, frontend on port 3210
2. Navigate to Settings > Categories
3. **Tree structure:** Verify parent categories show with folder icons and bold text, children are indented with CSS connector lines, ungrouped categories appear at root level. All sorted alphabetically.
4. **Weight presets:** Hover over any category row — verify weight icons expand from single icon to full strip. Click a weight — verify it changes. For children with inherited weights, verify dimmer opacity. Set an explicit weight on a child — verify full opacity + reset button appears.
5. **Drag and drop:** Drag a child from one parent to another. Drag a child to the root area. Drag an ungrouped category onto a parent. Drag an ungrouped onto another ungrouped (should create parent relationship). Verify drop highlights appear.
6. **Search:** Type in the search bar — verify tree filters. Verify DnD is disabled.
7. **Create:** Click "Add Category" — enter a name — verify it appears at root level.
8. **Rename:** Hover a category — click pencil icon — rename — verify update.
9. **Delete:** Hover a parent with children — click trash — verify confirmation dialog — confirm — children released to root.
10. **Mobile (narrow viewport):** Resize to mobile width. Verify weight icons show with text labels. Swipe left on a row — verify edit button slides in.
  </action>
  <verify>User types "approved" or describes issues for gap closure.</verify>
  <done>User has visually verified the complete categories settings UI redesign.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `bun run build` succeeds
3. Weight preset strip collapses/expands on hover
4. Mobile swipe-to-reveal works
5. All previous functionality (DnD, search, CRUD) still works
6. No regressions in article reader weight presets
</verification>

<success_criteria>
- Weight preset strip shows single icon collapsed, expands to 5 on hover
- Mobile shows all icons with text labels and supports swipe-to-reveal
- Inherited weights visually distinct from overridden weights
- Complete categories settings UI verified by user
</success_criteria>

<output>
After completion, create `.planning/phases/08.1-categories-settings-ui-redesign/08.1-04-SUMMARY.md`
</output>
