---
phase: 08.1-categories-settings-ui-redesign
plan: 08
type: execute
wave: 4
depends_on:
  - 08.1-07
files_modified:
  - frontend/src/components/settings/CategoryTree.tsx
  - frontend/src/components/settings/CategoryParentRow.tsx
  - frontend/src/components/settings/CategoryChildRow.tsx
  - frontend/src/components/settings/WeightPresetStrip.tsx
autonomous: true
gap_closure: true
requirements:
  - CATGRP-01
  - CATGRP-03

must_haves:
  truths:
    - "Last child in tree shows L-shaped connector line (└──), not T-shaped (├──)"
    - "Connector lines are visually pronounced (2px width, stronger color)"
    - "Child count appears next to parent name (not right-aligned)"
    - "Weight icons use accent outline styling (not solid background)"
    - "Weight icons use chevrons (not arrows)"
    - "Row layout order is correct: elements → flex space → weights → buttons"
    - "Buttons don't reserve space when hidden"
    - "All row buttons have hover tooltips"
    - "Weight preset strip expands smoothly with animation"
  artifacts:
    - path: "frontend/src/components/settings/CategoryTree.tsx"
      provides: "Fixed connector line CSS (L-shape, thickness, color)"
      exports: ["CategoryTree"]
    - path: "frontend/src/components/settings/CategoryParentRow.tsx"
      provides: "Fixed row layout, count positioning, tooltips"
      exports: ["CategoryParentRow"]
    - path: "frontend/src/components/settings/CategoryChildRow.tsx"
      provides: "Fixed row layout, tooltips, button visibility"
      exports: ["CategoryChildRow"]
    - path: "frontend/src/components/settings/WeightPresetStrip.tsx"
      provides: "Chevron icons, outline styling, max-width animation"
      exports: ["WeightPresetStrip"]
  key_links:
    - from: "CategoryTree _before pseudo-element"
      to: "last child L-shape"
      via: "height: 50% on last child, 100% on others"
      pattern: "_before.*height.*50%"
    - from: "WeightPresetStrip inactive icons"
      to: "max-width animation"
      via: "animate from 0 to 28px per icon"
      pattern: "maxWidth.*isExpanded"
---

<objective>
Polish visual details: connector lines, weight icons, row layouts, and animations.

Purpose: Resolve cosmetic gaps (Gaps 1, 2, 3) for a refined, professional appearance.
Output: Visually polished category tree with smooth animations and consistent styling.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08.1-categories-settings-ui-redesign/08.1-UAT.md
@frontend/src/components/settings/CategoryTree.tsx
@frontend/src/components/settings/CategoryParentRow.tsx
@frontend/src/components/settings/CategoryChildRow.tsx
@frontend/src/components/settings/WeightPresetStrip.tsx
</context>

<tasks>

<task type="auto">
  <name>Fix tree connector lines (L-shape for last child, stronger visual weight, count positioning)</name>
  <files>
frontend/src/components/settings/CategoryTree.tsx
frontend/src/components/settings/CategoryParentRow.tsx
  </files>
  <action>
**Gap 1 Fix — Tree connector line improvements**

**CategoryTree.tsx:**

Problem 1: Lines 121-132 (_after pseudo-element) mask vertical line with bg color instead of proper L-shape.
Solution: Stop vertical _before line at 50% height for last child.

Find the connector line CSS for child rows (around lines 98, 118, 121-132). Current structure likely has:
- `_before` pseudo-element: vertical line from top to middle
- `_after` pseudo-element: horizontal line from left to category

Change approach:

1. Increase line width from 1px to 2px (line 98, 118)
2. Change color from `border.subtle` to `border` or `border.emphasized` (stronger token)
3. For the vertical line (_before), add conditional height based on isLastChild:

```typescript
_before: {
  content: '""',
  position: "absolute",
  left: "10px",  // Adjust based on your indent
  top: 0,
  width: "2px",  // Changed from 1px
  height: isLastChild ? "50%" : "100%",  // Stop at 50% for last child
  bg: "border",  // Changed from border.subtle
}
```

4. For the horizontal line (_after), no changes needed except width and color:
```typescript
_after: {
  content: '""',
  position: "absolute",
  left: "10px",
  top: "50%",
  width: "20px",  // Horizontal line length
  height: "2px",  // Changed from 1px
  bg: "border",  // Changed from border.subtle
}
```

5. Remove any _after bg color masking logic (lines 121-132 area that "paints over" the vertical line)

**CategoryParentRow.tsx:**

Problem 2: Child count right-aligned due to flex={1} on name (line 103).
Solution: Remove flex={1}, keep count adjacent to name.

Find the parent row layout (around line 103). Change from:
```typescript
<Text flex={1} fontWeight="semibold">{toTitleCase(name)}</Text>
<Badge>{childCount}</Badge>
```

To:
```typescript
<Text fontWeight="semibold">{toTitleCase(name)}</Text>
<Badge ml={2}>{childCount}</Badge>
<Box flex={1} />  {/* Spacer pushes weights/buttons right */}
```

This keeps name and count adjacent, with a spacer pushing weights/buttons to the right.
  </action>
  <verify>
Visual verification in browser:
1. Navigate to Categories settings
2. Inspect tree structure:
   - Last child in each parent group should have └── line
   - Middle children should have ├── line
   - Lines should be 2px wide and visually clear
3. Check parent rows:
   - Child count badge should be right next to parent name (not far right)
   - Weights and buttons should be on the far right with space between
  </verify>
  <done>
- Last child shows L-shaped connector (└──)
- Middle children show T-shaped connector (├──)
- Connector lines are 2px wide with stronger color token
- Child count badge is adjacent to parent name
- Spacer pushes weights/buttons to the right
  </done>
</task>

<task type="auto">
  <name>Polish weight icons, row layouts, and add tooltips</name>
  <files>
frontend/src/components/settings/CategoryParentRow.tsx
frontend/src/components/settings/CategoryChildRow.tsx
frontend/src/components/settings/WeightPresetStrip.tsx
  </files>
  <action>
**Gap 2 Fix — Weight icon styling and row layout improvements**

**WeightPresetStrip.tsx:**

Problem 1: Uses LuArrowDown/LuArrowUp instead of chevrons (lines 8, 10).
Solution: Change imports from:
```typescript
import { LuArrowDown, LuArrowUp, ... } from "react-icons/lu";
```
To:
```typescript
import { LuChevronDown, LuChevronUp, ... } from "react-icons/lu";
```

Update icon references in JSX from `<LuArrowDown />` → `<LuChevronDown />` and `<LuArrowUp />` → `<LuChevronUp />`

Problem 2: Active weight uses variant='solid' + colorPalette='accent' (lines 68-69) — too visually heavy.
Solution: Change active weight button from:
```typescript
variant={isActive ? "solid" : "ghost"}
colorPalette="accent"
```
To:
```typescript
variant={isActive ? "outline" : "ghost"}
colorPalette="accent"
borderColor={isActive ? "accent.solid" : undefined}
color={isActive ? "accent.solid" : undefined}
```

This gives accent-colored outline and icon instead of filled background.

**Gap 3 Fix — Weight strip animation:**

Problem: Uses display property toggle (lines 53-56) which is not animatable.
Solution: Replace display toggle with max-width animation.

Find the inactive icon container (around lines 53-76). Change from:
```typescript
<Box
  display={isExpanded ? "flex" : "none"}
  gap={1}
>
  {/* inactive icons */}
</Box>
```

To:
```typescript
<Flex
  maxWidth={isExpanded ? "140px" : "0"}  // 5 icons × 28px = 140px
  overflow="hidden"
  gap={1}
  transition="max-width 0.2s ease-out"
>
  {/* inactive icons */}
</Flex>
```

This animates the expansion from 0 to 140px width smoothly. Adjust 140px based on actual icon count and size (28px per icon + gaps).

**CategoryParentRow.tsx:**

Problem 3: Row layout order wrong (edit/delete before weights, lines 114-144).
Problem 4: No tooltips on buttons (lines 114-140).
Problem 5: Buttons reserve space via opacity (should not render when hidden).

Fix the row layout order. Change from:
```typescript
<Flex>
  {/* name, count, etc */}
  {/* edit button */}
  {/* delete button */}
  <WeightPresetStrip />
</Flex>
```

To:
```typescript
<Flex align="center" gap={2} role="group">
  <LuFolder />
  <Text fontWeight="semibold">{toTitleCase(name)}</Text>
  <Badge ml={2}>{childCount}</Badge>
  <Box flex={1} />  {/* Spacer */}

  <WeightPresetStrip />

  {/* Edit button with tooltip */}
  <Tooltip content="Rename category">
    <IconButton
      aria-label="Rename"
      size="sm"
      variant="ghost"
      css={{ opacity: 0, _groupHover: { opacity: 1 } }}
    >
      <LuPencil />
    </IconButton>
  </Tooltip>

  {/* Delete button with tooltip */}
  <Tooltip content="Delete category">
    <IconButton
      aria-label="Delete"
      size="sm"
      variant="ghost"
      colorPalette="red"
      css={{ opacity: 0, _groupHover: { opacity: 1 } }}
    >
      <LuTrash2 />
    </IconButton>
  </Tooltip>
</Flex>
```

Note: Using `css={{ opacity: 0, _groupHover: { opacity: 1 } }}` with CSS visibility is acceptable. The "don't reserve space" requirement may be misinterpreted — it's fine to reserve space for layout stability, just hide with opacity. If truly needed to not reserve space, conditionally render based on a hover state, but that conflicts with the React.memo optimization from Plan 06. Stick with opacity approach.

Import Tooltip from Chakra UI at top: `import { Tooltip } from "@chakra-ui/react";`

**CategoryChildRow.tsx:**

Apply same fixes as ParentRow:
1. Reorder: drag handle, name, spacer, WeightPresetStrip, reset button (if has explicit weight), edit button, delete button
2. Add Tooltip wrappers on all IconButtons
3. Use CSS opacity for hover visibility: `css={{ opacity: 0, _groupHover: { opacity: 1 } }}`
4. Ensure parent Flex has `role="group"`

Tooltip content suggestions:
- Reset button: "Reset to inherited weight"
- Edit button: "Rename category"
- Delete button: "Delete category"
  </action>
  <verify>
Visual verification:
1. Weight icons:
   - Active weight has outline border (not filled)
   - Icons use chevrons (not arrows)
   - Active icon has accent color border and icon
2. Row layout:
   - Parent: folder, name, count, [space], weights, edit, delete
   - Child: line, drag, name, [space], weights, reset (if explicit), edit, delete
3. Hover over rows:
   - Buttons appear smoothly
   - Tooltips show on hover
4. Weight strip:
   - Collapsed shows only active icon
   - Hover expands smoothly over ~200ms (not instant pop)

Test animation:
1. Hover weight strip slowly — should see smooth width expansion
2. Hover on/off quickly — animation should feel natural, not jarring
  </verify>
  <done>
- Weight icons use chevrons (LuChevronDown/Up)
- Active weight uses outline variant with accent border
- Row layouts have correct element order
- Tooltips on all row buttons (edit, delete, reset)
- Weight preset strip animates with max-width transition
- Button visibility uses CSS opacity with _groupHover
  </done>
</task>

</tasks>

<verification>
Run full UAT Test 1, 2, 3 sequence:
1. Tree connector lines:
   - Last child has └── shape
   - Lines are 2px and visually clear
   - Child count next to parent name
2. Weight icons:
   - Chevrons (not arrows)
   - Outline styling (not solid fill)
   - Row elements in correct order
   - Tooltips on hover
3. Weight strip animation:
   - Smooth expansion (not instant)
   - Natural feel on hover on/off

Verify no layout shift when buttons appear/disappear.
</verification>

<success_criteria>
- [ ] Last child connector is L-shaped (└──)
- [ ] Connector lines are 2px with stronger color token
- [ ] Child count badge adjacent to parent name
- [ ] Weight icons use chevrons (LuChevronDown/Up)
- [ ] Active weight has outline variant with accent styling
- [ ] Row layout order matches specification
- [ ] Tooltips present on all row buttons
- [ ] Weight preset strip animates smoothly (max-width based)
- [ ] No layout shift on button visibility changes
</success_criteria>

<output>
After completion, create `.planning/phases/08.1-categories-settings-ui-redesign/08.1-08-SUMMARY.md`
</output>
