---
phase: 02-article-reading-ui
plan: "03"
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - frontend/src/app/layout.tsx
  - frontend/src/app/page.tsx
  - frontend/src/hooks/useArticles.ts
  - frontend/src/components/article/ArticleList.tsx
  - frontend/src/components/article/ArticleRow.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a list of articles with title, source, and date"
    - "Unread articles are visually distinct from read articles (opacity + dot indicator)"
    - "Default view shows only unread articles"
    - "User can toggle to show all articles (read + unread)"
    - "User can click a button to load more articles"
    - "User can manually mark an article as read or unread from the list"
  artifacts:
    - path: "frontend/src/hooks/useArticles.ts"
      provides: "TanStack Query hooks for articles with pagination and filtering"
      exports: ["useArticles", "useMarkAsRead"]
    - path: "frontend/src/components/article/ArticleList.tsx"
      provides: "Article list container with load-more and filter toggle"
    - path: "frontend/src/components/article/ArticleRow.tsx"
      provides: "Single article row with read state indicators"
  key_links:
    - from: "frontend/src/hooks/useArticles.ts"
      to: "frontend/src/lib/api.ts"
      via: "useQuery calling fetchArticles"
      pattern: "useQuery.*fetchArticles"
    - from: "frontend/src/components/article/ArticleList.tsx"
      to: "frontend/src/hooks/useArticles.ts"
      via: "hook consumption"
      pattern: "useArticles"
    - from: "frontend/src/components/article/ArticleRow.tsx"
      to: "frontend/src/hooks/useArticles.ts"
      via: "mark read/unread mutation"
      pattern: "useMarkAsRead"
---

<objective>
Build the article list view with article rows, read/unread visual state, filtering, and load-more pagination.

Purpose: Deliver the core browsing experience — users can see their articles, distinguish read from unread, filter the view, and load more content on demand.

Output: Working article list page showing articles from the backend API with read/unread indicators, filter toggle, load-more button, and manual mark-as-read.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-article-reading-ui/02-CONTEXT.md
@.planning/phases/02-article-reading-ui/02-RESEARCH.md
@.planning/phases/02-article-reading-ui/02-01-SUMMARY.md
@.planning/phases/02-article-reading-ui/02-02-SUMMARY.md
@frontend/src/lib/types.ts
@frontend/src/lib/api.ts
@frontend/src/lib/queryClient.ts
@frontend/src/components/ui/provider.tsx
@frontend/src/theme/index.ts
@frontend/src/components/layout/AppShell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create article hooks and compose providers in layout</name>
  <files>
    frontend/src/hooks/useArticles.ts
    frontend/src/app/layout.tsx
  </files>
  <action>
    1. Create `frontend/src/hooks/useArticles.ts`:
       - 'use client' (uses hooks)
       - Import `useQuery`, `useMutation`, `useQueryClient` from @tanstack/react-query
       - Import `fetchArticles`, `updateArticleReadStatus` from @/lib/api
       - Import `Article` from @/lib/types

       **useArticles hook:**
       - Parameters: `{ showAll?: boolean; limit?: number }` (showAll = false means unread only)
       - Uses `useQuery` with key `["articles", { is_read: showAll ? undefined : false, limit }]`
       - Calls `fetchArticles({ is_read: showAll ? undefined : false, limit })`
       - Returns query result (data, isLoading, error, etc.)

       **useLoadMoreArticles pattern:**
       - The hook should support incremental loading. Use a state variable for current `limit` (start at 50).
       - Expose a `loadMore` function that increases the limit by 50
       - Expose `hasMore` boolean (true if returned count equals current limit)

       **useMarkAsRead hook:**
       - Uses `useMutation` calling `updateArticleReadStatus`
       - On success: invalidate the `["articles"]` query key to refresh the list
       - Returns the mutation function and state

    2. Update `frontend/src/app/layout.tsx`:
       - Compose BOTH providers: Chakra Provider (from 02-01) AND QueryClientProvider (from 02-02)
       - Chakra Provider should be the outermost, QueryClientProvider inside it
       - Import QueryClientProvider from @tanstack/react-query
       - Import queryClient from @/lib/queryClient
       - The structure should be:
         ```
         <html suppressHydrationWarning>
           <body>
             <ChakraProvider>
               <QueryClientProvider client={queryClient}>
                 {children}
               </QueryClientProvider>
             </ChakraProvider>
           </body>
         </html>
         ```
       - If 02-01 created a separate providers.tsx, compose within that file instead
  </action>
  <verify>
    ```bash
    cd frontend && npx tsc --noEmit
    ```
    TypeScript compiles. Hooks are importable and properly typed.
  </verify>
  <done>
    - useArticles hook returns articles with pagination support and is_read filtering
    - useMarkAsRead hook mutates article read status and invalidates cache
    - Both Chakra and TanStack Query providers composed in layout
    - TypeScript compiles cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Build ArticleRow and ArticleList components</name>
  <files>
    frontend/src/components/article/ArticleRow.tsx
    frontend/src/components/article/ArticleList.tsx
    frontend/src/app/page.tsx
  </files>
  <action>
    **Use the Chakra UI MCP server** for component examples (box, text, button, flex, stack, skeleton, switch).

    1. Create `frontend/src/components/article/ArticleRow.tsx`:
       - 'use client' directive
       - Props: `{ article: Article; onSelect: (article: Article) => void; onToggleRead: (article: Article) => void }`
       - **Layout** (per user decision: "relaxed list layout, multi-line rows with breathing room"):
         - Clickable row that calls `onSelect` when clicked
         - Left side: Small unread indicator dot (accent color, ~8px circle) — visible only for unread articles
         - Main content area:
           - Title: single line, truncated with ellipsis (text-overflow: ellipsis, white-space: nowrap, overflow: hidden)
           - Second line: muted source name (from feed_id — for now show "Feed" as placeholder since we don't join feed title) + relative date (e.g., "2h ago", "3 days ago")
         - Right side: Read/unread toggle button (small icon button, eye/eye-off or circle)
       - **Read state visual indicators** (per user decision):
         - Unread: full opacity + accent-colored dot on left
         - Read: reduced opacity (0.6) + no dot
       - Reserve empty space below the second line for future LLM reasoning/summary (Phase 5) — a simple empty Box with `minH="0"` that can be filled later
       - Hover state: subtle background change using `_hover={{ bg: "bg.subtle" }}`
       - Use semantic tokens for all colors
       - Padding: generous (py={3} px={4} or similar for breathing room)
       - Bottom border between rows: `border.subtle`

    2. Create `frontend/src/components/article/ArticleList.tsx`:
       - 'use client' directive
       - Uses `useArticles` hook
       - **State:**
         - `showAll: boolean` (default false — show unread only per user decision)
         - `selectedArticle: Article | null` (for future drawer integration)
       - **UI elements:**
         - Top bar: "Unread" / "All" toggle (Chakra SegmentedControl, Switch, or two Buttons) to control `showAll`
         - Article count display (e.g., "24 unread articles")
         - List of ArticleRow components
         - Loading state: show 5 Skeleton rows while data is loading
         - Empty state: show a friendly message when no articles match filter
         - "Load more" button at bottom (per user decision: NOT infinite scroll, NOT pagination)
           - Only visible when `hasMore` is true
           - Disabled while loading
           - Uses accent colorPalette
       - Pass `onSelect` and `onToggleRead` handlers to each ArticleRow
       - `onToggleRead` calls the `useMarkAsRead` mutation
       - `onSelect` sets `selectedArticle` state (drawer will come in Plan 02-04)

    3. Update `frontend/src/app/page.tsx`:
       - Import AppShell (from 02-01) and ArticleList
       - Render ArticleList inside AppShell's content area
       - This is the main page — the entire article browsing experience

    **Date formatting helper:**
    - Create a simple `formatRelativeDate` function (inline or in a utils file)
    - Shows "Xm ago", "Xh ago", "Xd ago", or the date for older articles
    - No external library needed for this
  </action>
  <verify>
    ```bash
    cd frontend && npm run build
    ```
    Build succeeds. The article list page compiles and renders.

    To test with live data:
    ```bash
    cd frontend && npm run dev
    ```
    Visit http://localhost:3210 — should show article list (requires backend running on port 8912).
  </verify>
  <done>
    - ArticleRow displays title (truncated), source, date with relaxed spacing
    - Unread articles have accent dot + full opacity; read articles are faded
    - ArticleList shows articles with unread/all toggle (default: unread only)
    - Load more button at bottom loads additional articles
    - Loading state shows skeleton placeholders
    - Empty state shows friendly message
    - Manual read/unread toggle works via API mutation
    - Build passes cleanly
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` — passes without errors
2. Article list renders with proper layout (title, source, date per row)
3. Unread articles visually distinct from read articles (opacity + dot)
4. "Unread" / "All" toggle switches the view filter
5. "Load more" button appears and loads additional articles
6. Manual mark read/unread toggles article state
7. Loading skeletons show during data fetch
8. Empty state shows when no articles match filter
</verification>

<success_criteria>
- Article list view fully functional with live backend data
- Read/unread visual state and filtering working
- Load more pagination working
- Manual read/unread toggle working
- Clean, relaxed layout matching user's design preferences
</success_criteria>

<output>
After completion, create `.planning/phases/02-article-reading-ui/02-03-SUMMARY.md`
</output>
