---
phase: 02-article-reading-ui
plan: "04"
type: execute
wave: 2
depends_on: ["02-01", "02-03"]
files_modified:
  - frontend/src/components/article/ArticleReader.tsx
  - frontend/src/components/article/ArticleList.tsx
  - frontend/src/hooks/useAutoMarkAsRead.ts
  - frontend/package.json
autonomous: true

must_haves:
  truths:
    - "User can open an article to read full content in a slide-in panel from the right"
    - "Reader panel is ~75% width on desktop and full-screen on mobile"
    - "User can close the reader via X button or clicking the backdrop"
    - "User can navigate between articles with prev/next arrows inside the reader"
    - "User can click a link to open the original article URL in a new browser tab"
    - "Article is auto-marked as read after ~12 seconds of viewing in the reader"
    - "Reader uses serif typography with generous spacing for comfortable reading"
    - "Images in article content are constrained to max-width and max-height"
  artifacts:
    - path: "frontend/src/components/article/ArticleReader.tsx"
      provides: "Slide-in drawer panel for reading full article content"
    - path: "frontend/src/hooks/useAutoMarkAsRead.ts"
      provides: "Hook that auto-marks article as read after visibility timer"
  key_links:
    - from: "frontend/src/components/article/ArticleList.tsx"
      to: "frontend/src/components/article/ArticleReader.tsx"
      via: "selectedArticle state + drawer open/close"
      pattern: "selectedArticle"
    - from: "frontend/src/components/article/ArticleReader.tsx"
      to: "frontend/src/hooks/useAutoMarkAsRead.ts"
      via: "auto-mark timer on reader open"
      pattern: "useAutoMarkAsRead"
    - from: "frontend/src/hooks/useAutoMarkAsRead.ts"
      to: "frontend/src/hooks/useArticles.ts"
      via: "useMarkAsRead mutation"
      pattern: "useMarkAsRead"
---

<objective>
Build the article reader drawer panel with auto-mark-as-read behavior.

Purpose: Deliver the in-app reading experience — a slide-in panel showing full article content with clean serif typography, prev/next navigation, and a link to the original URL. Articles are auto-marked as read after ~12 seconds of viewing.

Output: Functional article reader that opens when clicking an article row, renders full content, supports navigation between articles, and auto-marks articles as read.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-article-reading-ui/02-CONTEXT.md
@.planning/phases/02-article-reading-ui/02-RESEARCH.md
@.planning/phases/02-article-reading-ui/02-01-SUMMARY.md
@.planning/phases/02-article-reading-ui/02-02-SUMMARY.md
@.planning/phases/02-article-reading-ui/02-03-SUMMARY.md
@frontend/src/lib/types.ts
@frontend/src/lib/api.ts
@frontend/src/hooks/useArticles.ts
@frontend/src/components/article/ArticleList.tsx
@frontend/src/components/article/ArticleRow.tsx
@frontend/src/theme/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auto-mark-as-read hook</name>
  <files>
    frontend/src/hooks/useAutoMarkAsRead.ts
  </files>
  <action>
    1. Create `frontend/src/hooks/useAutoMarkAsRead.ts`:
       - 'use client' directive
       - Parameters: `(articleId: number, isRead: boolean)`
       - Uses `useMarkAsRead` mutation from `useArticles.ts`
       - When called with an unread article, starts a ~12 second timer
       - After timer elapses, calls the mark-as-read mutation
       - If the component unmounts or articleId changes before timer elapses, clear the timer
       - If article is already read, do nothing
       - Use `useEffect` with `useRef` for the timer to handle cleanup properly
       - Return nothing (fire-and-forget behavior)
  </action>
  <verify>
    ```bash
    cd frontend && npx tsc --noEmit
    ```
    TypeScript compiles. Hook is importable and properly typed.
  </verify>
  <done>
    - Auto-mark hook starts 12-second timer for unread articles
    - Timer cleans up on unmount or article change
    - Already-read articles skip the timer
    - TypeScript compiles cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Build ArticleReader drawer component</name>
  <files>
    frontend/src/components/article/ArticleReader.tsx
    frontend/src/components/article/ArticleList.tsx
  </files>
  <action>
    **Use the Chakra UI MCP server** (`mcp__chakra-ui__get_component_example` for `drawer`) to get the correct v3 Drawer API.

    1. Create `frontend/src/components/article/ArticleReader.tsx`:
       - 'use client' directive
       - Props: `{ article: Article | null; articles: Article[]; onClose: () => void; onNavigate: (article: Article) => void }`
       - Uses Chakra's Drawer component (from ui snippets or direct import):
         - `placement="end"` (slides from right)
         - `size="xl"` or custom width (~75% on desktop via CSS)
         - Open when `article` is not null
         - Closes on backdrop click and X button (via `onOpenChange` or `onClose`)
       - **Header section:**
         - Article title in serif font (reader.heading text style)
         - Source name + publication date
         - "Open original" link button that opens `article.url` in new tab (`target="_blank"`, `rel="noopener noreferrer"`)
         - Close button (X) via Drawer.CloseTrigger
       - **Navigation:**
         - Prev/next arrow buttons (positioned at top or in header)
         - Determine prev/next from the `articles` array based on current article's position
         - Disabled at boundaries (no prev for first, no next for last)
         - Calls `onNavigate` with the adjacent article
       - **Body section:**
         - Render `article.content` (HTML string) using `dangerouslySetInnerHTML`
         - If content is null/empty, fall back to `article.summary`
         - Apply serif typography (reader text style from theme)
         - Style article content with CSS:
           - `img { max-width: 100%; height: auto; max-height: 600px; object-fit: contain; }`
           - Generous line-height (1.8+) and font-size (18-20px)
           - Links styled with accent color
           - Headings, paragraphs, lists properly spaced
         - Wrap content in a Box with `className` for scoped CSS or use Chakra's `css` prop
       - **Auto-mark as read:**
         - Call `useAutoMarkAsRead(article.id, article.is_read)` when an article is displayed
       - **Responsive:**
         - On screens smaller than `md`: drawer is full-width (100%)
         - On larger screens: ~75% width

    2. Update `frontend/src/components/article/ArticleList.tsx`:
       - Add `selectedArticle` state (Article | null, default null)
       - Wire `onSelect` handler on ArticleRow to set `selectedArticle`
       - Render ArticleReader at the bottom of the component:
         ```
         <ArticleReader
           article={selectedArticle}
           articles={data?.articles ?? []}
           onClose={() => setSelectedArticle(null)}
           onNavigate={(article) => setSelectedArticle(article)}
         />
         ```
       - When navigating between articles in the reader, update `selectedArticle`
  </action>
  <verify>
    ```bash
    cd frontend && npm run build
    ```
    Build succeeds. The reader drawer compiles and integrates with the article list.

    To test with live data:
    ```bash
    cd frontend && npm run dev
    ```
    Visit http://localhost:3210 — click an article to open the reader drawer.
  </verify>
  <done>
    - ArticleReader drawer slides in from right (~75% width desktop, full-screen mobile)
    - Article title, source, and date displayed in header
    - Full article content rendered with serif typography
    - Images constrained to max-width with proper aspect ratio
    - "Open original" link opens article URL in new tab
    - Close via X button or backdrop click
    - Prev/next navigation between articles
    - Auto-mark as read after ~12 seconds of viewing
    - Integrates with ArticleList via selectedArticle state
    - Build passes cleanly
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` — passes without errors
2. Clicking an article row opens the reader drawer from the right
3. Drawer is ~75% width on desktop, full-screen on mobile
4. Article content renders with serif typography and constrained images
5. "Open original" link opens the article URL in a new tab
6. X button and backdrop click close the drawer
7. Prev/next arrows navigate between articles
8. After ~12 seconds in the reader, unread article is auto-marked as read
</verification>

<success_criteria>
- Article reader drawer fully functional
- All Phase 2 success criteria met when combined with Plans 01-03
- Auto-mark as read working with proper timer cleanup
- Clean, comfortable reading experience with serif typography
</success_criteria>

<output>
After completion, create `.planning/phases/02-article-reading-ui/02-04-SUMMARY.md`
</output>
