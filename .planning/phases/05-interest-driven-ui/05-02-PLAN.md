---
phase: 05-interest-driven-ui
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/components/article/ScoreBadge.tsx
  - frontend/src/components/article/SortSelect.tsx
  - frontend/src/components/article/ArticleRow.tsx
  - frontend/src/components/article/ArticleList.tsx
autonomous: true

must_haves:
  truths:
    - "User can see a color-coded score badge on each scored article"
    - "High-score articles (>=15) have an accent-colored badge that stands out"
    - "Unscored/in-progress articles show appropriate state indicator (dash, spinner, clock)"
    - "User can change sort order via a dropdown in the article list toolbar"
    - "Changing the sort dropdown immediately re-sorts the article list"
    - "Empty state message explains context when no articles match current sort/filter"
  artifacts:
    - path: "frontend/src/components/article/ScoreBadge.tsx"
      provides: "Color-coded Badge component for composite scores"
      contains: "colorPalette"
    - path: "frontend/src/components/article/SortSelect.tsx"
      provides: "Sort dropdown with 4 options (score/date x asc/desc)"
      contains: "NativeSelect"
    - path: "frontend/src/components/article/ArticleRow.tsx"
      provides: "Article row with ScoreBadge replacing plain text score"
      contains: "ScoreBadge"
    - path: "frontend/src/components/article/ArticleList.tsx"
      provides: "Article list with SortSelect in toolbar and useSortParams"
      contains: "SortSelect"
  key_links:
    - from: "frontend/src/components/article/ArticleList.tsx"
      to: "frontend/src/hooks/useSortParams.ts"
      via: "useSortParams hook call"
      pattern: "useSortParams"
    - from: "frontend/src/components/article/ArticleList.tsx"
      to: "frontend/src/hooks/useArticles.ts"
      via: "sortBy and order passed to useArticles"
      pattern: "useArticles.*sortBy"
    - from: "frontend/src/components/article/ArticleList.tsx"
      to: "frontend/src/components/article/SortSelect.tsx"
      via: "SortSelect component with value/onChange"
      pattern: "SortSelect"
    - from: "frontend/src/components/article/ArticleRow.tsx"
      to: "frontend/src/components/article/ScoreBadge.tsx"
      via: "ScoreBadge component receiving score and scoringState"
      pattern: "ScoreBadge"
---

<objective>
Add visual score badges and sort controls to the article list UI.

Purpose: Complete the interest-driven presentation so users can see score indicators and control article ordering.
Output: ScoreBadge component, SortSelect dropdown, updated ArticleRow and ArticleList.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-interest-driven-ui/05-RESEARCH.md
@.planning/phases/05-interest-driven-ui/05-01-SUMMARY.md
@frontend/src/components/article/ArticleRow.tsx
@frontend/src/components/article/ArticleList.tsx
@frontend/src/components/article/TagChip.tsx
@frontend/src/hooks/useSortParams.ts
@frontend/src/hooks/useArticles.ts
@frontend/src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ScoreBadge component and integrate into ArticleRow</name>
  <files>
    frontend/src/components/article/ScoreBadge.tsx
    frontend/src/components/article/ArticleRow.tsx
  </files>
  <action>
**ScoreBadge.tsx** — Create a new component that displays the composite score as a Chakra Badge:

```
Props: { score: number | null; scoringState: string }
```

Rendering logic:
- If `scoringState === "scoring"`: render `<Spinner size="xs" colorPalette="accent" />`
- If `scoringState === "queued"`: render `<LuClock size={14} />` with `color="fg.muted"`
- If `scoringState === "unscored"`: render dash `—` in `fg.muted`
- If `scoringState === "failed"`: render red X `✕` in `red.fg`
- If `scoringState === "scored"` and `score !== null`: render a `<Badge>` with:
  - `colorPalette="accent"` and `variant="solid"` for score >= 15 (high interest)
  - `colorPalette="accent"` and `variant="subtle"` for score >= 10 (medium interest)
  - `colorPalette="gray"` and `variant="subtle"` for score < 10 (low interest)
  - `size="sm"`, display `score.toFixed(1)`

Import Badge from `@chakra-ui/react`, Spinner from `@chakra-ui/react`, LuClock from `react-icons/lu`.

**ArticleRow.tsx** — Replace the inline scoring state indicator block (the entire `<Box fontSize="xs" color="fg.muted">...</Box>` section at the bottom of the row) with a single `<ScoreBadge score={article.composite_score} scoringState={article.scoring_state} />`. Remove the now-unused Text and Spinner imports if they become orphaned by this change (check if Text/Spinner are used elsewhere in the file first).
  </action>
  <verify>
Run TypeScript type checking:
```
cd frontend && npx tsc --noEmit
```
Verify in browser: scored articles show colored badges instead of plain text numbers. High-score articles (>=15) have accent-colored solid badges. Low-score articles have gray subtle badges.
  </verify>
  <done>
ScoreBadge component renders color-coded badges based on score thresholds. ArticleRow uses ScoreBadge instead of inline scoring display. All non-scored states (queued, scoring, unscored, failed) display appropriate indicators.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SortSelect component and wire into ArticleList with useSortParams</name>
  <files>
    frontend/src/components/article/SortSelect.tsx
    frontend/src/components/article/ArticleList.tsx
  </files>
  <action>
**SortSelect.tsx** — Create a sort dropdown component using Chakra's NativeSelect:

```
Props: { value: string; onChange: (value: string) => void }
```

Use `NativeSelectRoot` and `NativeSelectField` from `@chakra-ui/react` with `size="sm"` and `width="auto"`. Options:
- `score_desc` — "Highest Score"
- `score_asc` — "Lowest Score"
- `date_desc` — "Newest First"
- `date_asc` — "Oldest First"

The `value` prop maps to the combined sort+order string (e.g. "score_desc"). The `onChange` fires with the new selected value string.

**ArticleList.tsx** — Integrate the sort controls:

1. Import `useSortParams` from `@/hooks/useSortParams` and `SortSelect` from `./SortSelect`.
2. Call `useSortParams()` to get `{ sortBy, order, sortValue, setSortValue }`.
3. Pass `sortBy` and `order` to `useArticles({ showAll, feedId, sortBy, order })`.
4. In the top bar `<Flex>`, add the `<SortSelect value={sortValue} onChange={setSortValue} />` next to the article count text on the right side. Place it before the count text, separated by a small gap.
5. Update the empty state message to be context-aware:
   - If `sortBy === "composite_score"` and articles is empty and `!showAll`: "No scored unread articles yet. Scoring may be in progress."
   - If `sortBy === "composite_score"` and articles is empty and `showAll`: "No scored articles yet. Articles are scored after feed refresh."
   - Keep existing messages for date-sorted views (they're already good).

Layout note: The right side of the toolbar should be `<Flex gap={3} alignItems="center">` containing the SortSelect and the count text. This keeps the left side (Unread/All buttons) and right side (sort + count) balanced.
  </action>
  <verify>
Run TypeScript type checking:
```
cd frontend && npx tsc --noEmit
```
Verify in browser:
1. Sort dropdown appears in the toolbar next to the article count
2. Selecting "Newest First" changes URL to `?sort=published_at&order=desc` and re-sorts articles
3. Selecting "Highest Score" changes URL to `?sort=composite_score&order=desc` and shows highest-scored articles first
4. Browser back button restores previous sort selection
5. Empty state shows appropriate message when sorting by score with no scored articles
  </verify>
  <done>
SortSelect dropdown renders 4 sort options. ArticleList integrates useSortParams and passes sort state to useArticles. Sort changes update URL and trigger data refetch. Empty state messaging is context-aware for score-based sorting.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. Scored articles display color-coded Badge components (accent solid for >=15, accent subtle for >=10, gray subtle for <10)
3. Non-scored articles show appropriate state indicators (spinner, clock, dash, red X)
4. Sort dropdown is visible in toolbar with 4 options
5. Changing sort triggers data refetch and re-renders list in new order
6. URL updates reflect sort selection and browser back button works
7. Empty state explains context when no articles match filters
</verification>

<success_criteria>
- ScoreBadge shows color-coded badges with 3 visual tiers (high/medium/low)
- SortSelect dropdown has 4 sort options (score desc/asc, date desc/asc)
- Changing sort updates URL params and refetches articles
- ArticleList passes sort params from useSortParams to useArticles
- Empty state is context-aware for score-based sorting
</success_criteria>

<output>
After completion, create `.planning/phases/05-interest-driven-ui/05-02-SUMMARY.md`
</output>
