---
phase: 09.5-refine-main-view-ux-and-typography
plan: 05
type: execute
wave: 3
depends_on: ["09.5-04"]
files_modified:
  - frontend/src/components/article/ArticleReader.tsx
  - frontend/src/components/article/ArticleList.tsx
autonomous: false
requirements: []

must_haves:
  truths:
    - "Escape key closes the reader (back to list)"
    - "J key navigates to next article, K key navigates to previous article"
    - "Keyboard shortcuts don't fire when user is typing in an input/textarea"
    - "Reader typography and spacing are refined for comfortable long-form reading"
    - "Reader visual styling is cohesive with settings pages"
  artifacts:
    - path: "frontend/src/components/article/ArticleReader.tsx"
      provides: "Keyboard shortcuts via useEffect keydown listener"
      contains: "keydown"
  key_links:
    - from: "frontend/src/components/article/ArticleReader.tsx"
      to: "document keydown listener"
      via: "useEffect with addEventListener/removeEventListener"
      pattern: "addEventListener.*keydown"
---

<objective>
Add keyboard shortcuts for reader navigation and apply final typography/spacing polish.

Purpose: Keyboard navigation (Escape, J/K) makes the reader feel native and efficient for power users. Typography refinements ensure a comfortable long-form reading experience.
Output: Keyboard shortcuts in ArticleReader, refined spacing/sizing.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09.5-refine-main-view-ux-and-typography/09.5-CONTEXT.md
@.planning/phases/09.5-refine-main-view-ux-and-typography/09.5-RESEARCH.md
@.planning/phases/09.5-refine-main-view-ux-and-typography/09.5-04-SUMMARY.md
@frontend/src/components/article/ArticleReader.tsx
@frontend/src/components/article/ArticleList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add keyboard shortcuts and typography polish to ArticleReader</name>
  <files>
    frontend/src/components/article/ArticleReader.tsx
    frontend/src/components/article/ArticleList.tsx
  </files>
  <action>
**ArticleReader.tsx — Keyboard shortcuts:**

Add a `useEffect` with a `keydown` event listener on `document`:
```tsx
useEffect(() => {
  const handler = (e: KeyboardEvent) => {
    // Don't capture when user is typing in inputs
    const tag = (e.target as HTMLElement)?.tagName;
    if (tag === "INPUT" || tag === "TEXTAREA" || tag === "SELECT") return;

    if (e.key === "Escape") onClose();
    if ((e.key === "j" || e.key === "J") && nextArticle) onNavigate(nextArticle);
    if ((e.key === "k" || e.key === "K") && prevArticle) onNavigate(prevArticle);
  };
  document.addEventListener("keydown", handler);
  return () => document.removeEventListener("keydown", handler);
}, [onClose, onNavigate, prevArticle, nextArticle]);
```

Dependencies: `onClose`, `onNavigate`, `prevArticle`, `nextArticle`. These should be stable references (onClose and onNavigate come from parent, prevArticle/nextArticle from useMemo).

**Typography and spacing refinements:**

Review and refine the reader layout from Plan 04:
- Ensure the article title in the body (not the sticky header) uses `fontFamily="serif"` (Lora) for the reader heading style, matching the existing `textStyle="reader.heading"` pattern
- Metadata line: `fontSize="sm"`, `color="fg.muted"`, consistent spacing
- Score reasoning: `fontStyle="italic"`, `lineHeight="1.6"`, `color="fg.muted"`
- Content area: confirm `fontFamily="serif"` (Lora) for body text, `fontSize="1.125rem"` (18px), `lineHeight="1.85"`
- Paragraph spacing: `mb="1.25rem"` (20px)
- Heading hierarchy in content: `fontFamily="sans"` (Inter) for headings within articles, `fontWeight="600"`, graduated font sizes
- Ensure the "Open original" link is accessible — it's in the sticky header as an icon button, but also add a text link at the bottom of the content area ("Read on [feed name] →") for discoverability at the end of reading

**Spacing refinement:**
- Reader content padding: `px={{ base: 4, md: 8 }}`, `py={6}` for the content wrapper below sticky header
- Space between metadata and content: adequate `mb={8}` or `mb={10}` after the metadata/score section before content
- Ensure the bottom of the reader has sufficient padding (`pb={16}` or similar) so the last content doesn't feel jammed against the viewport bottom

**ArticleList.tsx — Scroll to top on article selection:**
When `setSelectedArticle` is called (user clicks a row), scroll the window/content to top so the reader starts at the top:
```tsx
const handleSelect = (article: ArticleListItem) => {
  // Save scroll position before showing reader
  scrollPositionRef.current = window.scrollY;
  setSelectedArticle(article);
  window.scrollTo(0, 0);
};
```
And on close, restore:
```tsx
const handleClose = () => {
  setSelectedArticle(null);
  requestAnimationFrame(() => {
    window.scrollTo(0, scrollPositionRef.current);
  });
};
```
If this wasn't already handled in Plan 04, add it here. If it was, verify it works correctly.

**Update frontend rules:**
After completing, update `.claude/rules/frontend.md` UI Patterns section to reflect:
- Reader is inline (replaces article list), not a drawer
- Keyboard shortcuts: Escape closes, J/K for next/prev
- Remove "Full opacity + accent dot for unread, 0.6 opacity + hollow dot for read" line and replace with the new read/unread pattern
  </action>
  <verify>
`cd /Users/cstalhem/projects/rss-reader/frontend && bun run build` — builds with no errors. Pressing Escape closes reader, J/K navigate articles.
  </verify>
  <done>
Keyboard shortcuts (Escape, J, K) work in the reader. Typography uses Lora for content, Inter for UI. Spacing is refined with adequate padding and margins. Scroll position is saved and restored. Frontend rules updated.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of the complete main view redesign</name>
  <files>None — verification only</files>
  <action>
Present the complete main view UX and typography redesign for user verification:
- Sidebar with logo at top, feeds in middle, settings+theme at bottom
- Collapsed sidebar with icon-only layout
- Article rows with summary preview, read/unread typography distinction, context menu
- Filter dropdown with counts, sticky scroll-collapse toolbar
- Feed name heading at top
- Inline reader replacing drawer, with sticky header and keyboard shortcuts
- html-react-parser content rendering with DOMPurify sanitization
- Mark all read for both single feed and all articles

**How to verify:**
1. Start dev servers: `cd backend && uv run uvicorn backend.main:app --reload --port 8912` and `cd frontend && bun dev --port 3210`
2. Open http://localhost:3210

**Sidebar:** Logo at top, feed list scrollable, settings+theme+collapse at bottom, collapsed icon-only state, dot badge on settings icon.

**Article list:** Feed name heading, filter dropdown with counts, sticky scroll-collapse, mark-all-read icon, summary preview rows, unread=semibold+bg+dot, read=regular+no-dot, hover context menu on read articles.

**Reader:** Click article shows inline reader, sidebar stays, sticky header with title+nav+close, J/K/Escape shortcuts, correct content rendering, scroll position restored on close.

**Mobile:** Hamburger in content area, opens sidebar drawer, drawer has logo+settings+theme.
  </action>
  <verify>User confirms all visual and functional aspects match the locked decisions from CONTEXT.md.</verify>
  <done>User types "approved" confirming the complete main view redesign.</done>
</task>

</tasks>

<verification>
1. `cd frontend && bun run build` — no errors
2. `cd frontend && bun run lint` — no errors
3. `cd backend && uv run pytest` — all tests pass
4. Visual verification via dev server confirms all locked decisions from CONTEXT.md
</verification>

<success_criteria>
- Keyboard shortcuts (Escape, J, K) work without interfering with input fields
- Typography: Lora for reader content, Inter for UI elements
- Spacing: adequate padding, breathing room, proper heading hierarchy
- "Read on [feed name]" link at bottom of reader for discoverability
- Scroll position restored when closing reader
- Frontend rules updated to reflect new patterns
- All locked decisions from CONTEXT.md verified in visual checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/09.5-refine-main-view-ux-and-typography/09.5-05-SUMMARY.md`
</output>
