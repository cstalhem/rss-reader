---
phase: 09.5-refine-main-view-ux-and-typography
plan: 03
type: execute
wave: 2
depends_on: ["09.5-01", "09.5-02"]
files_modified:
  - frontend/src/components/article/ArticleList.tsx
  - frontend/src/components/article/ArticleRow.tsx
  - frontend/src/components/article/ArticleRowContextMenu.tsx
  - frontend/src/components/article/SortSelect.tsx
  - frontend/src/lib/constants.ts
autonomous: true
requirements: []

must_haves:
  truths:
    - "Article rows show a 1-2 line summary_preview or score_reasoning below the title"
    - "Score reasoning has a subtle brain/sparkle icon prefix to signal AI-generated content"
    - "Read/unread state has typography weight shift (semibold unread, regular read) plus subtle background tint for unread"
    - "Read articles have no dot at all (space collapsed), unread articles have filled accent dot"
    - "Read articles show a hover-reveal context menu (ellipsis) on the far right with Mark unread, Open original, Rescore"
    - "High-score row background tint (accent.subtle) is removed — score badge alone signals high scores"
    - "Filter is a dropdown with counts, not individual buttons"
    - "Mark all read is always-visible icon button (works for All Articles too via cross-feed endpoint)"
    - "Feed name heading at top of content area shows 'Articles' for All Articles or specific feed name"
    - "On scroll, controls bar becomes sticky and feed name collapses inline"
    - "Mobile hamburger icon opens mobile sidebar"
  artifacts:
    - path: "frontend/src/components/article/ArticleRow.tsx"
      provides: "Redesigned article row with summary preview, new read/unread styling, context menu"
      contains: "summary_preview"
    - path: "frontend/src/components/article/ArticleRowContextMenu.tsx"
      provides: "Context menu with Mark unread, Open original, Rescore actions"
      contains: "Rescore"
    - path: "frontend/src/components/article/ArticleList.tsx"
      provides: "Feed heading, filter dropdown, sticky scroll-collapse toolbar, mobile hamburger"
      contains: "IntersectionObserver"
  key_links:
    - from: "frontend/src/components/article/ArticleRow.tsx"
      to: "frontend/src/components/article/ArticleRowContextMenu.tsx"
      via: "conditional render on hover for read articles"
      pattern: "ArticleRowContextMenu"
    - from: "frontend/src/components/article/ArticleList.tsx"
      to: "frontend/src/lib/api.ts"
      via: "markAllArticlesRead and rescoreArticle"
      pattern: "useMarkAllArticlesRead"
---

<objective>
Redesign article rows and the toolbar/controls bar with all locked decisions from CONTEXT.md.

Purpose: Improve information density (summary preview), visual scanning (read/unread distinction), and toolbar usability (filter dropdown, sticky collapse, always-visible mark-all-read).
Output: Redesigned ArticleRow, new ArticleRowContextMenu, overhauled ArticleList toolbar with feed heading and scroll-collapse.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09.5-refine-main-view-ux-and-typography/09.5-CONTEXT.md
@.planning/phases/09.5-refine-main-view-ux-and-typography/09.5-RESEARCH.md
@.planning/phases/09.5-refine-main-view-ux-and-typography/09.5-01-SUMMARY.md
@.planning/phases/09.5-refine-main-view-ux-and-typography/09.5-02-SUMMARY.md
@frontend/src/components/article/ArticleRow.tsx
@frontend/src/components/article/ArticleList.tsx
@frontend/src/components/article/SortSelect.tsx
@frontend/src/lib/types.ts
@frontend/src/lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign ArticleRow — summary preview, read/unread styling, context menu</name>
  <files>
    frontend/src/components/article/ArticleRow.tsx
    frontend/src/components/article/ArticleRowContextMenu.tsx
  </files>
  <action>
**ArticleRow.tsx — Redesign per CONTEXT.md locked decisions:**

1. **Summary/preview line below title:**
   - Show `article.score_reasoning` if available (article has been scored), otherwise show `article.summary_preview` (RSS summary)
   - When showing score_reasoning, prefix with a subtle `LuSparkles` icon (size 14, color fg.muted, inline) to signal AI-generated content
   - Text: `fontSize="sm"`, `color="fg.muted"`, 2-line clamp via `css={{ WebkitLineClamp: 2, WebkitBoxOrient: "vertical", display: "-webkit-box", overflow: "hidden" }}`
   - If neither score_reasoning nor summary_preview is available, don't render the line

2. **Read/unread styling changes:**
   - **Unread:** `fontWeight="semibold"` on title, subtle unread background tint (e.g., `bg="bg.subtle"` or a very subtle accent tint), keep filled accent dot, dot is clickable to toggle
   - **Read:** `fontWeight="normal"` on title, no background tint, **remove the dot entirely** — no dot, no placeholder space. The dot `<Box>` should only render when `!article.is_read`.
   - Remove the `opacity={article.is_read ? 0.6 : 1}` pattern — use typography weight + bg tint instead of opacity
   - Remove `isHighScored` accent.subtle background — per decision: "Remove high-score row background tint (accent.subtle) — score badge alone signals high scores"

3. **Context menu (hover-reveal) for read articles:**
   - Only render for read articles (`article.is_read && !article currently hovered` logic)
   - Use conditional mount on hover pattern (per research): track `isHovered` state via onMouseEnter/onMouseLeave on the row
   - When `isHovered && article.is_read`, render `<ArticleRowContextMenu>` on the far right
   - Use `LuEllipsisVertical` icon button trigger (existing pattern from CategoryContextMenu)

**New file: ArticleRowContextMenu.tsx:**
- Reuse the CategoryContextMenu pattern: `Menu.Root > Menu.Trigger asChild > IconButton > Portal > Menu.Positioner > Menu.Content > Menu.Item`
- Three menu items:
  1. "Mark unread" — calls `onMarkUnread` prop (which calls markAsRead mutation with is_read: false)
  2. "Open original" — opens `article.url` in a new tab via `window.open`
  3. "Rescore" — calls `onRescore` prop (which calls rescoreArticle)
- Props: `article: ArticleListItem`, `onMarkUnread: () => void`, `onRescore: () => void`
- Use `LuMailOpen`, `LuExternalLink`, `LuRefreshCw` icons for the menu items
- **IMPORTANT:** Since this is conditionally mounted on hover, there are 0-1 Menu.Root instances at any time (no Zag multiplier concern).
  </action>
  <verify>
`cd /Users/cstalhem/projects/rss-reader/frontend && bun run lint` — no lint errors. Article rows show summary line and correct read/unread styling.
  </verify>
  <done>
Article rows show summary_preview or score_reasoning below the title. Read/unread uses typography weight + bg tint (no opacity). Read articles show no dot. Hover-reveal context menu on read articles with Mark unread, Open original, Rescore.
  </done>
</task>

<task type="auto">
  <name>Task 2: Overhaul ArticleList — feed heading, filter dropdown, sticky scroll-collapse, mark-all-read</name>
  <files>
    frontend/src/components/article/ArticleList.tsx
    frontend/src/lib/constants.ts
  </files>
  <action>
**ArticleList.tsx — Major restructure of the top area:**

1. **Feed name heading at top:**
   - Show "Articles" when `selectedFeedId === null`, show specific feed name when a feed is selected (look up from `feeds` data)
   - Use `Heading` component, `fontSize="2xl"`, `fontWeight="bold"`, `px={4}`, `pt={4}`, `pb={2}`
   - On mobile (base breakpoint), show a hamburger `IconButton` (`LuMenu`) to the left of the heading that calls `onOpenMobileSidebar` prop
   - Add a `ref` on the heading for IntersectionObserver tracking

2. **Filter dropdown (replace individual buttons):**
   - Replace the 4 filter `Button` components with a Chakra `Select.Root` dropdown
   - Options: "Unread (N)", "All (N)", "Scoring (N)", "Blocked (N)" — each with count
   - Use `createListCollection` for the options
   - Active filter label shows the selected option with count
   - Disabled options: Scoring when count is 0, Blocked when count is 0

3. **Controls bar with sticky scroll-collapse:**
   - Use `IntersectionObserver` on the feed name heading ref
   - When heading scrolls out of viewport, set `isScrolled` state to true
   - Controls bar: `position={isScrolled ? "sticky" : "static"}`, `top={0}`, `zIndex={5}`, `bg="bg"`
   - When `isScrolled`: show a small inline feed name text (`fontSize="sm"`, `fontWeight="medium"`) at the left of the controls bar before the filter dropdown
   - Use `rootMargin: "-1px 0px 0px 0px"` for hysteresis (per research pitfall #6)
   - Smooth CSS transition on opacity/height for the inline feed name appearance

4. **Mark all read — always visible icon button:**
   - Replace the conditional text "Mark all read" button with an always-visible `IconButton` using `LuCheckCheck` icon
   - When `selectedFeedId` is set: use existing `markAllRead.mutate(selectedFeedId)` (feed-scoped)
   - When `selectedFeedId` is null (All Articles view): use new `useMarkAllArticlesRead` hook from Plan 01
   - For All Articles: show a `ConfirmDialog` before marking all read ("Mark all articles as read? This will mark all unread articles across all feeds as read.")
   - Import `useMarkAllArticlesRead` from `@/hooks/useFeedMutations`
   - Add mark-all-read confirmation state: `const [isConfirmMarkAllOpen, setIsConfirmMarkAllOpen] = useState(false)`

5. **Wire up rescore from context menu:**
   - Import `rescoreArticle` from `@/lib/api` and create a mutation in ArticleList (or import a hook)
   - Pass `onRescore` callback through to ArticleRow that calls `rescoreArticle` and invalidates `queryKeys.articles.all`

6. **Rename component:** Rename `ArticleList` to `ArticleView` and the file to `ArticleView.tsx` per CONTEXT.md decision. Update the import in AppShell.tsx. Keep `ArticleList.tsx` as a re-export for any other consumers (or update all imports).

  Actually, the rename touches many files and adds risk. Per "surgical changes" principle, defer the rename. Keep the component as `ArticleList` in `ArticleList.tsx` for now, and note it as a future cleanup.

**constants.ts:**
- Add `ARTICLE_LIST_PAGE_SIZE = 50` if not already defined (current inline `50`)
  </action>
  <verify>
`cd /Users/cstalhem/projects/rss-reader/frontend && bun run build` — builds with no errors. Filter is a dropdown with counts. Feed heading at top. Sticky scroll-collapse works.
  </verify>
  <done>
Feed name heading at top of content area. Filter is a dropdown with counts. Controls bar becomes sticky on scroll with inline feed name. Mark all read is always-visible icon button with All Articles confirmation. Mobile hamburger opens sidebar. Rescore wired through context menu.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && bun run build` — no type errors
2. `cd frontend && bun run lint` — no lint errors
3. Article rows show summary preview below title
4. Read articles have no dot, read styling uses typography weight
5. Hover-reveal context menu appears on read article rows
6. Filter is a Select dropdown with counts
7. Feed heading collapses into sticky controls bar on scroll
8. Mark all read works for both single feed and All Articles views
</verification>

<success_criteria>
- Article rows show 2-line summary_preview or score_reasoning (with sparkle icon) below title
- Read/unread distinction via typography weight + subtle background (not opacity)
- No dot on read articles, filled accent dot on unread (clickable)
- Hover-reveal context menu on read articles: Mark unread, Open original, Rescore
- No high-score row background tint
- Filter is a dropdown with counts per option
- Sort dropdown preserved
- Mark all read is always-visible icon button, works on All Articles with confirmation
- Feed name heading at top, collapses into sticky controls bar on scroll
- Mobile hamburger icon opens mobile sidebar drawer
</success_criteria>

<output>
After completion, create `.planning/phases/09.5-refine-main-view-ux-and-typography/09.5-03-SUMMARY.md`
</output>
