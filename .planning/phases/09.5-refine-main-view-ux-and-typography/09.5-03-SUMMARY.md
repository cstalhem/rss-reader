---
phase: 09.5-refine-main-view-ux-and-typography
plan: 03
subsystem: ui
tags: [chakra-ui, article-row, context-menu, filter-dropdown, intersection-observer, sticky-toolbar]

# Dependency graph
requires:
  - "09.5-01: summary_preview/score_reasoning fields, rescoreArticle API, useMarkAllArticlesRead hook"
  - "09.5-02: onOpenMobileSidebar prop threaded through AppShell to ArticleList"
provides:
  - "Redesigned ArticleRow with summary preview, typography-based read/unread, hover-reveal context menu"
  - "ArticleRowContextMenu component with Mark unread, Open original, Rescore actions"
  - "Filter dropdown (Select.Root) replacing filter buttons"
  - "Feed name heading with IntersectionObserver-driven sticky scroll-collapse toolbar"
  - "Always-visible mark-all-read IconButton with cross-feed confirmation dialog"
  - "Mobile hamburger icon for sidebar drawer"
  - "Rescore mutation wired through ArticleRow context menu"
affects: [09.5-04, 09.5-05]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "IntersectionObserver sticky scroll-collapse: heading ref tracked, controls bar toggles sticky on scroll"
    - "Hover-reveal context menu: conditional mount via isHovered state on mouse enter/leave"
    - "Filter dropdown with disabled items via createListCollection"

key-files:
  created:
    - "frontend/src/components/article/ArticleRowContextMenu.tsx"
  modified:
    - "frontend/src/components/article/ArticleRow.tsx"
    - "frontend/src/components/article/ArticleList.tsx"
    - "frontend/src/lib/constants.ts"

key-decisions:
  - "Removed useCallback wrappers in ArticleList -- React Compiler handles memoization, manual useCallback with mutation.mutate deps caused preserve-manual-memoization lint errors"
  - "Filter dropdown uses createListCollection with disabled property on items (not disabled prop on Select.Item)"
  - "Count label simplified to just article count number (not verbose label) for cleaner toolbar"

patterns-established:
  - "Hover-reveal context menu: useState isHovered + onMouseEnter/Leave + conditional ArticleRowContextMenu mount"
  - "IntersectionObserver sticky toolbar: heading ref observed, rootMargin -1px for hysteresis, isScrolled state"

requirements-completed: []

# Metrics
duration: 4.9min
completed: 2026-02-22
---

# Phase 09.5 Plan 03: Article Rows and Toolbar Redesign Summary

**Redesigned article rows with summary preview line, typography-based read/unread styling, hover-reveal context menu, and overhauled toolbar with filter dropdown, sticky scroll-collapse, and always-visible mark-all-read**

## Performance

- **Duration:** 4.9 min
- **Started:** 2026-02-22T20:30:05Z
- **Completed:** 2026-02-22T20:34:55Z
- **Tasks:** 2
- **Files modified:** 4 (1 created, 3 modified)

## Accomplishments
- Article rows now show summary_preview or score_reasoning (with LuSparkles icon prefix) below the title with 2-line clamp
- Read/unread distinction via typography weight (semibold/normal) + subtle bg tint (no more opacity pattern)
- Read articles have no dot at all (space collapsed), unread articles keep filled accent dot
- Hover-reveal context menu on read articles with Mark unread, Open original, Rescore actions
- High-score row background tint (accent.subtle) removed -- score badge alone signals high scores
- Filter buttons replaced with Select.Root dropdown showing counts
- Feed name heading at top of content area (shows feed name or "Articles" for All Articles)
- Sticky scroll-collapse toolbar via IntersectionObserver -- inline feed name appears when heading scrolls out
- Mark all read is always-visible IconButton, works for both single feed and All Articles (with confirmation dialog)
- Mobile hamburger icon opens mobile sidebar drawer
- Rescore mutation wired from ArticleRowContextMenu through to backend API

## Task Commits

Each task was committed atomically:

1. **Task 1: Redesign ArticleRow -- summary preview, read/unread styling, context menu** - `de94832` (feat)
2. **Task 2: Overhaul ArticleList -- feed heading, filter dropdown, sticky scroll-collapse, mark-all-read** - `25dc1ec` (feat)

## Files Created/Modified
- `frontend/src/components/article/ArticleRowContextMenu.tsx` - New context menu component with Mark unread, Open original, Rescore actions
- `frontend/src/components/article/ArticleRow.tsx` - Redesigned with summary preview, typography-based read/unread, hover-reveal context menu, removed opacity/high-score background
- `frontend/src/components/article/ArticleList.tsx` - Feed heading, filter dropdown, sticky scroll-collapse toolbar, mark-all-read with confirmation, rescore mutation, mobile hamburger
- `frontend/src/lib/constants.ts` - Added ARTICLE_LIST_PAGE_SIZE constant

## Decisions Made
- Removed useCallback wrappers for handler functions in ArticleList because React Compiler handles memoization automatically, and manual useCallback with mutation.mutate deps triggered preserve-manual-memoization lint errors
- Filter dropdown disabled items handled via createListCollection disabled property (Select.Item does not accept a disabled prop in Chakra v3)
- Simplified count label from verbose "N unread articles" to just the number for a cleaner controls bar layout
- Deferred ArticleList-to-ArticleView rename per plan's own recommendation (surgical changes principle)

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Fixed Select.Item disabled prop type error**
- **Found during:** Task 2 (filter dropdown implementation)
- **Issue:** Chakra v3 `Select.Item` does not accept a `disabled` prop -- it uses the collection item's disabled property internally
- **Fix:** Removed `disabled={option.disabled}` from Select.Item, relying on createListCollection's built-in disabled handling
- **Files modified:** `frontend/src/components/article/ArticleList.tsx`
- **Verification:** `bun run build` passes with no type errors
- **Committed in:** 25dc1ec (Task 2 commit)

**2. [Rule 1 - Bug] Removed useCallback to fix React Compiler lint errors**
- **Found during:** Task 2 (handler functions)
- **Issue:** useCallback with `[mutation.mutate]` deps caused `react-hooks/preserve-manual-memoization` errors from React Compiler
- **Fix:** Replaced useCallback wrappers with plain arrow functions (React Compiler memoizes automatically)
- **Files modified:** `frontend/src/components/article/ArticleList.tsx`
- **Verification:** `bunx eslint src/components/article/ArticleList.tsx` clean
- **Committed in:** 25dc1ec (Task 2 commit)

---

**Total deviations:** 2 auto-fixed (2 bugs)
**Impact on plan:** Both fixes necessary for build/lint compliance. No scope creep.

## Issues Encountered

None beyond the auto-fixed deviations above.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Article list and toolbar fully redesigned, ready for Plan 04 (reader layout) and Plan 05 (content rendering)
- ArticleRow passes onRescore through to context menu, rescore mutation operational
- Mark all read works for both single feed and All Articles views
- IntersectionObserver sticky toolbar pattern established for reuse

## Self-Check: PASSED

All 4 files verified on disk (1 created, 3 modified). Both task commits (de94832, 25dc1ec) verified in git log.

---
*Phase: 09.5-refine-main-view-ux-and-typography*
*Completed: 2026-02-22*
